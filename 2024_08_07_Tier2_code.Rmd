---
title: "Untitled"
output: html_document
date: "2024-01-29"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(readxl)
library(tidyverse)
library(janitor)
library(zoo)
```

```{r}
zips <- read_excel("N:/BNFFiles/Data Analytics/2024/673055_BehaviorHealth/Data/2021_2023/Zip Codes/Zip Codes by Area.xlsx", sheet = "Sheet5")
```


#Asian Counseling Treatment Services

```{r}

#read in output report
ACTS <- read_excel("N:/BNFFiles/Data Analytics/2024/673055_BehaviorHealth/Data/2021_2023/Asian Counseling Treatment Services/12-2023 SC-109381_Asian Counseling Treatment Services CPR_Revised Amend 1.xlsx", sheet = 8)


# transpose, rename columns, keep rows that are monthly counts, select relevant columns, calculate unique clients, change counts to numeric
ACTS_long <- as.data.frame(t(ACTS)) %>%
  row_to_names(row_number = 1) 

colnames(ACTS_long)[5] <- "Month"
colnames(ACTS_long)[8] <- "Total Clients Served"
colnames(ACTS_long)[9] <- "New Clients Served"


ACTS_long <- ACTS_long[c(1:3,5,6, 7, 9:11, 13:15, 17:19, 21:23),]
colnames(ACTS_long) <-  make.unique(colnames(ACTS_long))

ACTS_long$`Outside of Pierce County` <- NA



ACTS_long <- ACTS_long %>%
  select(Month, `Total Clients Served`, `New Clients Served`, starts_with("9"), `Outside of Pierce County`, Unknown,  
         `Case Management`, `Assessment - Substance Use Disorder`, `Care Coordination`, `Assessment - Mental Health`, 
         `Crisis Services/Management`, `Engagement and Outreach`, `Family Treatment`, `Group Treatment`,
         `Individual Treatment - Mental Health`, `Individual Treatment - Substance Use Disorder`, `Individual Treatment - Other`, `Medication Management`, 
         `Nursing Care`, `Peer Support`, 
         Other, Female, Male, 
         `Black or African American`, `American Indian/Alaskan Native`, Asian, 
         `Native Hawaiian / Pacific Islander`, `Another Race`, `Unknown/Unreported`, `Two or More`, White, `Unknown/Unreported.1`, `Hispanic or Latino`,
         `Non-Hispanic or Latino`, 
         `0-14`, `15-17`, `18-24`, `24-64`, `65+`, Unknown.1, 
         Unknown.2, `Residential Treatment`, `Unstably Housed`, Unhoused, `Stably Housed`, 
         Unknown.3, `Veteran/Active Duty`, `Adult Family of Veteran/Active Duty`, `Child of Veteran/Active Duty`, `Non-Veteran/Active Duty`, 
         Unknown.4, Private, `Military Affiliated`, Medicaid, Uninsured, 
         Unkown, `Other -Church`, Court, `Fire Deparment`, `Hospital/ED`, `Law Enforcement`, `Other Healthcare Provider`, 
         `Other Provider`, `Outreach/Crises Response`, School, `Self/Family/Friend`) %>%
  mutate(`Unique Clients Served` = cumsum(`New Clients Served`))

ACTS_long$Month <- c("July 2022", "August 2022", "September 2022", "October 2022", "November 2022", "December 2022", "January 2023", "February 2023",
                     "March 2023", "April 2023", "May 2023", "June 2023", "July 2023", "August 2023", "September 2023", "October 2023", "November 2023", 
                     "December 2023")

#add missing zip codes
missing_zips <- zips[-which(zips$Zip %in% colnames(ACTS_long)),1] %>% 
  t(.) %>%
  row_to_names(row_number = 1) %>%
  as.data.frame()
missing_zips[1:nrow(ACTS_long),] <- NA

ACTS_long <- cbind(ACTS_long, missing_zips)

#make columns numeric
ACTS_long[,2:ncol(ACTS_long)] <- mapply(as.numeric, ACTS_long[,2:ncol(ACTS_long)]) 

ACTS_long$Program <- "Asian Counseling Treatment Services"

ACTS_final <- pivot_longer(ACTS_long, cols = -c(Month, Program), names_to = "Subgroup", values_to = "Count") %>%
   mutate(Group = case_when(Subgroup %in% c("Male", "Female", "Other") ~ "Gender",
                           Subgroup %in% c("Unhoused", "Unstably Housed", "Stably Housed", "Residential Treatment", "Unknown.2") ~ "Housing Status",
                           Subgroup %in% c("Private", "Uninsured", "Medicaid", "Military Affiliated", "Unknown.4") ~ "Health Insurance Status",
                           Subgroup %in% c("Veteran/Active Duty", "Adult Family of Veteran/Active Duty", "Child of Veteran/Active Duty",
                                           "Non-Veteran/Active Duty", "Unknown.3") ~ "Veteran Status",
                           grepl("9", Subgroup) | Subgroup %in% c("Outside of Pierce County", "Unknown") ~ "Clients Served by Zip Code",
                           Subgroup %in% c("Assessment - Mental Health", "Assessment - Substance Use Disorder", "Care Coordination", "Case Management", 
                                       "Crisis Services/Management", "Engagement and Outreach", "Family Treatment", "Group Treatment", 
                                       "Individual Treatment - Mental Health", "Individual Treatment - Substance Use Disorder", 
                                       "Individual Treatment - Other", "Medication Management", "Nursing Care", "Peer Support") ~ "Service Type",
                           Subgroup %in% c('0-14', "15-17", "18-24", "24-64", "65+", "Unknown.1") ~ "Age",
                           Subgroup %in% c("Black or African American", "American Indian/Alaskan Native", "Asian", 
                                           "Native Hawaiian / Pacific Islander", "Another Race", "Unknown/Unreported", "Two or More", 
                                           "White", "Unknown/Unreported.1", "Hispanic or Latino", "Non-Hispanic or Latino") ~ "Race/Ethnicity",
                           Subgroup %in% c("Unkown", "Other -Church", "Court", "Fire Deparment", "Hospital/ED", "Law Enforcement", 
                                           "Other Healthcare Provider", "Other Provider", "Outreach/Crises Response", "School", 
                                           "Self/Family/Friend") ~ "Referral Source",
                           
                           TRUE ~ Subgroup)) %>%
  select(Program, Month, Group, Subgroup, Count) 




```


#Behavior Bridges (need to sort out duplicate zipcodes)

```{r}

#read in output report
BB <- read_excel("N:/BNFFiles/Data Analytics/2024/673055_BehaviorHealth/Data/2021_2023/Behavior Bridges/Revised 1-3-24 December 2023 BH-189-Behavior Bridges-SC-109672.xlsx", sheet = 8)


# transpose, rename columns, keep rows that are monthly counts, select relevant columns, calculate unique clients, change counts to numeric
BB_long <- as.data.frame(t(BB)) %>%
  row_to_names(row_number = 1) 

colnames(BB_long)[5] <- "Month"
colnames(BB_long)[8] <- "Total Clients Served"
colnames(BB_long)[9] <- "New Clients Served"

BB_long <- BB_long[c(1:3,5,6,7,9:11, 13:15, 17:19, 21:23),]
colnames(BB_long) <-  make.unique(colnames(BB_long))


BB_long <- BB_long %>%
  select(Month, `Total Clients Served`, `New Clients Served`, 
         starts_with("9"), `Outside of Pierce County`, Unknown,  
         `Case Management`, `Assessment - Substance Use Disorder`, `Care Coordination`, `Assessment - Mental Health`, `Crisis Services/Management`, 
         `Engagement and Outreach`, `Family Treatment`, `Group Treatment`,`Individual Treatment - Mental Health`, 
         `Individual Treatment - Substance Use Disorder`, `Individual Treatment - Other`, `Medication Management`, 
         `Nursing Care`, `Peer Support`, 
         Other, Female, Male, 
         `Black or African American`, `American Indian/Alaskan Native`, Asian, 
         `Native Hawaiian / Pacific Islander`, `Another Race`, `Unknown/Unreported`, `Two or More`, White, `Unknown/Unreported.1`, `Hispanic or Latino`,
         `Non-Hispanic or Latino`, 
         `0-14`, `15-17`, `18-24`, `24-64`, `65+`, 
         Unknown.1, `Residential Treatment`, `Unstably Housed`, Unhoused, `Stably Housed`, 
         Unknown.2, `Veteran/Active Duty`, `Adult Family of Veteran/Active Duty`, `Child of Veteran/Active Duty`, `Non-Veteran/Active Duty`, 
         Unknown.3, Private, `Military Affiliated`, Medicaid, Uninsured, 
         Unkown, Court, `Fire Deparment`, `Hospital/ED`, `Law Enforcement`, `Other Healthcare Provider`, `Other Provider`, 
         `Outreach/Crises Response`, School, `Self/Family/Friend`, `Other - Behavior Bridges`) %>%
   mutate(`Unique Clients Served` = cumsum(`New Clients Served`))

BB_long$Month <- c("July 2022", "August 2022", "September 2022", "October 2022", "November 2022", "December 2022", "January 2023", "February 2023",
                     "March 2023", "April 2023", "May 2023", "June 2023", "July 2023", "August 2023", "September 2023", "October 2023", "November 2023", 
                     "December 2023")



#add missing zip codes
missing_zips <- zips[-which(zips$Zip %in% colnames(BB_long)),1] %>% 
  t(.) %>%
  row_to_names(row_number = 1) %>%
  as.data.frame()
missing_zips[1:nrow(BB_long),] <- NA

BB_long <- cbind(BB_long, missing_zips)


BB_long[,2:ncol(BB_long)] <- mapply(as.numeric,BB_long[,2:ncol(BB_long)]) 

BB_long$Program <- "Behavior Bridges"

BB_final <- pivot_longer(BB_long, cols = -c(Month, Program), names_to = "Subgroup", values_to = "Count") %>%
   mutate(Group = case_when(Subgroup %in% c("Male", "Female", "Other") ~ "Gender",
                           Subgroup %in% c("Unhoused", "Unstably Housed", "Stably Housed", "Residential Treatment", "Unknown.1") ~ "Housing Status",
                           Subgroup %in% c("Private", "Uninsured", "Medicaid", "Military Affiliated", "Unknown.3") ~ "Health Insurance Status",
                           Subgroup %in% c("Veteran/Active Duty", "Adult Family of Veteran/Active Duty", "Child of Veteran/Active Duty",
                                           "Non-Veteran/Active Duty", "Unknown.2") ~ "Veteran Status",
                           grepl("9", Subgroup) | Subgroup %in% c("Outside of Pierce County", "Unknown") ~ "Clients Served by Zip Code",
                           Subgroup %in% c("Assessment - Mental Health", "Assessment - Substance Use Disorder", "Care Coordination", "Case Management", 
                                       "Crisis Services/Management", "Engagement and Outreach", "Family Treatment", "Group Treatment", 
                                       "Individual Treatment - Mental Health", "Individual Treatment - Substance Use Disorder", 
                                       "Individual Treatment - Other", "Medication Management", "Nursing Care", "Peer Support") ~ "Service Type",
                           Subgroup %in% c('0-14', "15-17", "18-24", "24-64", "65+") ~ "Age",
                           Subgroup %in% c("Black or African American", "American Indian/Alaskan Native", "Asian", 
                                           "Native Hawaiian / Pacific Islander", "Another Race", "Unknown/Unreported", "Two or More", 
                                           "White", "Unknown/Unreported.1", "Hispanic or Latino", "Non-Hispanic or Latino") ~ "Race/Ethnicity",
                           Subgroup %in% c("Unkown", "Court", "Fire Deparment", "Hospital/ED", "Law Enforcement", 
                                           "Other Healthcare Provider", "Other Provider", "Outreach/Crises Response", "School", 
                                           "Self/Family/Friend", "Other - Behavior Bridges") ~ "Referral Source",
                           
                           TRUE ~ Subgroup)) %>%
  select(Program, Month, Group, Subgroup, Count) 




```
# Pierce County Aids Foundation (Oasis)

```{r}
#july 2022- may 2023

PCAF <- read_excel("N:/BNFFiles/Data Analytics/2024/673055_BehaviorHealth/Data/2021_2023/Pierce County Aids Foundation/CLEANED_23-12 December - SC-110607_Oasis Youth Center_$145128.99_CPR.xlsx", sheet = 8)


# transpose, rename columns, keep rows that are monthly counts, select relevant columns, calculate unique clients, change counts to numeric
PCAF_long <- as.data.frame(t(PCAF)) %>%
  row_to_names(row_number = 1) 

colnames(PCAF_long)[5] <- "Month"
colnames(PCAF_long)[8] <- "Total Clients Served"
colnames(PCAF_long)[9] <- "New Clients Served"

PCAF_long <- PCAF_long[c(1:3, 5:7, 9:11, 13,14),]
colnames(PCAF_long) <- make.unique(colnames(PCAF_long))

colnames(PCAF_long)[colnames(PCAF_long) == "25-64"] <- "24-64"


PCAF_long <- PCAF_long %>%
  select(Month, `Total Clients Served`, `New Clients Served`, 
         starts_with("9"), `Outside of Pierce County`, Unknown,  
         `Case Management`, `Assessment - Substance Use Disorder`, `Care Coordination`, `Assessment - Mental Health`, `Crisis Services/Management`, 
         `Engagement and Outreach`, `Family Treatment`, `Group Treatment`,`Individual Treatment - Mental Health`, 
         `Individual Treatment - Substance Use Disorder`, `Individual Treatment - Other`, `Medication Management`, 
         `Nursing Care`, `Peer Support`, 
         Other, Female, Male, 
         `Black or African American`, `American Indian/Alaskan Native`, Asian, 
         `Native Hawaiian / Pacific Islander`, `Another Race`, `Unknown/Unreported`, `Two or More`, White, `Unknown/Unreported.1`, `Hispanic or Latino`,
         `Non-Hispanic or Latino`, 
         `0-14`, `15-17`, `18-24`, `24-64`, `65+`, 
         Unknown.1, `Residential Treatment`, `Unstably Housed`, Unhoused, `Stably Housed`, 
         Unknown.2, `Veteran/Active Duty`, `Adult Family of Veteran/Active Duty`, `Child of Veteran/Active Duty`, `Non-Veteran/Active Duty`, 
         Unknown.3, Private, `Military Affiliated`, Medicaid, Uninsured, 
         Unkown, Court, `Fire Deparment`, `Hospital/ED`, `Law Enforcement`, `Other Healthcare Provider`, `Other Provider`, 
         `Outreach/Crises Response`, School, `Self/Family/Friend`, `Other -`) %>%
   mutate(`Unique Clients Served` = cumsum(`New Clients Served`))

PCAF_long$Month <- c("July 2022", "August 2022", "September 2022", "October 2022", "November 2022", "December 2022", 
                    "January 2023", "February 2023", "March 2023", "April 2023", "May 2023")



#add missing zip codes
missing_zips <- zips[-which(zips$Zip %in% colnames(PCAF_long)),1] %>% 
  t(.) %>%
  row_to_names(row_number = 1) %>%
  as.data.frame()
missing_zips[1:nrow(PCAF_long),] <- NA

PCAF_long <- cbind(PCAF_long, missing_zips)


PCAF_long[,2:ncol(PCAF_long)] <- mapply(as.numeric,PCAF_long[,2:ncol(PCAF_long)]) 

PCAF_long$Program <- "Oasis Youth Center"

PCAF_final <- pivot_longer(PCAF_long, cols = -c(Month, Program), names_to = "Subgroup", values_to = "Count") %>%
   mutate(Group = case_when(Subgroup %in% c("Male", "Female", "Other") ~ "Gender",
                           Subgroup %in% c("Unhoused", "Unstably Housed", "Stably Housed", "Residential Treatment", "Unknown.1") ~ "Housing Status",
                           Subgroup %in% c("Private", "Uninsured", "Medicaid", "Military Affiliated", "Unknown.3") ~ "Health Insurance Status",
                           Subgroup %in% c("Veteran/Active Duty", "Adult Family of Veteran/Active Duty", "Child of Veteran/Active Duty",
                                           "Non-Veteran/Active Duty", "Unknown.2") ~ "Veteran Status",
                           grepl("9", Subgroup) | Subgroup %in% c("Outside of Pierce County", "Unknown") ~ "Clients Served by Zip Code",
                           Subgroup %in% c("Assessment - Mental Health", "Assessment - Substance Use Disorder", "Care Coordination", "Case Management", 
                                       "Crisis Services/Management", "Engagement and Outreach", "Family Treatment", "Group Treatment", 
                                       "Individual Treatment - Mental Health", "Individual Treatment - Substance Use Disorder", 
                                       "Individual Treatment - Other", "Medication Management", "Nursing Care", "Peer Support") ~ "Service Type",
                           Subgroup %in% c('0-14', "15-17", "18-24", "24-64", "65+") ~ "Age",
                           Subgroup %in% c("Black or African American", "American Indian/Alaskan Native", "Asian", 
                                           "Native Hawaiian / Pacific Islander", "Another Race", "Unknown/Unreported", "Two or More", 
                                           "White", "Unknown/Unreported.1", "Hispanic or Latino", "Non-Hispanic or Latino") ~ "Race/Ethnicity",
                           Subgroup %in% c("Unkown", "Court", "Fire Deparment", "Hospital/ED", "Law Enforcement", 
                                           "Other Healthcare Provider", "Other Provider", "Outreach/Crises Response", "School", 
                                           "Self/Family/Friend", "Other -") ~ "Referral Source",
                           
                           TRUE ~ Subgroup)) %>%
  select(Program, Month, Group, Subgroup, Count) 

#june 2023 - december 2023####################################################################################################


PCAF_2 <- read_excel("N:/BNFFiles/Data Analytics/2024/673055_BehaviorHealth/Data/2021_2023/Pierce County Aids Foundation/CLEANED_23-12 December - SC-110607_Oasis Youth Center_$145128.99_CPR.xlsx", sheet = 7)


# transpose, rename columns, keep rows that are monthly counts, select relevant columns, calculate unique clients, change counts to numeric
PCAF_2_long <- as.data.frame(t(PCAF_2)) %>%
  row_to_names(row_number = 1) 

colnames(PCAF_2_long)[5] <- "Month"
colnames(PCAF_2_long)[8] <- "Total Clients Served"
colnames(PCAF_2_long)[9] <- "New Clients Served"

PCAF_2_long <- PCAF_2_long[c(2, 4:6, 8:10),]
colnames(PCAF_2_long) <- make.unique(colnames(PCAF_2_long))

colnames(PCAF_2_long)[colnames(PCAF_2_long) == "25-64"] <- "24-64"


PCAF_2_long <- PCAF_2_long %>%
  select(Month, `Total Clients Served`, `New Clients Served`, 
         starts_with("9"), `Outside of Pierce County`, Unknown,  
         `Case Management`, `Assessment - Substance Use Disorder`, `Care Coordination`, `Assessment - Mental Health`, `Crisis Services/Management`, 
         `Engagement and Outreach`, `Family Treatment`, `Group Treatment`,`Individual Treatment - Mental Health`, 
         `Individual Treatment - Substance Use Disorder`, `Individual Treatment - Other`, `Medication Management`, 
         `Nursing Care`, `Peer Support`, 
         Other, Female, Male, 
         `Black or African American`, `American Indian/Alaskan Native`, Asian, 
         `Native Hawaiian / Pacific Islander`, `Another Race`, `Unknown/Unreported`, `Two or More`, White, `Unknown/Unreported.1`, `Hispanic or Latino`,
         `Non-Hispanic or Latino`, 
         `0-14`, `15-17`, `18-24`, `24-64`, `65+`, 
         Unknown.1, `Residential Treatment`, `Unstably Housed`, Unhoused, `Stably Housed`, 
         Unknown.2, `Veteran/Active Duty`, `Adult Family of Veteran/Active Duty`, `Child of Veteran/Active Duty`, `Non-Veteran/Active Duty`, 
         Unknown.3, Private, `Military Affiliated`, Medicaid, Uninsured, 
         Unkown, Court, `Fire Deparment`, `Hospital/ED`, `Law Enforcement`, `Other Healthcare Provider`, `Other Provider`, 
         `Outreach/Crises Response`, School, `Self/Family/Friend`, `Other -`) %>%
   mutate(`Unique Clients Served` = cumsum(`New Clients Served`))

PCAF_2_long$Month <- c("June 2023", "July 2023", "August 2023", "September 2023", "October 2023", "November 2023",
                       "December 2023")



#add missing zip codes
missing_zips <- zips[-which(zips$Zip %in% colnames(PCAF_2_long)),1] %>% 
  t(.) %>%
  row_to_names(row_number = 1) %>%
  as.data.frame()
missing_zips[1:nrow(PCAF_2_long),] <- NA

PCAF_2_long <- cbind(PCAF_2_long, missing_zips)


PCAF_2_long[,2:ncol(PCAF_2_long)] <- mapply(as.numeric,PCAF_2_long[,2:ncol(PCAF_2_long)]) 

PCAF_2_long$Program <- "Oasis Youth Center"

PCAF_2_final <- pivot_longer(PCAF_2_long, cols = -c(Month, Program), names_to = "Subgroup", values_to = "Count") %>%
   mutate(Group = case_when(Subgroup %in% c("Male", "Female", "Other") ~ "Gender",
                           Subgroup %in% c("Unhoused", "Unstably Housed", "Stably Housed", "Residential Treatment", "Unknown.1") ~ "Housing Status",
                           Subgroup %in% c("Private", "Uninsured", "Medicaid", "Military Affiliated", "Unknown.3") ~ "Health Insurance Status",
                           Subgroup %in% c("Veteran/Active Duty", "Adult Family of Veteran/Active Duty", "Child of Veteran/Active Duty",
                                           "Non-Veteran/Active Duty", "Unknown.2") ~ "Veteran Status",
                           grepl("9", Subgroup) | Subgroup %in% c("Outside of Pierce County", "Unknown") ~ "Clients Served by Zip Code",
                           Subgroup %in% c("Assessment - Mental Health", "Assessment - Substance Use Disorder", "Care Coordination", "Case Management", 
                                       "Crisis Services/Management", "Engagement and Outreach", "Family Treatment", "Group Treatment", 
                                       "Individual Treatment - Mental Health", "Individual Treatment - Substance Use Disorder", 
                                       "Individual Treatment - Other", "Medication Management", "Nursing Care", "Peer Support") ~ "Service Type",
                           Subgroup %in% c('0-14', "15-17", "18-24", "24-64", "65+") ~ "Age",
                           Subgroup %in% c("Black or African American", "American Indian/Alaskan Native", "Asian", 
                                           "Native Hawaiian / Pacific Islander", "Another Race", "Unknown/Unreported", "Two or More", 
                                           "White", "Unknown/Unreported.1", "Hispanic or Latino", "Non-Hispanic or Latino") ~ "Race/Ethnicity",
                           Subgroup %in% c("Unkown", "Court", "Fire Deparment", "Hospital/ED", "Law Enforcement", 
                                           "Other Healthcare Provider", "Other Provider", "Outreach/Crises Response", "School", 
                                           "Self/Family/Friend", "Other -") ~ "Referral Source",
                           
                           TRUE ~ Subgroup)) %>%
  select(Program, Month, Group, Subgroup, Count) 
```


# Lutheran Community Services

```{r}
lcs <- read_excel("N:/BNFFiles/Data Analytics/2024/673055_BehaviorHealth/Data/2021_2023/Lutheran Community Services/SC-109302_Luthern Community Services _Dec 2023_Use.xlsx", sheet = 7)

# transpose, rename columns, keep rows that are monthly counts, select relevant columns, calculate unique clients, change counts to numeric
lcs_long <- as.data.frame(t(lcs)) %>%
  row_to_names(row_number = 1) 

colnames(lcs_long)[5] <- "Month"
colnames(lcs_long)[8] <- "Total Clients Served"
colnames(lcs_long)[9] <- "New Clients Served"

lcs_long <- lcs_long[c(3, 5:7, 9:11, 13:15, 17:19, 21:23),]
colnames(lcs_long) <-  make.unique(colnames(lcs_long))

lcs_long$`Outside of Pierce County` <- NA
lcs_long$`Unknown Zip Code` <- NA

colnames(lcs_long)[42] <- "24-64"

lcs_long <- lcs_long %>%
  select(Month, `Total Clients Served`, `New Clients Served`, 
         starts_with("9"), `Outside of Pierce County`, `Unknown Zip Code`,  
         `Case Management`, `Assessment - Substance Use Disorder`, `Care Coordination`, `Assessment - Mental Health`, `Crisis Services/Management`, 
         `Engagement and Outreach`, `Family Treatment`, `Group Treatment`,`Individual Treatment - Mental Health`, 
         `Individual Treatment - Substance Use Disorder`, `Individual Treatment - Other`, `Medication Management`, 
         `Nursing Care`, `Peer Support`, 
         Other, Female, Male, 
         `Black or African American`, `American Indian/Alaskan Native`, Asian, 
         `Native Hawaiian / Pacific Islander`, `Another Race`, `Unknown/Unreported`, `Two or More`, White, `Unknown/Unreported.1`, `Hispanic or Latino`,
         `Non-Hispanic or Latino`, 
         `0-14`, `15-17`, `18-24`, `24-64`, `65+`, 
         Unknown, `Residential Treatment`, `Unstably Housed`, Unhoused, `Stably Housed`, 
         Unknown.1, `Veteran/Active Duty`, `Adult Family of Veteran/Active Duty`, `Child of Veteran/Active Duty`, `Non-Veteran/Active Duty`, 
         Unknown.2, Private, `Military Affiliated`, Medicaid, Uninsured, 
         Unkown, Court, `Fire Deparment`, `Hospital/ED`, `Law Enforcement`, `Other Healthcare Provider`, `Other Provider`, 
         `Outreach/Crises Response`, School, `Self/Family/Friend`, `Other -`) %>%
  mutate(`Unique Clients Served` = cumsum(`New Clients Served`))
         
lcs_long$Month <- c("September 2022", "October 2022", "November 2022", "December 2022", "January 2023", "February 2023",
                     "March 2023", "April 2023", "May 2023", "June 2023", "July 2023", "August 2023", "September 2023", "October 2023", "November 2023", 
                     "December 2023")


#add missing zip codes
missing_zips <- zips[-which(zips$Zip %in% colnames(lcs_long)),1] %>% 
  t(.) %>%
  row_to_names(row_number = 1) %>%
  as.data.frame()
missing_zips[1:nrow(lcs_long),] <- NA

lcs_long <- cbind(lcs_long, missing_zips)


lcs_long[,2:ncol(lcs_long)] <- mapply(as.numeric,lcs_long[,2:ncol(lcs_long)]) 

lcs_long$Program <- "Lutheran Community Services"

lcs_final <- pivot_longer(lcs_long, cols = -c(Month, Program), names_to = "Subgroup", values_to = "Count") %>%
   mutate(Group = case_when(Subgroup %in% c("Male", "Female", "Other") ~ "Gender",
                           Subgroup %in% c("Unhoused", "Unstably Housed", "Stably Housed", "Residential Treatment", "Unknown") ~ "Housing Status",
                           Subgroup %in% c("Private", "Uninsured", "Medicaid", "Military Affiliated", "Unknown.2") ~ "Health Insurance Status",
                           Subgroup %in% c("Veteran/Active Duty", "Adult Family of Veteran/Active Duty", "Child of Veteran/Active Duty",
                                           "Non-Veteran/Active Duty", "Unknown.1") ~ "Veteran Status",
                           grepl("9", Subgroup) | Subgroup %in% c("Outside of Pierce County", "Unknown Zip Code") ~ "Clients Served by Zip Code",
                           Subgroup %in% c("Assessment - Mental Health", "Assessment - Substance Use Disorder", "Care Coordination", "Case Management", 
                                       "Crisis Services/Management", "Engagement and Outreach", "Family Treatment", "Group Treatment", 
                                       "Individual Treatment - Mental Health", "Individual Treatment - Substance Use Disorder", 
                                       "Individual Treatment - Other", "Medication Management", "Nursing Care", "Peer Support") ~ "Service Type",
                           Subgroup %in% c('0-14', "15-17", "18-24", "24-64", "65+") ~ "Age",
                           Subgroup %in% c("Black or African American", "American Indian/Alaskan Native", "Asian", 
                                           "Native Hawaiian / Pacific Islander", "Another Race", "Unknown/Unreported", "Two or More", 
                                           "White", "Unknown/Unreported.1", "Hispanic or Latino", "Non-Hispanic or Latino") ~ "Race/Ethnicity",
                           Subgroup %in% c("Unkown", "Court", "Fire Deparment", "Hospital/ED", "Law Enforcement", 
                                           "Other Healthcare Provider", "Other Provider", "Outreach/Crises Response", "School", 
                                           "Self/Family/Friend", "Other -") ~ "Referral Source",
                           
                           TRUE ~ Subgroup)) %>%
  select(Program, Month, Group, Subgroup, Count) 




```



# Horses Guiding Humans Foundation

```{r}
#read in output report
HGHF <- read_excel("N:/BNFFiles/Data Analytics/2024/673055_BehaviorHealth/Data/2021_2023/Horses Guiding Humans Foundation/Dec 23 BH-189-Horses Guiding Humans Foundation-SC-109560.xlsx", sheet = 6)


# transpose, rename columns, keep rows that are monthly counts, select relevant columns, calculate unique clients, change counts to numeric
HGHF_long <- as.data.frame(t(HGHF)) %>%
  row_to_names(row_number = 1) 


colnames(HGHF_long)[5] <- "Month"
colnames(HGHF_long)[8] <- "Total Clients Served"
colnames(HGHF_long)[9] <- "New Clients Served"

HGHF_long <- HGHF_long[c(3, 5:7, 9:11, 13:15, 17:19, 21:23),]
colnames(HGHF_long) <-  make.unique(colnames(HGHF_long))

HGHF_long$`Outside of Pierce County` <- NA
HGHF_long$`Unknown Zip Code` <- NA


HGHF_long <- HGHF_long %>%
  select(Month, `Total Clients Served`, `New Clients Served`, 
         starts_with("9"), `Outside of Pierce County`, `Unknown Zip Code`,  
         `Case Management`, `Assessment - Substance Use Disorder`, `Care Coordination`, `Assessment - Mental Health`, `Crisis Services/Management`, 
         `Engagement and Outreach`, `Family Treatment`, `Group Treatment`,`Individual Treatment - Mental Health`, 
         `Individual Treatment - Substance Use Disorder`, `Individual Treatment - Other`, `Medication Management`, 
         `Nursing Care`, `Peer Support`, 
         Other, Female, Male, 
         `Black or African American`, `American Indian/Alaskan Native`, Asian, 
         `Native Hawaiian / Pacific Islander`, `Another Race`, `Unknown/Unreported`, `Two or More`, White, `Unknown/Unreported.1`, `Hispanic or Latino`,
         `Non-Hispanic or Latino`, 
         `0-14`, `15-17`, `18-24`, `24-64`, `65+`, 
         Unknown, `Residential Treatment`, `Unstably Housed`, Unhoused, `Stably Housed`, 
         Unknown.1, `Veteran/Active Duty`, `Adult Family of Veteran/Active Duty`, `Child of Veteran/Active Duty`, `Non-Veteran/Active Duty`, 
         Unknown.2, Private, `Military Affiliated`, Medicaid, Uninsured, 
         Unkown, Court, `Fire Deparment`, `Hospital/ED`, `Law Enforcement`, `Other Healthcare Provider`, `Other Provider`, 
         `Outreach/Crises Response`, School, `Self/Family/Friend`, `Other -`) %>%
  mutate(`Unique Clients Served` = cumsum(`New Clients Served`))

HGHF_long$Month <- c("September 2022", "October 2022", "November 2022", "December 2022", "January 2023", "February 2023",
                     "March 2023", "April 2023", "May 2023", "June 2023", "July 2023", "August 2023", "September 2023", "October 2023", "November 2023", 
                     "December 2023")


#add missing zip codes
missing_zips <- zips[-which(zips$Zip %in% colnames(HGHF_long)),1] %>% 
  t(.) %>%
  row_to_names(row_number = 1) %>%
  as.data.frame()
missing_zips[1:nrow(HGHF_long),] <- NA

HGHF_long <- cbind(HGHF_long, missing_zips)


HGHF_long[,2:ncol(HGHF_long)] <- mapply(as.numeric,HGHF_long[,2:ncol(HGHF_long)]) 

HGHF_long$Program <- "Horses Guiding Humans"

HGHF_final <- pivot_longer(HGHF_long, cols = -c(Month, Program), names_to = "Subgroup", values_to = "Count") %>%
   mutate(Group = case_when(Subgroup %in% c("Male", "Female", "Other") ~ "Gender",
                           Subgroup %in% c("Unhoused", "Unstably Housed", "Stably Housed", "Residential Treatment", "Unknown") ~ "Housing Status",
                           Subgroup %in% c("Private", "Uninsured", "Medicaid", "Military Affiliated", "Unknown.2") ~ "Health Insurance Status",
                           Subgroup %in% c("Veteran/Active Duty", "Adult Family of Veteran/Active Duty", "Child of Veteran/Active Duty",
                                           "Non-Veteran/Active Duty", "Unknown.1") ~ "Veteran Status",
                           grepl("9", Subgroup) | Subgroup %in% c("Outside of Pierce County", "Unknown Zip Code") ~ "Clients Served by Zip Code",
                           Subgroup %in% c("Assessment - Mental Health", "Assessment - Substance Use Disorder", "Care Coordination", "Case Management", 
                                       "Crisis Services/Management", "Engagement and Outreach", "Family Treatment", "Group Treatment", 
                                       "Individual Treatment - Mental Health", "Individual Treatment - Substance Use Disorder", 
                                       "Individual Treatment - Other", "Medication Management", "Nursing Care", "Peer Support") ~ "Service Type",
                           Subgroup %in% c('0-14', "15-17", "18-24", "24-64", "65+") ~ "Age",
                           Subgroup %in% c("Black or African American", "American Indian/Alaskan Native", "Asian", 
                                           "Native Hawaiian / Pacific Islander", "Another Race", "Unknown/Unreported", "Two or More", 
                                           "White", "Unknown/Unreported.1", "Hispanic or Latino", "Non-Hispanic or Latino") ~ "Race/Ethnicity",
                           Subgroup %in% c("Unkown", "Court", "Fire Deparment", "Hospital/ED", "Law Enforcement", 
                                           "Other Healthcare Provider", "Other Provider", "Outreach/Crises Response", "School", 
                                           "Self/Family/Friend", "Other -") ~ "Referral Source",
                           
                           TRUE ~ Subgroup)) %>%
  select(Program, Month, Group, Subgroup, Count) 



```



#Catholic Community Services 

```{r}
ccs <- read_excel("N:/BNFFiles/Data Analytics/2024/673055_BehaviorHealth/Data/2021_2023/Catholic Community Services/Copy of 122023 - 01-668 - update.xlsx", sheet = 7)


# transpose, rename columns, keep rows that are monthly counts, select relevant columns, calculate unique clients, change counts to numeric
ccs_long <- as.data.frame(t(ccs)) %>%
  row_to_names(row_number = 1) 

colnames(ccs_long)[5] <- "Month"
colnames(ccs_long)[8] <- "Total Clients Served"
colnames(ccs_long)[9] <- "New Clients Served"

ccs_long <- ccs_long[c(1:3, 5:7, 9:11, 13:15, 17:19, 21:23),]
colnames(ccs_long) <-  make.unique(colnames(ccs_long))

ccs_long$`Outside of Pierce County` <- NA
ccs_long$`Unknown Zip Code` <- NA


ccs_long <- ccs_long %>%
  select(Month, `Total Clients Served`, `New Clients Served`, 
         starts_with("9"), `Outside of Pierce County`, `Unknown Zip Code`,  
         `Case Management`, `Assessment - Substance Use Disorder`, `Care Coordination`, `Assessment - Mental Health`, `Crisis Services/Management`, 
         `Engagement and Outreach`, `Family Treatment`, `Group Treatment`,`Individual Treatment - Mental Health`, 
         `Individual Treatment - Substance Use Disorder`, `Individual Treatment - Other`, `Medication Management`, 
         `Nursing Care`, `Peer Support`, 
         Other, Female, Male, 
         `Black or African American`, `American Indian/Alaskan Native`, Asian, 
         `Native Hawaiian / Pacific Islander`, `Another Race`, `Unknown/Unreported`, `Two or More`, White, `Unknown/Unreported.1`, `Hispanic or Latino`,
         `Non-Hispanic or Latino`, 
         `0-14`, `15-17`, `18-24`, `24-64`, `65+`, 
         Unknown, `Residential Treatment`, `Unstably Housed`, Unhoused, `Stably Housed`, 
         Unknown.1, `Veteran/Active Duty`, `Adult Family of Veteran/Active Duty`, `Child of Veteran/Active Duty`, `Non-Veteran/Active Duty`, 
         Unknown.2, Private, `Military Affiliated`, Medicaid, Uninsured, 
         Unkown, Court, `Fire Deparment`, `Hospital/ED`, `Law Enforcement`, `Other Healthcare Provider`, `Other Provider`, 
         `Outreach/Crises Response`, School, `Self/Family/Friend`, `Other -`) %>%
  mutate(`Unique Clients Served` = cumsum(`New Clients Served`))

ccs_long$Month <- c("July 2022", "August 2022", "September 2022", "October 2022", "November 2022", "December 2022", 
                    "January 2023", "February 2023", "March 2023", "April 2023", "May 2023", "June 2023", 
                    "July 2023", "August 2023", "September 2023", "October 2023", "November 2023","December 2023")

#add missing zip codes
missing_zips <- zips[-which(zips$Zip %in% colnames(ccs_long)),1] %>% 
  t(.) %>%
  row_to_names(row_number = 1) %>%
  as.data.frame()
missing_zips[1:nrow(ccs_long),] <- NA

ccs_long <- cbind(ccs_long, missing_zips)


ccs_long[,2:ncol(ccs_long)] <- mapply(as.numeric,ccs_long[,2:ncol(ccs_long)]) 

ccs_long$Program <- "Catholic Community Services"

ccs_final <- pivot_longer(ccs_long, cols = -c(Month, Program), names_to = "Subgroup", values_to = "Count") %>%
   mutate(Group = case_when(Subgroup %in% c("Male", "Female", "Other") ~ "Gender",
                           Subgroup %in% c("Unhoused", "Unstably Housed", "Stably Housed", "Residential Treatment", "Unknown") ~ "Housing Status",
                           Subgroup %in% c("Private", "Uninsured", "Medicaid", "Military Affiliated", "Unknown.2") ~ "Health Insurance Status",
                           Subgroup %in% c("Veteran/Active Duty", "Adult Family of Veteran/Active Duty", "Child of Veteran/Active Duty",
                                           "Non-Veteran/Active Duty", "Unknown.1") ~ "Veteran Status",
                           grepl("9", Subgroup) | Subgroup %in% c("Outside of Pierce County", "Unknown Zip Code") ~ "Clients Served by Zip Code",
                           Subgroup %in% c("Assessment - Mental Health", "Assessment - Substance Use Disorder", "Care Coordination", "Case Management", 
                                       "Crisis Services/Management", "Engagement and Outreach", "Family Treatment", "Group Treatment", 
                                       "Individual Treatment - Mental Health", "Individual Treatment - Substance Use Disorder", 
                                       "Individual Treatment - Other", "Medication Management", "Nursing Care", "Peer Support") ~ "Service Type",
                           Subgroup %in% c('0-14', "15-17", "18-24", "24-64", "65+") ~ "Age",
                           Subgroup %in% c("Black or African American", "American Indian/Alaskan Native", "Asian", 
                                           "Native Hawaiian / Pacific Islander", "Another Race", "Unknown/Unreported", "Two or More", 
                                           "White", "Unknown/Unreported.1", "Hispanic or Latino", "Non-Hispanic or Latino") ~ "Race/Ethnicity",
                           Subgroup %in% c("Unkown", "Court", "Fire Deparment", "Hospital/ED", "Law Enforcement", 
                                           "Other Healthcare Provider", "Other Provider", "Outreach/Crises Response", "School", 
                                           "Self/Family/Friend", "Other -") ~ "Referral Source",
                           
                           TRUE ~ Subgroup)) %>%
  select(Program, Month, Group, Subgroup, Count) 



```


# Asia Pacific Cultural Center

```{r}
#read in output report
APCC <- read_excel("N:/BNFFiles/Data Analytics/2024/673055_BehaviorHealth/Data/2021_2023/Asia Pacific Cultural Center/SC-109294_Asia Pacific Cultural Center_CPR Rev Dec 2023-final.xlsx", sheet = 7)

# transpose, rename columns, keep rows that are monthly counts, select relevant columns, calculate unique clients, change counts to numeric
APCC_long <- as.data.frame(t(APCC)) %>%
  row_to_names(row_number = 1) 


colnames(APCC_long)[5] <- "Month"
colnames(APCC_long)[8] <- "Total Clients Served"
colnames(APCC_long)[9] <- "New Clients Served"

APCC_long <- APCC_long[c(3, 5:7, 9:11, 13:15, 17:19, 21:23),]
colnames(APCC_long) <-  make.unique(colnames(APCC_long))


APCC_long <- APCC_long %>%
  select(Month, `Total Clients Served`, `New Clients Served`, 
         starts_with("9"), `Outside of Pierce County`, `Unknown`,  
         `Case Management`, `Assessment - Substance Use Disorder`, `Care Coordination`, `Assessment - Mental Health`, `Crisis Services/Management`, 
         `Engagement and Outreach`, `Family Treatment`, `Group Treatment`,`Individual Treatment - Mental Health`, 
         `Individual Treatment - Substance Use Disorder`, `Individual Treatment - Other`, `Medication Management`, 
         `Nursing Care`, `Peer Support`, 
         Other, Female, Male, 
         `Black or African American`, `American Indian/Alaskan Native`, Asian, 
         `Native Hawaiian / Pacific Islander`, `Another Race`, `Unknown/Unreported`, `Two or More`, White, `Unknown/Unreported.1`, `Hispanic or Latino`,
         `Non-Hispanic or Latino`, 
         `0-14`, `15-17`, `18-24`, `24-64`, `65+`, 
         Unknown.1, `Residential Treatment`, `Unstably Housed`, Unhoused, `Stably Housed`, 
         Unknown.2, `Veteran/Active Duty`, `Adult Family of Veteran/Active Duty`, `Child of Veteran/Active Duty`, `Non-Veteran/Active Duty`, 
         Unknown.3, Private, `Military Affiliated`, Medicaid, Uninsured, 
         Unkown, Court, `Fire Deparment`, `Hospital/ED`, `Law Enforcement`, `Other Healthcare Provider`, `Other Provider`, 
         `Outreach/Crises Response`, School, `Self/Family/Friend`, `Other -`) %>%
  mutate(`Unique Clients Served` = cumsum(`New Clients Served`))

APCC_long$Month <- c("September 2022", "October 2022", "November 2022", "December 2022", "January 2023", "February 2023",
                     "March 2023", "April 2023", "May 2023", "June 2023", "July 2023", "August 2023", "September 2023", "October 2023", "November 2023", 
                     "December 2023")

#add missing zip codes
missing_zips <- zips[-which(zips$Zip %in% colnames(APCC_long)),1] %>% 
  t(.) %>%
  row_to_names(row_number = 1) %>%
  as.data.frame()
missing_zips[1:nrow(APCC_long),] <- NA

APCC_long <- cbind(APCC_long, missing_zips)


APCC_long[,2:ncol(APCC_long)] <- mapply(as.numeric,APCC_long[,2:ncol(APCC_long)]) 

APCC_long$Program <- "Asia Pacific Cultural Center"

APCC_final <- pivot_longer(APCC_long, cols = -c(Month, Program), names_to = "Subgroup", values_to = "Count") %>%
   mutate(Group = case_when(Subgroup %in% c("Male", "Female", "Other") ~ "Gender",
                           Subgroup %in% c("Unhoused", "Unstably Housed", "Stably Housed", "Residential Treatment", "Unknown.1") ~ "Housing Status",
                           Subgroup %in% c("Private", "Uninsured", "Medicaid", "Military Affiliated", "Unknown.3") ~ "Health Insurance Status",
                           Subgroup %in% c("Veteran/Active Duty", "Adult Family of Veteran/Active Duty", "Child of Veteran/Active Duty",
                                           "Non-Veteran/Active Duty", "Unknown.2") ~ "Veteran Status",
                           grepl("9", Subgroup) | Subgroup %in% c("Outside of Pierce County", "Unknown") ~ "Clients Served by Zip Code",
                           Subgroup %in% c("Assessment - Mental Health", "Assessment - Substance Use Disorder", "Care Coordination", "Case Management", 
                                       "Crisis Services/Management", "Engagement and Outreach", "Family Treatment", "Group Treatment", 
                                       "Individual Treatment - Mental Health", "Individual Treatment - Substance Use Disorder", 
                                       "Individual Treatment - Other", "Medication Management", "Nursing Care", "Peer Support") ~ "Service Type",
                           Subgroup %in% c('0-14', "15-17", "18-24", "24-64", "65+") ~ "Age",
                           Subgroup %in% c("Black or African American", "American Indian/Alaskan Native", "Asian", 
                                           "Native Hawaiian / Pacific Islander", "Another Race", "Unknown/Unreported", "Two or More", 
                                           "White", "Unknown/Unreported.1", "Hispanic or Latino", "Non-Hispanic or Latino") ~ "Race/Ethnicity",
                           Subgroup %in% c("Unkown", "Court", "Fire Deparment", "Hospital/ED", "Law Enforcement", 
                                           "Other Healthcare Provider", "Other Provider", "Outreach/Crises Response", "School", 
                                           "Self/Family/Friend", "Other -") ~ "Referral Source",
                           
                           TRUE ~ Subgroup)) %>%
  select(Program, Month, Group, Subgroup, Count) 



```
#CLR-AOT
```{r}
clr_aot <- read_excel("N:/BNFFiles/Data Analytics/2024/673055_BehaviorHealth/Data/2021_2023/CLR-AOT/CLEANED_CLR AOT SC-109297 April 2023.xlsx", sheet = 7)

# transpose, rename columns, keep rows that are monthly counts, select relevant columns, calculate unique clients, change counts to numeric
clr_aot_long <- as.data.frame(t(clr_aot)) %>%
  row_to_names(row_number = 1) 

colnames(clr_aot_long)[5] <- "Month"
colnames(clr_aot_long)[7] <- "Total Clients Served"
colnames(clr_aot_long)[8] <- "New Clients Served"

clr_aot_long <- clr_aot_long[c(1:3, 5:7, 9:11, 13),]
colnames(clr_aot_long) <-  make.unique(colnames(clr_aot_long))

clr_aot_long$`Outside of Pierce County` <- NA
clr_aot_long$`Unknown Zip Code` <- NA


clr_aot_long <- clr_aot_long %>%
  select(Month, `Total Clients Served`, `New Clients Served`, 
         starts_with("9"), `Outside of Pierce County`, `Unknown Zip Code`,  
         `Case Management`, `Assessment - Substance Use Disorder`, `Care Coordination`, `Assessment - Mental Health`,
         `Crisis Services/Management`, 
         `Engagement and Outreach`, `Family Treatment`, `Group Treatment`,`Individual Treatment - Mental Health`, 
         `Individual Treatment - Substance Use Disorder`, `Individual Treatment - Other`, `Medication Management`, 
         `Nursing Care`, `Peer Support`, 
         Other, Female, Male, 
         `Black or African American`, `American Indian/Alaskan Native`, Asian, 
         `Native Hawaiian / Pacific Islander`, `Another Race`, `Unknown/Unreported`, `Two or More`, White, 
         `Hispanic or Latino`, 
         `0-14`, `15-17`, `18-24`, `24-64`, `65+`, 
         Unknown, `Residential Treatment`, `Unstably Housed`, Unhoused, `Stably Housed`, 
         Unknown.1, `Veteran/Active Duty`, `Adult Family of Veteran/Active Duty`, `Child of Veteran/Active Duty`,
         `Non-Veteran/Active Duty`, 
         Unknown.2, Private, `Military Affiliated`, Medicaid, Uninsured, 
         Unknown.3, Court, `Fire Deparment`, `Hospital/ED`, `Law Enforcement`, `Other Healthcare Provider`, `Other Provider`, 
         `Outreach/Crises Response`, School, `Self/Family/Friend`, `Other -`) %>%
  mutate(`Unique Clients Served` = cumsum(`New Clients Served`))
         
clr_aot_long$Month <- c("July 2022", "August 2022","September 2022", "October 2022", "November 2022", "December 2022", 
                        "January 2023", "February 2023", "March 2023", "April 2023")


#add missing zip codes
missing_zips <- zips[-which(zips$Zip %in% colnames(clr_aot_long)),1] %>% 
  t(.) %>%
  row_to_names(row_number = 1) %>%
  as.data.frame()
missing_zips[1:nrow(clr_aot_long),] <- NA

clr_aot_long <- cbind(clr_aot_long, missing_zips)


clr_aot_long[,2:ncol(clr_aot_long)] <- mapply(as.numeric,clr_aot_long[,2:ncol(clr_aot_long)]) 

clr_aot_long$Program <- "Comprehensive Life Resources - Assisted Outpatient Treatment"

clr_aot_final <- pivot_longer(clr_aot_long, cols = -c(Month, Program), names_to = "Subgroup", values_to = "Count") %>%
   mutate(Group = case_when(Subgroup %in% c("Male", "Female", "Other") ~ "Gender",
                           Subgroup %in% c("Unhoused", "Unstably Housed", "Stably Housed", "Residential Treatment", "Unknown") ~ "Housing Status",
                           Subgroup %in% c("Private", "Uninsured", "Medicaid", "Military Affiliated", "Unknown.2") ~ "Health Insurance Status",
                           Subgroup %in% c("Veteran/Active Duty", "Adult Family of Veteran/Active Duty", "Child of Veteran/Active Duty",
                                           "Non-Veteran/Active Duty", "Unknown.1") ~ "Veteran Status",
                           grepl("9", Subgroup) | Subgroup %in% c("Outside of Pierce County", "Unknown Zip Code") ~ "Clients Served by Zip Code",
                           Subgroup %in% c("Assessment - Mental Health", "Assessment - Substance Use Disorder", "Care Coordination", "Case Management", 
                                       "Crisis Services/Management", "Engagement and Outreach", "Family Treatment", "Group Treatment", 
                                       "Individual Treatment - Mental Health", "Individual Treatment - Substance Use Disorder", 
                                       "Individual Treatment - Other", "Medication Management", "Nursing Care", "Peer Support") ~ "Service Type",
                           Subgroup %in% c('0-14', "15-17", "18-24", "24-64", "65+") ~ "Age",
                           Subgroup %in% c("Black or African American", "American Indian/Alaskan Native", "Asian", 
                                           "Native Hawaiian / Pacific Islander", "Another Race", "Unknown/Unreported", "Two or More", 
                                           "White", "Hispanic or Latino") ~ "Race/Ethnicity",
                           Subgroup %in% c("Unknown.3", "Court", "Fire Deparment", "Hospital/ED", "Law Enforcement", 
                                           "Other Healthcare Provider", "Other Provider", "Outreach/Crises Response", "School", 
                                           "Self/Family/Friend", "Other -") ~ "Referral Source",
                           
                           TRUE ~ Subgroup)) %>%
  select(Program, Month, Group, Subgroup, Count) 

```


# Pierce County Alliance - Wraparound Mental Health Court

```{r}
#read in output report
PCA_WMHC <- read_excel("N:/BNFFiles/Data Analytics/2024/673055_BehaviorHealth/Data/2021_2023/PCA - MHC/Cleaned_December_2023_MHC.xlsx")


# transpose, rename columns, keep rows that are monthly counts, select relevant columns, calculate unique clients, change counts to numeric
PCA_WMHC_long <- as.data.frame(t(PCA_WMHC)) %>%
  row_to_names(row_number = 1) 


colnames(PCA_WMHC_long)[3] <- "Month"
colnames(PCA_WMHC_long)[6] <- "Total Clients Served"
colnames(PCA_WMHC_long)[7] <- "New Clients Served"

PCA_WMHC_long <- PCA_WMHC_long[c(1:3, 5:7, 9:11, 13:15, 17:19, 21:23),]


PCA_WMHC_long$`Unknown Zip Code` <- NA
PCA_WMHC_long$`Individual Treatment - Other` <- NA
PCA_WMHC_long$`Residential Treatment` <- NA
PCA_WMHC_long$`Unstably Housed` <- NA
PCA_WMHC_long$Unhoused <- NA
PCA_WMHC_long$`Stably Housed` <- NA
PCA_WMHC_long$Unkown <- NA
PCA_WMHC_long$`Fire Deparment` <- NA
PCA_WMHC_long$`Other -` <- NA

colnames(PCA_WMHC_long) <-  make.unique(colnames(PCA_WMHC_long))


PCA_WMHC_long <- PCA_WMHC_long %>%
  select(Month, `Total Clients Served`, `New Clients Served`, 
         starts_with("9"), `Outside of Pierce County`, `Unknown Zip Code`,  
         `Case Management`, `Assessment - Substance Use Disorder`, `Care Coordination`, `Assessment - Mental Health`, `Crisis Services/Management`, 
         `Engagement and Outreach`, `Family Treatment`, `Group Treatment`,`Individual Treatment - Mental Health`, 
         `Individual Treatment - Substance Use Disorder`, `Individual Treatment - Other`, `Medication Management`, 
         `Nursing Care`, `Peer Support`, 
         Other, Female, Male, 
         `Black or African American`, `American Indian/Alaskan Native`, Asian, 
         `Native Hawaiian / Pacific Islander`, `Another Race`, `Unknown/Unreported`, `Two or More`, White, `Unknown/Unreported.1`, `Hispanic or Latino`,
         `Non-Hispanic or Latino`, 
         `0-14`, `15-17`, `18-24`, `25-64`, `65+`, 
         Unknown, `Residential Treatment`, `Unstably Housed`, Unhoused, `Stably Housed`, 
         Unknown.1, `Veteran/Active Duty`, `Adult Family of Veteran/Active Duty`, `Child of Veteran/Active Duty`, `Non-Veteran/Active Duty`, 
         Unknown.2, Private, `Military Affiliated`, Medicaid, Uninsured, 
         Unkown, Court, `Fire Deparment`, `Hospital/ED`, `Law Enforcement`, `Other Healthcare Provider`, `Other Provider`, 
         `Outreach/Crises Response`, School, `Self/Family/Friend`, `Other -`) %>%
  mutate(`Unique Clients Served` = cumsum(`New Clients Served`))


PCA_WMHC_long$Month <- c("July 2022", "August 2022","September 2022", "October 2022", "November 2022", "December 2022", "January 2023", "February 2023",
                     "March 2023", "April 2023", "May 2023", "June 2023", "July 2023", "August 2023", "September 2023", "October 2023", "November 2023", 
                     "December 2023")


#add missing zip codes
missing_zips <- zips[-which(zips$Zip %in% colnames(PCA_WMHC_long)),1] %>% 
  t(.) %>%
  row_to_names(row_number = 1) %>%
  as.data.frame()
missing_zips[1:nrow(PCA_WMHC_long),] <- NA

PCA_WMHC_long <- cbind(PCA_WMHC_long, missing_zips)


PCA_WMHC_long[,2:ncol(PCA_WMHC_long)] <- mapply(as.numeric,PCA_WMHC_long[,2:ncol(PCA_WMHC_long)]) 

PCA_WMHC_long$Program <- "Pierce County Alliance - Wraparound Mental Health Court"

PCA_WMHC_final <- pivot_longer(PCA_WMHC_long, cols = -c(Month, Program), names_to = "Subgroup", values_to = "Count") %>%
   mutate(Group = case_when(Subgroup %in% c("Male", "Female", "Other") ~ "Gender",
                           Subgroup %in% c("Unhoused", "Unstably Housed", "Stably Housed", "Residential Treatment", "Unknown") ~ "Housing Status",
                           Subgroup %in% c("Private", "Uninsured", "Medicaid", "Military Affiliated", "Unknown.2") ~ "Health Insurance Status",
                           Subgroup %in% c("Veteran/Active Duty", "Adult Family of Veteran/Active Duty", "Child of Veteran/Active Duty",
                                           "Non-Veteran/Active Duty", "Unknown.1") ~ "Veteran Status",
                           grepl("9", Subgroup) | Subgroup %in% c("Outside of Pierce County", "Unknown Zip Code") ~ "Clients Served by Zip Code",
                           Subgroup %in% c("Assessment - Mental Health", "Assessment - Substance Use Disorder", "Care Coordination", "Case Management", 
                                       "Crisis Services/Management", "Engagement and Outreach", "Family Treatment", "Group Treatment", 
                                       "Individual Treatment - Mental Health", "Individual Treatment - Substance Use Disorder", 
                                       "Individual Treatment - Other", "Medication Management", "Nursing Care", "Peer Support") ~ "Service Type",
                           Subgroup %in% c('0-14', "15-17", "18-24", "25-64", "65+") ~ "Age",
                           Subgroup %in% c("Black or African American", "American Indian/Alaskan Native", "Asian", 
                                           "Native Hawaiian / Pacific Islander", "Another Race", "Unknown/Unreported", "Two or More", 
                                           "White", "Unknown/Unreported.1", "Hispanic or Latino", "Non-Hispanic or Latino") ~ "Race/Ethnicity",
                           Subgroup %in% c("Unkown", "Court", "Fire Deparment", "Hospital/ED", "Law Enforcement", 
                                           "Other Healthcare Provider", "Other Provider", "Outreach/Crises Response", "School", 
                                           "Self/Family/Friend", "Other -") ~ "Referral Source",
                           
                           TRUE ~ Subgroup)) %>%
  select(Program, Month, Group, Subgroup, Count) 



```

#Seneca - Therapeutic Case Management

```{r}
tcm <- read_excel("N:/BNFFiles/Data Analytics/2024/673055_BehaviorHealth/Data/2021_2023/Seneca - TCM/SC-109308_Seneca_FINAL_CPR - TCM Dec23.xlsx", sheet = 7)

# transpose, rename columns, keep rows that are monthly counts, select relevant columns, calculate unique clients, change counts to numeric
tcm_long <- as.data.frame(t(tcm)) %>%
  row_to_names(row_number = 1) 


colnames(tcm_long)[5] <- "Month"
colnames(tcm_long)[7] <- "Total Clients Served"
colnames(tcm_long)[8] <- "New Clients Served"

tcm_long <- tcm_long[c(1:3, 5:7, 9:11, 13:15, 17:19, 21:23),]
colnames(tcm_long) <-  make.unique(colnames(tcm_long))

tcm_long$`Outside of Pierce County` <- NA
tcm_long$`Unknown Zip Code` <- NA


tcm_long <- tcm_long %>%
  select(Month, `Total Clients Served`, `New Clients Served`, 
         starts_with("9"), `Outside of Pierce County`, `Unknown Zip Code`,  
         `Case Management`, `Assessment - Substance Use Disorder`, `Care Coordination`, `Assessment - Mental Health`, `Crisis Services/Management`, 
         `Engagement and Outreach`, `Family Treatment`, `Group Treatment`,`Individual Treatment - Mental Health`, 
         `Individual Treatment - Substance Use Disorder`, `Individual Treatment - Other`, `Medication Management`, 
         `Nursing Care`, `Peer Support`, 
         Other, Female, Male, 
         `Black or African American`, `American Indian/Alaskan Native`, Asian, 
         `Native Hawaiian / Pacific Islander`, `Another Race`, `Unknown/Unreported`, `Two or More`, White, 
         `Hispanic or Latino`,
         `0-14`, `15-17`, `18-24`, `24-64`, `65+`, 
         Unknown, `Residential Treatment`, `Unstably Housed`, Unhoused, `Stably Housed`, 
         Unknown.1, `Veteran/Active Duty`, `Adult Family of Veteran/Active Duty`, `Child of Veteran/Active Duty`, `Non-Veteran/Active Duty`, 
         Unknown.2, Private, `Military Affiliated`, Medicaid, Uninsured, 
         Unkown, Court, `Fire Deparment`, `Hospital/ED`, `Law Enforcement`, `Other Healthcare Provider`, `Other Provider`, 
         `Outreach/Crises Response`, School, `Self/Family/Friend`, `Other -`) %>%
  mutate(`Unique Clients Served` = cumsum(`New Clients Served`))


tcm_long$Month <- c("July 2022","August 2022","September 2022", "October 2022", "November 2022", "December 2022", "January 2023", "February 2023",
                     "March 2023", "April 2023", "May 2023", "June 2023", "July 2023", "August 2023", "September 2023", "October 2023", "November 2023", 
                     "December 2023")

#add missing zip codes
missing_zips <- zips[-which(zips$Zip %in% colnames(tcm_long)),1] %>% 
  t(.) %>%
  row_to_names(row_number = 1) %>%
  as.data.frame()
missing_zips[1:nrow(tcm_long),] <- NA

tcm_long <- cbind(tcm_long, missing_zips)


tcm_long[,2:ncol(tcm_long)] <- mapply(as.numeric,tcm_long[,2:ncol(tcm_long)]) 

tcm_long$Program <- "Seneca - Therapeutic Case Management"

tcm_final <- pivot_longer(tcm_long, cols = -c(Month, Program), names_to = "Subgroup", values_to = "Count") %>%
   mutate(Group = case_when(Subgroup %in% c("Male", "Female", "Other") ~ "Gender",
                           Subgroup %in% c("Unhoused", "Unstably Housed", "Stably Housed", "Residential Treatment", "Unknown") ~ "Housing Status",
                           Subgroup %in% c("Private", "Uninsured", "Medicaid", "Military Affiliated", "Unknown.2") ~ "Health Insurance Status",
                           Subgroup %in% c("Veteran/Active Duty", "Adult Family of Veteran/Active Duty", "Child of Veteran/Active Duty",
                                           "Non-Veteran/Active Duty", "Unknown.1") ~ "Veteran Status",
                           grepl("9", Subgroup) | Subgroup %in% c("Outside of Pierce County", "Unknown Zip Code") ~ "Clients Served by Zip Code",
                           Subgroup %in% c("Assessment - Mental Health", "Assessment - Substance Use Disorder", "Care Coordination", "Case Management", 
                                       "Crisis Services/Management", "Engagement and Outreach", "Family Treatment", "Group Treatment", 
                                       "Individual Treatment - Mental Health", "Individual Treatment - Substance Use Disorder", 
                                       "Individual Treatment - Other", "Medication Management", "Nursing Care", "Peer Support") ~ "Service Type",
                           Subgroup %in% c('0-14', "15-17", "18-24", "24-64", "65+") ~ "Age",
                           Subgroup %in% c("Black or African American", "American Indian/Alaskan Native", "Asian", 
                                           "Native Hawaiian / Pacific Islander", "Another Race", "Unknown/Unreported", "Two or More", 
                                           "White", "Hispanic or Latino") ~ "Race/Ethnicity",
                           Subgroup %in% c("Unkown", "Court", "Fire Deparment", "Hospital/ED", "Law Enforcement", 
                                           "Other Healthcare Provider", "Other Provider", "Outreach/Crises Response", "School", 
                                           "Self/Family/Friend", "Other -") ~ "Referral Source",
                           
                           TRUE ~ Subgroup)) %>%
  select(Program, Month, Group, Subgroup, Count) 




```



# CLR School

```{r}
clr_school <- read_excel("N:/BNFFiles/Data Analytics/2024/673055_BehaviorHealth/Data/2021_2023/CLR School-based/BH-189-Comprehensive Life Resources-SC-109299 12.2023.xlsx", 
                         sheet = 7)

# transpose, rename columns, keep rows that are monthly counts, select relevant columns, calculate unique clients, change counts to numeric
clr_school_long <- as.data.frame(t(clr_school)) %>%
  row_to_names(row_number = 1) 

colnames(clr_school_long)[5] <- "Month"
colnames(clr_school_long)[8] <- "Total Clients Served"
colnames(clr_school_long)[9] <- "New Clients Served"


clr_school_long <- clr_school_long[c(1:3, 5:7, 9:11, 13:15, 17:19, 21:23),]
colnames(clr_school_long) <-  make.unique(colnames(clr_school_long))

clr_school_long <- clr_school_long %>%
  select(Month, `Total Clients Served`, `New Clients Served`, starts_with("9"), `Outside of Pierce County`, Unknown, 
         `Case Management`, `Assessment - Substance Use Disorder`, `Care Coordination`, `Assessment - Mental Health`, 
         `Crisis Services/Management`, `Engagement and Outreach`, `Family Treatment`, `Group Treatment`,
         `Individual Treatment - Mental Health`, `Individual Treatment - Substance Use Disorder`, `Medication Management`, 
         `Nursing Care`, `Peer Support`, 
         Other, Female, Male, 
         `Black or African American`, `American Indian/Alaskan Native`, Asian, 
         `Native Hawaiian / Pacific Islander`, `Another Race`, `Unknown/Unreported`, `Two or More`, White, `Unknown/Unreported.1`, `Hispanic or Latino`,
         `Non-Hispanic or Latino`, 
         `0-14`, `15-17`, `18-24`, `24-64`, `65+`, 
         Unknown.1, `Residential Treatment`, `Unstably Housed`, Unhoused, `Stably Housed`, 
         Unknown.2, `Veteran/Active Duty`, `Adult Family of Veteran/Active Duty`, `Child of Veteran/Active Duty`, `Non-Veteran/Active Duty`, 
         Unknown.3, Private, `Military Affiliated`, Medicaid, Uninsured, 
         Unknown.4, Court, `Fire Deparment`, `Hospital/ED`, `Law Enforcement`, `Other Healthcare Provider`, 
         `Other Provider`, `Outreach/Crises Response`, School, `Self/Family/Friend`, `Other -`) %>%
   mutate(`Unique Clients Served` = cumsum(`New Clients Served`))

clr_school_long$Month <- c("July 2022","August 2022","September 2022", "October 2022", "November 2022", "December 2022", "January 2023", "February 2023",
                     "March 2023", "April 2023", "May 2023", "June 2023", "July 2023", "August 2023", "September 2023", "October 2023", "November 2023", 
                     "December 2023")


#add missing zip codes
missing_zips <- zips[-which(zips$Zip %in% colnames(clr_school_long)),1] %>% 
  t(.) %>%
  row_to_names(row_number = 1) %>%
  as.data.frame()
missing_zips[1:nrow(clr_school_long),] <- 0

clr_school_long <- cbind(clr_school_long, missing_zips)

#make columns numeric
clr_school_long[,2:ncol(clr_school_long)] <- mapply(as.numeric,clr_school_long[,2:ncol(clr_school_long)]) 

clr_school_long$Program <- "Comprehensive Life Resources - School Connect"

clr_school_final <- pivot_longer(clr_school_long, cols = -c(Month, Program), names_to = "Subgroup", values_to = "Count") %>%
   mutate(Group = case_when(Subgroup %in% c("Male", "Female", "Other") ~ "Gender",
                           Subgroup %in% c("Unhoused", "Unstably Housed", "Stably Housed", "Residential Treatment", "Unknown.1") ~ "Housing Status",
                           Subgroup %in% c("Private", "Uninsured", "Medicaid", "Military Affiliated", "Unknown.3") ~ "Health Insurance Status",
                           Subgroup %in% c("Veteran/Active Duty", "Adult Family of Veteran/Active Duty", "Child of Veteran/Active Duty",
                                           "Non-Veteran/Active Duty", "Unknown.2") ~ "Veteran Status",
                           grepl("9", Subgroup) | Subgroup %in% c("Outside of Pierce County", "Unknown") ~ "Clients Served by Zip Code",
                           Subgroup %in% c("Assessment - Mental Health", "Assessment - Substance Use Disorder", "Care Coordination", "Case Management", 
                                       "Crisis Services/Management", "Engagement and Outreach", "Family Treatment", "Group Treatment", 
                                       "Individual Treatment - Mental Health", "Individual Treatment - Substance Use Disorder", 
                                       "Individual Treatment - Other", "Medication Management", "Nursing Care", "Peer Support") ~ "Service Type",
                           Subgroup %in% c('0-14', "15-17", "18-24", "24-64", "65+") ~ "Age",
                           Subgroup %in% c("Black or African American", "American Indian/Alaskan Native", "Asian", 
                                           "Native Hawaiian / Pacific Islander", "Another Race", "Unknown/Unreported", "Two or More", 
                                           "White", "Unknown/Unreported.1", "Hispanic or Latino", "Non-Hispanic or Latino") ~ "Race/Ethnicity",
                           Subgroup %in% c("Unkown", "Court", "Fire Deparment", "Hospital/ED", "Law Enforcement", 
                                           "Other Healthcare Provider", "Other Provider", "Outreach/Crises Response", "School", 
                                           "Self/Family/Friend", "Other -") ~ "Referral Source",
                           
                           TRUE ~ Subgroup)) %>%
  select(Program, Month, Group, Subgroup, Count) 


```


# communities in schools of Lakewood

```{r}
csl <- read_excel("N:/BNFFiles/Data Analytics/2024/673055_BehaviorHealth/Data/2021_2023/Communities in Schools - Lakewood/Copy of CISL Dec 2023 Output Report.xlsx")

# transpose, rename columns, keep rows that are monthly counts, select relevant columns, calculate unique clients, change counts to numeric
csl_long <- as.data.frame(t(csl)) %>%
  row_to_names(row_number = 1) 


colnames(csl_long)[5] <- "Month"
colnames(csl_long)[8] <- "Total Clients Served"
colnames(csl_long)[9] <- "New Clients Served"

csl_long <- csl_long[c(1:3,5:7,9:11, 13:15, 17:19, 21:23),]
colnames(csl_long) <-  make.unique(colnames(csl_long))

csl_long$`Outside of Pierce County` <- NA
csl_long$`Unknown/Unreported.1` <- NA
csl_long$`Non-Hispanic or Latino` <- NA



csl_long <- csl_long %>%
  select(Month, `Total Clients Served`, `New Clients Served`, 
         starts_with("9"), `Outside of Pierce County`, Unknown,  
         `Case Management`, `Assessment - Substance Use Disorder`, `Care Coordination`, `Assessment - Mental Health`, `Crisis Services/Management`, 
         `Engagement and Outreach`, `Family Treatment`, `Group Treatment`,`Individual Treatment - Mental Health`, 
         `Individual Treatment - Substance Use Disorder`, `Individual Treatment - Other`, `Medication Management`, 
         `Nursing Care`, `Peer Support`, 
         Other, Female, Male, 
         `Black or African American`, `American Indian/Alaskan Native`, Asian, 
         `Native Hawaiian / Pacific Islander`, `Another Race`, `Unknown/Unreported`, `Two or More`, White, `Unknown/Unreported.1`, `Hispanic or Latino`,
         `Non-Hispanic or Latino`, 
         `0-14`, `15-17`, `18-24`, `24-64`, `65+`, 
         Unknown.1, `Residential Treatment`, `Unstably Housed`, Unhoused, `Stably Housed`, 
         Unknown.2, `Veteran/Active Duty`, `Adult Family of Veteran/Active Duty`, `Child of Veteran/Active Duty`, `Non-Veteran/Active Duty`, 
         Unknown.3, Private, `Military Affiliated`, Medicaid, Uninsured, 
         Unkown, Court, `Fire Deparment`, `Hospital/ED`, `Law Enforcement`, `Other Healthcare Provider`, `Other Provider`, 
         `Outreach/Crises Response`, School, `Self/Family/Friend`, `Other -`) %>%
  mutate(`Unique Clients Served` = cumsum(`New Clients Served`))

csl_long$Month <- c("July 2022","August 2022","September 2022", "October 2022", "November 2022", "December 2022", "January 2023", "February 2023",
                     "March 2023", "April 2023", "May 2023", "June 2023", "July 2023", "August 2023", "September 2023", "October 2023", "November 2023", 
                     "December 2023")


#add missing zip codes
missing_zips <- zips[-which(zips$Zip %in% colnames(csl_long)),1] %>% 
  t(.) %>%
  row_to_names(row_number = 1) %>%
  as.data.frame()
missing_zips[1:nrow(csl_long),] <- NA

csl_long <- cbind(csl_long, missing_zips)


csl_long[,2:ncol(csl_long)] <- mapply(as.numeric,csl_long[,2:ncol(csl_long)]) 

csl_long$Program <- "Communities in Schools of Lakewood"

csl_final <- pivot_longer(csl_long, cols = -c(Month, Program), names_to = "Subgroup", values_to = "Count") %>%
   mutate(Group = case_when(Subgroup %in% c("Male", "Female", "Other") ~ "Gender",
                           Subgroup %in% c("Unhoused", "Unstably Housed", "Stably Housed", "Residential Treatment", "Unknown.1") ~ "Housing Status",
                           Subgroup %in% c("Private", "Uninsured", "Medicaid", "Military Affiliated", "Unknown.3") ~ "Health Insurance Status",
                           Subgroup %in% c("Veteran/Active Duty", "Adult Family of Veteran/Active Duty", "Child of Veteran/Active Duty",
                                           "Non-Veteran/Active Duty", "Unknown.2") ~ "Veteran Status",
                           grepl("9", Subgroup) | Subgroup %in% c("Outside of Pierce County", "Unknown") ~ "Clients Served by Zip Code",
                           Subgroup %in% c("Assessment - Mental Health", "Assessment - Substance Use Disorder", "Care Coordination", "Case Management", 
                                       "Crisis Services/Management", "Engagement and Outreach", "Family Treatment", "Group Treatment", 
                                       "Individual Treatment - Mental Health", "Individual Treatment - Substance Use Disorder", 
                                       "Individual Treatment - Other", "Medication Management", "Nursing Care", "Peer Support") ~ "Service Type",
                           Subgroup %in% c('0-14', "15-17", "18-24", "24-64", "65+") ~ "Age",
                           Subgroup %in% c("Black or African American", "American Indian/Alaskan Native", "Asian", 
                                           "Native Hawaiian / Pacific Islander", "Another Race", "Unknown/Unreported", "Two or More", 
                                           "White", "Unknown/Unreported.1", "Hispanic or Latino", "Non-Hispanic or Latino") ~ "Race/Ethnicity",
                           Subgroup %in% c("Unkown", "Court", "Fire Deparment", "Hospital/ED", "Law Enforcement", 
                                           "Other Healthcare Provider", "Other Provider", "Outreach/Crises Response", "School", 
                                           "Self/Family/Friend", "Other -") ~ "Referral Source",
                           
                           TRUE ~ Subgroup)) %>%
  select(Program, Month, Group, Subgroup, Count) 



```



#mary bridge - YES

```{r}
yes <- read_excel("N:/BNFFiles/Data Analytics/2024/673055_BehaviorHealth/Data/2021_2023/Multicare - YES/BH-189-Mary Bridge Children's Hospital-SC-109303-DEC 2023 Final.xlsx", sheet = 7)

# transpose, rename columns, keep rows that are monthly counts, select relevant columns, calculate unique clients, change counts to numeric
yes_long <- as.data.frame(t(yes)) %>%
  row_to_names(row_number = 1) 


colnames(yes_long)[5] <- "Month"
colnames(yes_long)[8] <- "Total Clients Served"
colnames(yes_long)[9] <- "New Clients Served"

yes_long <- yes_long[c(9,10, 11, 13, 14, 15, 17:19, 21:23),]
colnames(yes_long) <-  make.unique(colnames(yes_long))

yes_long$`Outside of Pierce County` <- NA
yes_long$`Unknown/Unreported.1` <- NA
yes_long$`Non-Hispanic or Latino` <- NA
names(yes_long)[names(yes_long) == "Unknown"] <- "Unknown Zip Code"


yes_long <- yes_long %>%
  select(Month, `Total Clients Served`, `New Clients Served`, 
         starts_with("9"), `Outside of Pierce County`, `Unknown Zip Code`,  
         `Case Management`, `Assessment - Substance Use Disorder`, `Care Coordination`, `Assessment - Mental Health`, `Crisis Services/Management`, 
         `Engagement and Outreach`, `Family Treatment`, `Group Treatment`,`Individual Treatment - Mental Health`, 
         `Individual Treatment - Substance Use Disorder`, `Individual Treatment - Other`, `Medication Management`, 
         `Nursing Care`, `Peer Support`, 
         Other, Female, Male, 
         `Black or African American`, `American Indian/Alaskan Native`, Asian, 
         `Native Hawaiian / Pacific Islander`, `Another Race`, `Unknown/Unreported`, `Two or More`, White, `Unknown/Unreported.1`, `Hispanic or Latino`,
         `Non-Hispanic or Latino`, 
         `0-14`, `15-17`, `18-24`, `24-64`, `65+`, 
         Unknown.1, `Residential Treatment`, `Unstably Housed`, Unhoused, `Stably Housed`, 
         Unknown.2, `Veteran/Active Duty`, `Adult Family of Veteran/Active Duty`, `Child of Veteran/Active Duty`, `Non-Veteran/Active Duty`, 
         Unknown.3, Private, `Military Affiliated`, Medicaid, Uninsured, 
         Unknown.4, Court, `Fire Deparment`, `Hospital/ED`, `Law Enforcement`, `Other Healthcare Provider`, `Other Provider`, 
         `Outreach/Crises Response`, School, `Self/Family/Friend`, `Other -`) %>%
  mutate(`Unique Clients Served` = cumsum(`New Clients Served`))

yes_long$Month <- c("January 2023", "February 2023","March 2023", "April 2023", "May 2023", "June 2023", "July 2023", "August 2023", "September 2023", "October 2023", "November 2023", "December 2023")

#add missing zip codes
missing_zips <- zips[-which(zips$Zip %in% colnames(yes_long)),1] %>% 
  t(.) %>%
  row_to_names(row_number = 1) %>%
  as.data.frame()
missing_zips[1:nrow(yes_long),] <- NA

yes_long <- cbind(yes_long, missing_zips)


yes_long[,2:ncol(yes_long)] <- mapply(as.numeric,yes_long[,2:ncol(yes_long)]) 

yes_long$Program <- "Mary Bridge - Youth Engagement Services"

yes_final <- pivot_longer(yes_long, cols = -c(Month, Program), names_to = "Subgroup", values_to = "Count") %>%
   mutate(Group = case_when(Subgroup %in% c("Male", "Female", "Other") ~ "Gender",
                           Subgroup %in% c("Unhoused", "Unstably Housed", "Stably Housed", "Residential Treatment", "Unknown.1") ~ "Housing Status",
                           Subgroup %in% c("Private", "Uninsured", "Medicaid", "Military Affiliated", "Unknown.3") ~ "Health Insurance Status",
                           Subgroup %in% c("Veteran/Active Duty", "Adult Family of Veteran/Active Duty", "Child of Veteran/Active Duty",
                                           "Non-Veteran/Active Duty", "Unknown.2") ~ "Veteran Status",
                           grepl("9", Subgroup) | Subgroup %in% c("Outside of Pierce County", "Unknown Zip Code") ~ "Clients Served by Zip Code",
                           Subgroup %in% c("Assessment - Mental Health", "Assessment - Substance Use Disorder", "Care Coordination", "Case Management", 
                                       "Crisis Services/Management", "Engagement and Outreach", "Family Treatment", "Group Treatment", 
                                       "Individual Treatment - Mental Health", "Individual Treatment - Substance Use Disorder", 
                                       "Individual Treatment - Other", "Medication Management", "Nursing Care", "Peer Support") ~ "Service Type",
                           Subgroup %in% c('0-14', "15-17", "18-24", "24-64", "65+") ~ "Age",
                           Subgroup %in% c("Black or African American", "American Indian/Alaskan Native", "Asian", 
                                           "Native Hawaiian / Pacific Islander", "Another Race", "Unknown/Unreported", "Two or More", 
                                           "White", "Unknown/Unreported.1", "Hispanic or Latino", "Non-Hispanic or Latino") ~ "Race/Ethnicity",
                           Subgroup %in% c("Unknown.4", "Court", "Fire Deparment", "Hospital/ED", "Law Enforcement", 
                                           "Other Healthcare Provider", "Other Provider", "Outreach/Crises Response", "School", 
                                           "Self/Family/Friend", "Other -") ~ "Referral Source",
                           
                           TRUE ~ Subgroup)) %>%
  select(Program, Month, Group, Subgroup, Count) 



```



#Seneca WISe

```{r}
wise <- read_excel("N:/BNFFiles/Data Analytics/2024/673055_BehaviorHealth/Data/2021_2023/Seneca-WISe/SC-109309_Seneca_FINAL_CPR - WISe Dec23.xlsx", sheet = 7)

wise_long <- as.data.frame(t(wise)) %>%
  row_to_names(row_number = 1) 

colnames(wise_long)[5] <- "Month"
colnames(wise_long)[7] <- "Total Clients Served"
colnames(wise_long)[8] <- "New Clients Served"


wise_long <- wise_long[c(1:3,5,6, 7, 9, 10, 11, 13:15, 17:19, 21:23),]
colnames(wise_long) <-  make.unique(colnames(wise_long))

wise_long$`Outside of Pierce County` <- NA
wise_long$`Unknown Zip Code` <-  NA
wise_long$`Unknown/Unreported.1` <- NA
wise_long$`Non-Hispanic or Latino` <- NA 

wise_long <- wise_long %>%
  select(Month, `Total Clients Served`, `New Clients Served`, starts_with("9"), `Outside of Pierce County`, `Unknown Zip Code`,  
         `Case Management`, `Assessment - Substance Use Disorder`, `Care Coordination`, `Assessment - Mental Health`, 
         `Crisis Services/Management`, `Engagement and Outreach`, `Family Treatment`, `Group Treatment`,
         `Individual Treatment - Mental Health`, `Individual Treatment - Substance Use Disorder`, `Individual Treatment - Other`, `Medication Management`, 
         `Nursing Care`, `Peer Support`, 
         Other, Female, Male, 
         `Black or African American`, `American Indian/Alaskan Native`, Asian, 
         `Native Hawaiian / Pacific Islander`, `Another Race`, `Unknown/Unreported`, `Two or More`, White, `Unknown/Unreported.1`, `Hispanic or Latino`,
         `Non-Hispanic or Latino`, 
         `0-14`, `15-17`, `18-24`, `24-64`, `65+`, 
         Unknown, `Residential Treatment`, `Unstably Housed`, Unhoused, `Stably Housed`, 
         Unknown.1, `Veteran/Active Duty`, `Adult Family of Veteran/Active Duty`, `Child of Veteran/Active Duty`, `Non-Veteran/Active Duty`, 
         Unknown.2, Private, `Military Affiliated`, Medicaid, Uninsured, 
         Unkown, Court, `Fire Deparment`, `Hospital/ED`, `Law Enforcement`, `Other Healthcare Provider`, 
         `Other Provider`, `Outreach/Crises Response`, School, `Self/Family/Friend`, `Other -`) %>%
  mutate(`Unique Clients Served` = cumsum(`New Clients Served`))

wise_long$Month <- c("July 2022","August 2022","September 2022", "October 2022", "November 2022", "December 2022", "January 2023", "February 2023",
                     "March 2023", "April 2023", "May 2023", "June 2023", "July 2023", "August 2023", "September 2023", "October 2023", "November 2023", 
                     "December 2023")


#add missing zip codes
missing_zips <- zips[-which(zips$Zip %in% colnames(wise_long)),1] %>% 
  t(.) %>%
  row_to_names(row_number = 1) %>%
  as.data.frame()
missing_zips[1:nrow(wise_long),] <- NA

wise_long <- cbind(wise_long, missing_zips)

#make columns numeric
wise_long[,2:ncol(wise_long)] <- mapply(as.numeric,wise_long[,2:ncol(wise_long)]) 

wise_long$Program <- "Seneca - Wraparound with Intensive Services"

wise_final <- pivot_longer(wise_long, cols = -c(Month, Program), names_to = "Subgroup", values_to = "Count") %>%
   mutate(Group = case_when(Subgroup %in% c("Male", "Female", "Other") ~ "Gender",
                           Subgroup %in% c("Unhoused", "Unstably Housed", "Stably Housed", "Residential Treatment", "Unknown") ~ "Housing Status",
                           Subgroup %in% c("Private", "Uninsured", "Medicaid", "Military Affiliated", "Unknown.2") ~ "Health Insurance Status",
                           Subgroup %in% c("Veteran/Active Duty", "Adult Family of Veteran/Active Duty", "Child of Veteran/Active Duty",
                                           "Non-Veteran/Active Duty", "Unknown.1") ~ "Veteran Status",
                           grepl("9", Subgroup) | Subgroup %in% c("Outside of Pierce County", "Unknown Zip Code") ~ "Clients Served by Zip Code",
                           Subgroup %in% c("Assessment - Mental Health", "Assessment - Substance Use Disorder", "Care Coordination", "Case Management", 
                                       "Crisis Services/Management", "Engagement and Outreach", "Family Treatment", "Group Treatment", 
                                       "Individual Treatment - Mental Health", "Individual Treatment - Substance Use Disorder", 
                                       "Individual Treatment - Other", "Medication Management", "Nursing Care", "Peer Support") ~ "Service Type",
                           Subgroup %in% c('0-14', "15-17", "18-24", "24-64", "65+") ~ "Age",
                           Subgroup %in% c("Black or African American", "American Indian/Alaskan Native", "Asian", 
                                           "Native Hawaiian / Pacific Islander", "Another Race", "Unknown/Unreported", "Two or More", 
                                           "White", "Unknown/Unreported.1", "Hispanic or Latino", "Non-Hispanic or Latino") ~ "Race/Ethnicity",
                           Subgroup %in% c("Unkown", "Other -Church", "Court", "Fire Deparment", "Hospital/ED", "Law Enforcement", 
                                           "Other Healthcare Provider", "Other Provider", "Outreach/Crises Response", "School", 
                                           "Self/Family/Friend", "Other -") ~ "Referral Source",
                           
                           TRUE ~ Subgroup)) %>%
  select(Program, Month, Group, Subgroup, Count) 



```



#TPCHD-Nurse

```{r}
nurse <- read_excel("N:/BNFFiles/Data Analytics/2024/673055_BehaviorHealth/Data/2021_2023/TPCHD - NFP/SC-109310_TPCHD_FINAL CPR NFP Dec 2023.xlsx", sheet = 7)

nurse_long <- as.data.frame(t(nurse)) %>%
  row_to_names(row_number = 1) 

colnames(nurse_long)[5] <- "Month"
colnames(nurse_long)[8] <- "Total Clients Served"
colnames(nurse_long)[11] <- "New Clients Served"


nurse_long <- nurse_long[c(6,7,9:11, 13:15, 17:19, 21:23),]
colnames(nurse_long) <-  make.unique(colnames(nurse_long))

nurse_long$`Outside of Pierce County` <- NA
nurse_long$`Unknown Zip Code` <-  NA

nurse_long <- nurse_long %>%
  select(Month, `Total Clients Served`, `New Clients Served`, starts_with("9"), `Outside of Pierce County`, `Unknown Zip Code`,  
         `Case Management`, `Assessment - Substance Use Disorder`, `Care Coordination`, `Assessment - Mental Health`, 
         `Crisis Services/Management`, `Engagement and Outreach`, `Family Treatment`, `Group Treatment`,
         `Individual Treatment - Mental Health`, `Individual Treatment - Substance Use Disorder`, `Individual Treatment - Other`, `Medication Management`, 
         `Nursing Care`, `Peer Support`, 
         Other, Female, Male, 
         `Black or African American`, `American Indian/Alaskan Native`, Asian, 
         `Native Hawaiian / Pacific Islander`, `Another Race`, `Unknown/Unreported`, `Two or More`, White, `Unknown/Unreported.1`, `Hispanic or Latino`,
         `Non-Hispanic or Latino`, 
         `0-14`, `15-17`, `18-24`, `24-64`, `65+`, 
         Unknown, `Residential Treatment`, `Unstably Housed`, Unhoused, `Stably Housed`, 
         Unknown.1, `Veteran/Active Duty`, `Adult Family of Veteran/Active Duty`, `Child of Veteran/Active Duty`, `Non-Veteran/Active Duty`, 
         Unknown.2, Private, `Military Affiliated`, Medicaid, Uninsured, 
         Unkown, Court, `Fire Deparment`, `Hospital/ED`, `Law Enforcement`, `Other Healthcare Provider`, 
         `Other Provider`, `Outreach/Crises Response`, School, `Self/Family/Friend`, `Other -`) %>%
   mutate(`Unique Clients Served` = cumsum(`New Clients Served`))


nurse_long$Month <- c("November 2022", "December 2022", "January 2023", "February 2023",
                     "March 2023", "April 2023", "May 2023", "June 2023", "July 2023", "August 2023", "September 2023", "October 2023", "November 2023", 
                     "December 2023")



#add missing zip codes
missing_zips <- zips[-which(zips$Zip %in% colnames(nurse_long)),1] %>% 
  t(.) %>%
  row_to_names(row_number = 1) %>%
  as.data.frame()
missing_zips[1:nrow(nurse_long),] <- NA

nurse_long <- cbind(nurse_long, missing_zips)

#make columns numeric
nurse_long[,2:ncol(nurse_long)] <- mapply(as.numeric,nurse_long[,2:ncol(nurse_long)]) 

nurse_long$Program <- "Tacoma Pierce County Health Department - Nurse Family Partnership"

nurse_final <- pivot_longer(nurse_long, cols = -c(Month, Program), names_to = "Subgroup", values_to = "Count") %>%
   mutate(Group = case_when(Subgroup %in% c("Male", "Female", "Other") ~ "Gender",
                           Subgroup %in% c("Unhoused", "Unstably Housed", "Stably Housed", "Residential Treatment", "Unknown") ~ "Housing Status",
                           Subgroup %in% c("Private", "Uninsured", "Medicaid", "Military Affiliated", "Unknown.2") ~ "Health Insurance Status",
                           Subgroup %in% c("Veteran/Active Duty", "Adult Family of Veteran/Active Duty", "Child of Veteran/Active Duty",
                                           "Non-Veteran/Active Duty", "Unknown.1") ~ "Veteran Status",
                           grepl("9", Subgroup) | Subgroup %in% c("Outside of Pierce County", "Unknown Zip Code") ~ "Clients Served by Zip Code",
                           Subgroup %in% c("Assessment - Mental Health", "Assessment - Substance Use Disorder", "Care Coordination", "Case Management", 
                                       "Crisis Services/Management", "Engagement and Outreach", "Family Treatment", "Group Treatment", 
                                       "Individual Treatment - Mental Health", "Individual Treatment - Substance Use Disorder", 
                                       "Individual Treatment - Other", "Medication Management", "Nursing Care", "Peer Support") ~ "Service Type",
                           Subgroup %in% c('0-14', "15-17", "18-24", "24-64", "65+") ~ "Age",
                           Subgroup %in% c("Black or African American", "American Indian/Alaskan Native", "Asian", 
                                           "Native Hawaiian / Pacific Islander", "Another Race", "Unknown/Unreported", "Two or More", 
                                           "White", "Unknown/Unreported.1", "Hispanic or Latino", "Non-Hispanic or Latino") ~ "Race/Ethnicity",
                           Subgroup %in% c("Unkown", "Court", "Fire Deparment", "Hospital/ED", "Law Enforcement", 
                                           "Other Healthcare Provider", "Other Provider", "Outreach/Crises Response", "School", 
                                           "Self/Family/Friend", "Other -") ~ "Referral Source",
                           
                           TRUE ~ Subgroup)) %>%
  select(Program, Month, Group, Subgroup, Count) 



```


#TPCHD Teen Mental Health

```{r}
tmh <- read_excel("N:/BNFFiles/Data Analytics/2024/673055_BehaviorHealth/Data/2021_2023/TPCHD - tMHFA/SC-109312_TPCHD_FINAL CPR Dec- 2023.xlsx",
                  sheet = 8)

tmh_long <- as.data.frame(t(tmh)) %>%
  row_to_names(row_number = 1) 

colnames(tmh_long)[5] <- "Month"
colnames(tmh_long)[8] <- "Total Clients Served"
colnames(tmh_long)[9] <- "New Clients Served"


tmh_long <- tmh_long[c(7,9:11, 13:15, 17:19, 21:23),]
colnames(tmh_long) <-  make.unique(colnames(tmh_long))

tmh_long$`Outside of Pierce County` <- NA
tmh_long$`Unknown Zip Code` <-  NA

tmh_long <- tmh_long %>%
  select(Month, `Total Clients Served`, `New Clients Served`, starts_with("9"), `Outside of Pierce County`, `Unknown Zip Code`,  
         `Case Management`, `Assessment - Substance Use Disorder`, `Care Coordination`, `Assessment - Mental Health`, 
         `Crisis Services/Management`, `Engagement and Outreach`, `Family Treatment`, `Group Treatment`,
         `Individual Treatment - Mental Health`, `Individual Treatment - Substance Use Disorder`, `Individual Treatment - Other`, `Medication Management`, 
         `Nursing Care`, `Peer Support`, 
         Other, Female, Male, 
         `Black or African American`, `American Indian/Alaskan Native`, Asian, 
         `Native Hawaiian / Pacific Islander`, `Another Race`, `Unknown/Unreported`, `Two or More`, White, `Unknown/Unreported.1`, `Hispanic or Latino`,
         `Non-Hispanic or Latino`, 
         `0-14`, `15-17`, `18-24`, `24-64`, `65+`, 
         Unknown, `Residential Treatment`, `Unstably Housed`, Unhoused, `Stably Housed`, 
         Unknown.1, `Veteran/Active Duty`, `Adult Family of Veteran/Active Duty`, `Child of Veteran/Active Duty`, `Non-Veteran/Active Duty`, 
         Unknown.2, Private, `Military Affiliated`, Medicaid, Uninsured, 
         Unkown, Court, `Fire Deparment`, `Hospital/ED`, `Law Enforcement`, `Other Healthcare Provider`, 
         `Other Provider`, `Outreach/Crises Response`, School, `Self/Family/Friend`, `Other -`) %>%
   mutate(`Unique Clients Served` = cumsum(`New Clients Served`))

tmh_long$Month <- c("December 2022", "January 2023", "February 2023",
                     "March 2023", "April 2023", "May 2023", "June 2023", "July 2023", "August 2023", "September 2023", "October 2023", "November 2023", 
                     "December 2023")

#add missing zip codes
missing_zips <- zips[-which(zips$Zip %in% colnames(tmh_long)),1] %>% 
  t(.) %>%
  row_to_names(row_number = 1) %>%
  as.data.frame()
missing_zips[1:nrow(tmh_long),] <- NA

tmh_long <- cbind(tmh_long, missing_zips)

#make columns numeric
tmh_long[,2:ncol(tmh_long)] <- mapply(as.numeric,tmh_long[,2:ncol(tmh_long)]) 

tmh_long$Program <- "Tacoma Pierce County Health Department - Teen Mental Health First Aid"

tmh_final <- pivot_longer(tmh_long, cols = -c(Month, Program), names_to = "Subgroup", values_to = "Count") %>%
   mutate(Group = case_when(Subgroup %in% c("Male", "Female", "Other") ~ "Gender",
                           Subgroup %in% c("Unhoused", "Unstably Housed", "Stably Housed", "Residential Treatment", "Unknown") ~ "Housing Status",
                           Subgroup %in% c("Private", "Uninsured", "Medicaid", "Military Affiliated", "Unknown.2") ~ "Health Insurance Status",
                           Subgroup %in% c("Veteran/Active Duty", "Adult Family of Veteran/Active Duty", "Child of Veteran/Active Duty",
                                           "Non-Veteran/Active Duty", "Unknown.1") ~ "Veteran Status",
                           grepl("9", Subgroup) | Subgroup %in% c("Outside of Pierce County", "Unknown Zip Code") ~ "Clients Served by Zip Code",
                           Subgroup %in% c("Assessment - Mental Health", "Assessment - Substance Use Disorder", "Care Coordination", "Case Management", 
                                       "Crisis Services/Management", "Engagement and Outreach", "Family Treatment", "Group Treatment", 
                                       "Individual Treatment - Mental Health", "Individual Treatment - Substance Use Disorder", 
                                       "Individual Treatment - Other", "Medication Management", "Nursing Care", "Peer Support") ~ "Service Type",
                           Subgroup %in% c('0-14', "15-17", "18-24", "24-64", "65+") ~ "Age",
                           Subgroup %in% c("Black or African American", "American Indian/Alaskan Native", "Asian", 
                                           "Native Hawaiian / Pacific Islander", "Another Race", "Unknown/Unreported", "Two or More", 
                                           "White", "Unknown/Unreported.1", "Hispanic or Latino", "Non-Hispanic or Latino") ~ "Race/Ethnicity",
                           Subgroup %in% c("Unkown", "Court", "Fire Deparment", "Hospital/ED", "Law Enforcement", 
                                           "Other Healthcare Provider", "Other Provider", "Outreach/Crises Response", "School", 
                                           "Self/Family/Friend", "Other -") ~ "Referral Source",
                           
                           TRUE ~ Subgroup)) %>%
  select(Program, Month, Group, Subgroup, Count) 



```

#PCA-Alternative to Confinement

```{r}
atc <- read_excel("N:/BNFFiles/Data Analytics/2024/673055_BehaviorHealth/Data/2021_2023/PCA - ATC/Copy of PCA ATC December 2023 Output Report.xlsx")

atc_long <- as.data.frame(t(atc)) %>%
  row_to_names(row_number = 1) 

colnames(atc_long)[5] <- "Month"
colnames(atc_long)[8] <- "Total Clients Served"
colnames(atc_long)[9] <- "New Clients Served"


atc_long <- atc_long[c(1,2,3,5:7, 9:11, 13:15),]
colnames(atc_long) <-  make.unique(colnames(atc_long))

atc_long$`Outside of Pierce County` <- NA
atc_long$`Unknown Zip Code` <-  NA
atc_long$`Assessment - Mental Health` <- NA
atc_long$`Assessment - Substance Use Disorder` <- NA
atc_long$`Care Coordination` <- NA
atc_long$`Case Management` <- NA
atc_long$`Crisis Services/Management` <- NA
atc_long$`Engagement and Outreach` <- NA
atc_long$`Family Treatment` <- NA
atc_long$`Group Treatment` <- NA
atc_long$`Individual Treatment - Mental Health` <- NA
atc_long$`Individual Treatment - Substance Use Disorder` <- NA
atc_long$`Individual Treatment - Other` <- NA
atc_long$`Medication Management` <- NA
atc_long$`Nursing Care` <- NA
atc_long$`Peer Support` <- NA



atc_long <- atc_long %>%
  select(Month, `Total Clients Served`, `New Clients Served`, starts_with("9"), `Outside of Pierce County`, `Unknown Zip Code`,  
         `Case Management`, `Assessment - Substance Use Disorder`, `Care Coordination`, `Assessment - Mental Health`, 
         `Crisis Services/Management`, `Engagement and Outreach`, `Family Treatment`, `Group Treatment`,
         `Individual Treatment - Mental Health`, `Individual Treatment - Substance Use Disorder`, `Individual Treatment - Other`, `Medication Management`, 
         `Nursing Care`, `Peer Support`, 
         Other, Female, Male, 
         `Black or African American`, `American Indian/Alaskan Native`, Asian, 
         `Native Hawaiian / Pacific Islander`, `Another Race`, `Unknown/Unreported`, `Two or More`, White, `Unknown/Unreported.1`, `Hispanic or Latino`,
         `Non-Hispanic or Latino`, 
         `0-14`, `15-17`, `18-24`, `24-64`, `65+`, 
         Unknown, `Residential Treatment`, `Unstably Housed`, Unhoused, `Stably Housed`, 
         Unknown.1, `Veteran/Active Duty`, `Adult Family of Veteran/Active Duty`, `Child of Veteran/Active Duty`, `Non-Veteran/Active Duty`, 
         Unknown.2, Private, `Military Affiliated`, Medicaid, Uninsured, 
         Unkown, Court, `Fire Deparment`, `Hospital/ED`, `Law Enforcement`, `Other Healthcare Provider`, 
         `Other Provider`, `Outreach/Crises Response`, School, `Self/Family/Friend`, `Other -`) %>%
   mutate(Month = paste0(Month, " 2023"),
         `Unique Clients Served` = cumsum(`New Clients Served`))


#add missing zip codes
missing_zips <- zips[-which(zips$Zip %in% colnames(atc_long)),1] %>% 
  t(.) %>%
  row_to_names(row_number = 1) %>%
  as.data.frame()
missing_zips[1:nrow(atc_long),] <- NA

atc_long <- cbind(atc_long, missing_zips)

#make columns numeric
atc_long[,2:ncol(atc_long)] <- mapply(as.numeric,atc_long[,2:ncol(atc_long)]) 

atc_long$Program <- "Pierce County Alliance - Alternative to Confinement"

atc_final <- pivot_longer(atc_long, cols = -c(Month, Program), names_to = "Subgroup", values_to = "Count") %>%
   mutate(Group = case_when(Subgroup %in% c("Male", "Female", "Other") ~ "Gender",
                           Subgroup %in% c("Unhoused", "Unstably Housed", "Stably Housed", "Residential Treatment", "Unknown") ~ "Housing Status",
                           Subgroup %in% c("Private", "Uninsured", "Medicaid", "Military Affiliated", "Unknown.2") ~ "Health Insurance Status",
                           Subgroup %in% c("Veteran/Active Duty", "Adult Family of Veteran/Active Duty", "Child of Veteran/Active Duty",
                                           "Non-Veteran/Active Duty", "Unknown.1") ~ "Veteran Status",
                           grepl("9", Subgroup) | Subgroup %in% c("Outside of Pierce County", "Unknown Zip Code") ~ "Clients Served by Zip Code",
                           Subgroup %in% c("Assessment - Mental Health", "Assessment - Substance Use Disorder", "Care Coordination", "Case Management", 
                                       "Crisis Services/Management", "Engagement and Outreach", "Family Treatment", "Group Treatment", 
                                       "Individual Treatment - Mental Health", "Individual Treatment - Substance Use Disorder", 
                                       "Individual Treatment - Other", "Medication Management", "Nursing Care", "Peer Support") ~ "Service Type",
                           Subgroup %in% c('0-14', "15-17", "18-24", "24-64", "65+") ~ "Age",
                           Subgroup %in% c("Black or African American", "American Indian/Alaskan Native", "Asian", 
                                           "Native Hawaiian / Pacific Islander", "Another Race", "Unknown/Unreported", "Two or More", 
                                           "White", "Unknown/Unreported.1", "Hispanic or Latino", "Non-Hispanic or Latino") ~ "Race/Ethnicity",
                           Subgroup %in% c("Unkown", "Court", "Fire Deparment", "Hospital/ED", "Law Enforcement", 
                                           "Other Healthcare Provider", "Other Provider", "Outreach/Crises Response", "School", 
                                           "Self/Family/Friend", "Other -") ~ "Referral Source",
                           
                           TRUE ~ Subgroup)) %>%
  select(Program, Month, Group, Subgroup, Count) 


```


#United Way
```{r}
united <- read_excel("N:/BNFFiles/Data Analytics/2024/673055_BehaviorHealth/Data/2021_2023/United Way/Revised DEC2023 SC-109897_United Way CPR_South Sound 211.xlsx", sheet = 7)


united_long <- as.data.frame(t(united)) %>%
  row_to_names(row_number = 1) 

colnames(united_long)[5] <- "Month"
colnames(united_long)[8] <- "Total Clients Served"
colnames(united_long)[9] <- "New Clients Served"

united_long <- united_long[c(2,3, 5:7, 9:11, 13:15),]
colnames(united_long) <- make.unique(colnames(united_long))


united_long$`Outside of Pierce County` <- NA
united_long$`Unknown Zip Code` <- NA


united_long <- united_long %>%
  select(Month, `Total Clients Served`, `New Clients Served`, 
         starts_with("9"), `Outside of Pierce County`, `Unknown Zip Code`,  
         `Case Management`, `Assessment - Substance Use Disorder`, `Care Coordination`, `Assessment - Mental Health`, `Crisis Services/Management`, 
         `Engagement and Outreach`, `Family Treatment`, `Group Treatment`,`Individual Treatment - Mental Health`, 
         `Individual Treatment - Substance Use Disorder`, `Individual Treatment - Other`, `Medication Management`, 
         `Nursing Care`, `Peer Support`, 
         Other, Female, Male, 
         `Black or African American`, `American Indian/Alaskan Native`, Asian, 
         `Native Hawaiian / Pacific Islander`, `Another Race`, `Unknown/Unreported`, `Two or More`, White, `Unknown/Unreported.1`, `Hispanic or Latino`,
         `Non-Hispanic or Latino`, 
         `0-14`, `15-17`, `18-24`, `25-64`, `65+`, 
         Unknown, `Residential Treatment`, `Unstably Housed`, Unhoused, `Stably Housed`, 
         Unknown.1, `Veteran/Active Duty`, `Adult Family of Veteran/Active Duty`, `Child of Veteran/Active Duty`, `Non-Veteran/Active Duty`, 
         Unknown.2, Private, `Military Affiliated`, Medicaid, Uninsured, 
         Unkown, Court, `Fire Deparment`, `Hospital/ED`, `Law Enforcement`, `Other Healthcare Provider`, `Other Provider`, 
         `Outreach/Crises Response`, School, `Self/Family/Friend`, `Other -`) %>%
  mutate(`Unique Clients Served` = cumsum(`New Clients Served`))

united_long$Month <- c("February 2023",
                     "March 2023", "April 2023", "May 2023", "June 2023", "July 2023", "August 2023", "September 2023", "October 2023", "November 2023", 
                     "December 2023")


#add missing zip codes
missing_zips <- zips[-which(zips$Zip %in% colnames(united_long)),1] %>% 
  t(.) %>%
  row_to_names(row_number = 1) %>%
  as.data.frame()
missing_zips[1:nrow(united_long),] <- NA

united_long <- cbind(united_long, missing_zips)

#make columns numeric
united_long[,2:ncol(united_long)] <- mapply(as.numeric,united_long[,2:ncol(united_long)]) 

united_long$Program <- "United Way"

united_final <- pivot_longer(united_long, cols = -c(Month, Program), names_to = "Subgroup", values_to = "Count") %>%
   mutate(Group = case_when(Subgroup %in% c("Male", "Female", "Other") ~ "Gender",
                           Subgroup %in% c("Unhoused", "Unstably Housed", "Stably Housed", "Residential Treatment", "Unknown") ~ "Housing Status",
                           Subgroup %in% c("Private", "Uninsured", "Medicaid", "Military Affiliated", "Unknown.2") ~ "Health Insurance Status",
                           Subgroup %in% c("Veteran/Active Duty", "Adult Family of Veteran/Active Duty", "Child of Veteran/Active Duty",
                                           "Non-Veteran/Active Duty", "Unknown.1") ~ "Veteran Status",
                           grepl("9", Subgroup) | Subgroup %in% c("Outside of Pierce County", "Unknown Zip Code") ~ "Clients Served by Zip Code",
                           Subgroup %in% c("Assessment - Mental Health", "Assessment - Substance Use Disorder", "Care Coordination", "Case Management", 
                                       "Crisis Services/Management", "Engagement and Outreach", "Family Treatment", "Group Treatment", 
                                       "Individual Treatment - Mental Health", "Individual Treatment - Substance Use Disorder", 
                                       "Individual Treatment - Other", "Medication Management", "Nursing Care", "Peer Support") ~ "Service Type",
                           Subgroup %in% c("0-14", "15-17", "18-24", "25-64", "65+") ~ "Age",
                           Subgroup %in% c("Black or African American", "American Indian/Alaskan Native", "Asian", 
                                           "Native Hawaiian / Pacific Islander", "Another Race", "Unknown/Unreported", "Two or More", 
                                           "White", "Unknown/Unreported.1", "Hispanic or Latino", "Non-Hispanic or Latino") ~ "Race/Ethnicity",
                           Subgroup %in% c("Unkown", "Court", "Fire Deparment", "Hospital/ED", "Law Enforcement", 
                                           "Other Healthcare Provider", "Other Provider", "Outreach/Crises Response", "School", 
                                           "Self/Family/Friend", "Other -") ~ "Referral Source",
                           
                           TRUE ~ Subgroup)) %>%
  select(Program, Month, Group, Subgroup, Count) 






```


# Multicare - ART
```{r}
art <- read_excel("N:/BNFFiles/Data Analytics/2024/673055_BehaviorHealth/Data/2021_2023/Multicare - ART/SC109256 Output Report 2-21-24 (Dane Christensen).xlsx", sheet = 3)


art_long <- as.data.frame(t(art)) %>%
  row_to_names(row_number = 1) 

colnames(art_long)[5] <- "Month"
colnames(art_long)[8] <- "Total Clients Served"
colnames(art_long)[9] <- "New Clients Served"

art_long <- art_long[c(1:3, 5:7, 9:11, 13:15, 17:19, 21:23),]
colnames(art_long) <- make.unique(colnames(art_long))


art_long$`Outside of Pierce County` <- NA
art_long$`Unknown Zip Code` <- NA

colnames(art_long)[colnames(art_long) == "Care Coordination/Consultations"] <- "Care Coordination"
colnames(art_long)[colnames(art_long) == "Crisis Interventions"] <- "Crisis Services/Management"
colnames(art_long)[colnames(art_long) == "Follow Ups"] <- "Engagement and Outreach"

art_long <- art_long %>%
  select(Month, `Total Clients Served`, `New Clients Served`, 
         starts_with("9"), `Outside of Pierce County`, `Unknown Zip Code`,  
         `Case Management`, `Assessment - Substance Use Disorder`, `Care Coordination`, `Assessment - Mental Health`, `Crisis Services/Management`, `Family Treatment`, `Group Treatment`,`Individual Treatment - Mental Health`, 
         `Individual Treatment - Substance Use Disorder`, `Individual Treatment - Other`, `Medication Management`, 
         `Nursing Care`, `Peer Support`, 
         Other, Female, Male, 
         `Black or African American`, `American Indian/Alaskan Native`, Asian, 
         `Native Hawaiian / Pacific Islander`, `Another Race`, `Unknown/Unreported`, `Two or More`, White, `Unknown/Unreported.1`, `Hispanic or Latino`,
         `Non-Hispanic or Latino`, 
         `0-14`, `15-17`, `18-24`, `25-64`, `65+`, 
         Unknown, `Residential Treatment`, `Unstably Housed`, Unhoused, `Stably Housed`, 
         Unknown.1, `Veteran/Active Duty`, `Adult Family of Veteran/Active Duty`, `Child of Veteran/Active Duty`, `Non-Veteran/Active Duty`, 
         Unknown.2, Private, `Military Affiliated`, Medicaid, Uninsured, 
         Unknown.3, Court, `Fire Deparment`, `Hospital/ED`, `Law Enforcement`, `Other Healthcare Provider`, `Other Provider`, 
         `Outreach/Crises Response`, School, `Self/Family/Friend`, `Other -`) %>%
  mutate(`Unique Clients Served` = cumsum(`New Clients Served`))


art_long$Month <- c("July 2022", "August 2022", "September 2022", "October 2022", "November 2022", "December 2022", 
                    "January 2023", "February 2023", "March 2023", "April 2023", "May 2023", "June 2023", 
                    "July 2023", "August 2023", "September 2023", "October 2023", "November 2023","December 2023")


#add missing zip codes
missing_zips <- zips[-which(zips$Zip %in% colnames(art_long)),1] %>% 
  t(.) %>%
  row_to_names(row_number = 1) %>%
  as.data.frame()
missing_zips[1:nrow(art_long),] <- NA

art_long <- cbind(art_long, missing_zips)

#make columns numeric
art_long[,2:ncol(art_long)] <- mapply(as.numeric,art_long[,2:ncol(art_long)]) 

art_long$Program <- "Multicare - Alternative Response Team"

art_final <- pivot_longer(art_long, cols = -c(Month, Program), names_to = "Subgroup", values_to = "Count") %>%
   mutate(Group = case_when(Subgroup %in% c("Male", "Female", "Other") ~ "Gender",
                           Subgroup %in% c("Unhoused", "Unstably Housed", "Stably Housed", "Residential Treatment", "Unknown") ~ "Housing Status",
                           Subgroup %in% c("Private", "Uninsured", "Medicaid", "Military Affiliated", "Unknown.2") ~ "Health Insurance Status",
                           Subgroup %in% c("Veteran/Active Duty", "Adult Family of Veteran/Active Duty", "Child of Veteran/Active Duty",
                                           "Non-Veteran/Active Duty", "Unknown.1") ~ "Veteran Status",
                           grepl("9", Subgroup) | Subgroup %in% c("Outside of Pierce County", "Unknown Zip Code") ~ "Clients Served by Zip Code",
                           Subgroup %in% c("Assessment - Mental Health", "Assessment - Substance Use Disorder", "Care Coordination", "Case Management", 
                                       "Crisis Services/Management", "Engagement and Outreach", "Family Treatment", "Group Treatment", 
                                       "Individual Treatment - Mental Health", "Individual Treatment - Substance Use Disorder", 
                                       "Individual Treatment - Other", "Medication Management", "Nursing Care", "Peer Support", "Other.1") ~ "Service Type",
                           Subgroup %in% c('0-14', "15-17", "18-24", "25-64", "65+") ~ "Age",
                           Subgroup %in% c("Black or African American", "American Indian/Alaskan Native", "Asian", 
                                           "Native Hawaiian / Pacific Islander", "Another Race", "Unknown/Unreported", "Two or More", 
                                           "White", "Unknown/Unreported.1", "Hispanic or Latino", "Non-Hispanic or Latino") ~ "Race/Ethnicity",
                           Subgroup %in% c("Unknown.3", "Court", "Fire Deparment", "Hospital/ED", "Law Enforcement", 
                                           "Other Healthcare Provider", "Other Provider", "Outreach/Crises Response", "School", 
                                           "Self/Family/Friend", "Other -") ~ "Referral Source",
                           
                           TRUE ~ Subgroup)) %>%
  select(Program, Month, Group, Subgroup, Count) 








```


#CLR-BHSP
```{r}
bhsp <- read_excel("N:/BNFFiles/Data Analytics/2024/673055_BehaviorHealth/Data/2021_2023/CLR - BHSP/SC-109298_CLR_BHSP CPR December 2023.xlsx",
                   sheet = 7)

bhsp_long <- as.data.frame(t(bhsp)) %>%
  row_to_names(row_number = 1)

colnames(bhsp_long)[5] <- "Month"
colnames(bhsp_long)[8] <- "Total Clients Served"
colnames(bhsp_long)[9] <- "New Clients Served"

bhsp_long <- bhsp_long[c(9:11, 13:15, 17:19, 21:23),]
colnames(bhsp_long) <- make.unique(colnames(bhsp_long))


bhsp_long <- bhsp_long %>%
  select(Month, `Total Clients Served`, `New Clients Served`, 
         starts_with("9"), `Outside of Pierce County`,  
         `Case Management`, `Assessment - Substance Use Disorder`, `Care Coordination`, `Assessment - Mental Health`, `Crisis Services/Management`, `Family Treatment`, `Group Treatment`,`Individual Treatment - Mental Health`, 
         `Individual Treatment - Substance Use Disorder`, `Individual Treatment - Other`, `Medication Management`, 
         `Nursing Care`, `Peer Support`, `Other -`,
         Other, Female, Male, 
         `Black or African American`, `American Indian/Alaskan Native`, Asian, 
         `Native Hawaiian / Pacific Islander`, `Another Race`, `Unknown/Unreported`, `Two or More`, White, `Unknown/Unreported.1`, `Hispanic or Latino`,
         `Non-Hispanic or Latino`, 
         `0-14`, `15-17`, `18-24`, `24-64`, `65+`, 
         Unknown, `Residential Treatment`, `Unstably Housed`, Unhoused, `Stably Housed`, 
         Unknown.1, `Veteran/Active Duty`, `Adult Family of Veteran/Active Duty`, `Child of Veteran/Active Duty`, `Non-Veteran/Active Duty`, 
         Unknown.2, Private, `Military Affiliated`, Medicaid, Uninsured, 
         Unkown, Court, `Fire Deparment`, `Hospital/ED`, `Law Enforcement`, `Other Healthcare Provider`, `Other Provider`, 
         `Outreach/Crises Response`, School, `Self/Family/Friend`, `Other -`) %>%
  mutate(`Unique Clients Served` = cumsum(`New Clients Served`))

bhsp_long$Month <- c("January 2023","February 2023",
                     "March 2023", "April 2023", "May 2023", "June 2023", "July 2023", "August 2023", "September 2023", "October 2023", "November 2023", 
                     "December 2023")



#add missing zip codes
missing_zips <- zips[-which(zips$Zip %in% colnames(bhsp_long)),1] %>% 
  t(.) %>%
  row_to_names(row_number = 1) %>%
  as.data.frame()
missing_zips[1:nrow(bhsp_long),] <- NA

bhsp_long <- cbind(bhsp_long, missing_zips)

#make columns numeric
bhsp_long[,2:ncol(bhsp_long)] <- mapply(as.numeric,bhsp_long[,2:ncol(bhsp_long)]) 

bhsp_long$Program <- "Comprehensive Life Resources - Behavioral Health Shelter Program"

bhsp_final <- pivot_longer(bhsp_long, cols = -c(Month, Program), names_to = "Subgroup", values_to = "Count") %>%
   mutate(Group = case_when(Subgroup %in% c("Male", "Female", "Other") ~ "Gender",
                           Subgroup %in% c("Unhoused", "Unstably Housed", "Stably Housed", "Residential Treatment", "Unknown") ~ "Housing Status",
                           Subgroup %in% c("Private", "Uninsured", "Medicaid", "Military Affiliated", "Unknown.2") ~ "Health Insurance Status",
                           Subgroup %in% c("Veteran/Active Duty", "Adult Family of Veteran/Active Duty", "Child of Veteran/Active Duty",
                                           "Non-Veteran/Active Duty", "Unknown.1") ~ "Veteran Status",
                           grepl("9", Subgroup) | Subgroup %in% c("Outside of Pierce County", "Unknown Zip Code") ~ "Clients Served by Zip Code",
                           Subgroup %in% c("Assessment - Mental Health", "Assessment - Substance Use Disorder", "Care Coordination", "Case Management", 
                                       "Crisis Services/Management", "Engagement and Outreach", "Family Treatment", "Group Treatment", 
                                       "Individual Treatment - Mental Health", "Individual Treatment - Substance Use Disorder", 
                                       "Individual Treatment - Other", "Medication Management", "Nursing Care", "Peer Support", "Other -") ~ "Service Type",
                           Subgroup %in% c('0-14', "15-17", "18-24", "24-64", "65+") ~ "Age",
                           Subgroup %in% c("Black or African American", "American Indian/Alaskan Native", "Asian", 
                                           "Native Hawaiian / Pacific Islander", "Another Race", "Unknown/Unreported", "Two or More", 
                                           "White", "Unknown/Unreported.1", "Hispanic or Latino", "Non-Hispanic or Latino") ~ "Race/Ethnicity",
                           Subgroup %in% c("Unkown", "Court", "Fire Deparment", "Hospital/ED", "Law Enforcement", 
                                           "Other Healthcare Provider", "Other Provider", "Outreach/Crises Response", "School", 
                                           "Self/Family/Friend", "Other -") ~ "Referral Source",
                           
                           TRUE ~ Subgroup)) %>%
  select(Program, Month, Group, Subgroup, Count) 






```


#GLMH - Jail Diversion
```{r}
glmh <- read_excel("N:/BNFFiles/Data Analytics/2024/673055_BehaviorHealth/Data/2021_2023/GLMH-Jail Diversion/Dec 2023 SC-109986 GLMH Jail Diversion_CPR Jul to Dec 2023.xlsx",
                   sheet = 6)

glmh_long <- as.data.frame(t(glmh)) %>%
  row_to_names(row_number = 1)

colnames(glmh_long)[5] <- "Month"
colnames(glmh_long)[8] <- "Total Clients Served"
colnames(glmh_long)[9] <- "New Clients Served"

glmh_long <- glmh_long[c(1:3, 5:7),]
colnames(glmh_long) <- make.unique(colnames(glmh_long))

glmh_long$`Outside of Pierce County` <- NA
glmh_long$`Unknown Zip Code` <- NA
glmh_long$`Individual Treatment - Substance Use Disorder` <- NA


glmh_long <- glmh_long %>%
  select(Month, `Total Clients Served`, `New Clients Served`, 
         starts_with("9"), `Outside of Pierce County`, `Unknown Zip Code`,   
         `Case Management`, `Assessment - Substance Use Disorder`, `Care Coordination`, `Assessment - Mental Health`, `Crisis Services/Management`, `Family Treatment`, `Group Treatment`,`Individual Treatment - Mental Health`, 
         `Individual Treatment - Substance Use Disorder`, `Individual Treatment - Other`, `Medication Management`, 
         `Nursing Care`, `Peer Support`, `Other -`,
         Other, Female, Male, 
         `Black or African American`, `American Indian/Alaskan Native`, Asian, 
         `Native Hawaiian / Pacific Islander`, `Another Race`, `Unknown/Unreported`, `Two or More`, White, `Unknown/Unreported.1`, `Hispanic or Latino`,
         `Non-Hispanic or Latino`, 
         `0-14`, `15-17`, `18-24`, `24-64`, `65+`, 
         Unknown, `Residential Treatment`, `Unstably Housed`, Unhoused, `Stably Housed`, 
         Unknown.1, `Veteran/Active Duty`, `Adult Family of Veteran/Active Duty`, `Child of Veteran/Active Duty`, `Non-Veteran/Active Duty`, 
         Unknown.2, Private, `Military Affiliated`, Medicaid, Uninsured, 
         Unkown, Court, `Fire Deparment`, `Hospital/ED`, `Law Enforcement`, `Other Healthcare Provider`, `Other Provider`, 
         `Outreach/Crises Response`, School, `Self/Family/Friend`, `Other -`) %>%
  mutate(`Unique Clients Served` = cumsum(`New Clients Served`))

glmh_long$Month <- c("July 2023", "August 2023", "September 2023", "October 2023", "November 2023", 
                     "December 2023")



#add missing zip codes
missing_zips <- zips[-which(zips$Zip %in% colnames(glmh_long)),1] %>% 
  t(.) %>%
  row_to_names(row_number = 1) %>%
  as.data.frame()
missing_zips[1:nrow(glmh_long),] <- NA

glmh_long <- cbind(glmh_long, missing_zips)

#make columns numeric
glmh_long[,2:ncol(glmh_long)] <- mapply(as.numeric,glmh_long[,2:ncol(glmh_long)]) 

glmh_long$Program <- "Greater Lakes Mental Healthcare - Jail Diversion"

glmh_final <- pivot_longer(glmh_long, cols = -c(Month, Program), names_to = "Subgroup", values_to = "Count") %>%
   mutate(Group = case_when(Subgroup %in% c("Male", "Female", "Other") ~ "Gender",
                           Subgroup %in% c("Unhoused", "Unstably Housed", "Stably Housed", "Residential Treatment", "Unknown") ~ "Housing Status",
                           Subgroup %in% c("Private", "Uninsured", "Medicaid", "Military Affiliated", "Unknown.2") ~ "Health Insurance Status",
                           Subgroup %in% c("Veteran/Active Duty", "Adult Family of Veteran/Active Duty", "Child of Veteran/Active Duty",
                                           "Non-Veteran/Active Duty", "Unknown.1") ~ "Veteran Status",
                           grepl("9", Subgroup) | Subgroup %in% c("Outside of Pierce County", "Unknown Zip Code") ~ "Clients Served by Zip Code",
                           Subgroup %in% c("Assessment - Mental Health", "Assessment - Substance Use Disorder", "Care Coordination", "Case Management", 
                                       "Crisis Services/Management", "Engagement and Outreach", "Family Treatment", "Group Treatment", 
                                       "Individual Treatment - Mental Health", "Individual Treatment - Substance Use Disorder", 
                                       "Individual Treatment - Other", "Medication Management", "Nursing Care", "Peer Support", "Other -") ~ "Service Type",
                           Subgroup %in% c('0-14', "15-17", "18-24", "24-64", "65+") ~ "Age",
                           Subgroup %in% c("Black or African American", "American Indian/Alaskan Native", "Asian", 
                                           "Native Hawaiian / Pacific Islander", "Another Race", "Unknown/Unreported", "Two or More", 
                                           "White", "Unknown/Unreported.1", "Hispanic or Latino", "Non-Hispanic or Latino") ~ "Race/Ethnicity",
                           Subgroup %in% c("Unkown", "Court", "Fire Deparment", "Hospital/ED", "Law Enforcement", 
                                           "Other Healthcare Provider", "Other Provider", "Outreach/Crises Response", "School", 
                                           "Self/Family/Friend", "Other -") ~ "Referral Source",
                           
                           TRUE ~ Subgroup)) %>%
  select(Program, Month, Group, Subgroup, Count) 


```


#MCFHC - Therapeutic Court
```{r}
mcfhc <- read_excel("N:/BNFFiles/Data Analytics/2024/673055_BehaviorHealth/Data/2021_2023/MCFHC/SC-109915_Multicultural Child  Family Hope Center_2023-12.xlsx", sheet = 9)

mcfhc_long <- as.data.frame(t(mcfhc)) %>%
  row_to_names(row_number = 1)

colnames(mcfhc_long)[5] <- "Month"
colnames(mcfhc_long)[8] <- "Total Clients Served"
colnames(mcfhc_long)[9] <- "New Clients Served"

mcfhc_long <- mcfhc_long[c(11, 13:15, 17:19, 21:23),]
colnames(mcfhc_long) <- make.unique(colnames(mcfhc_long))


mcfhc_long <- mcfhc_long %>%
  select(Month, `Total Clients Served`, `New Clients Served`, 
         starts_with("9"), `Outside of Pierce County`, Unknown,   
         `Case Management`, `Assessment - Substance Use Disorder`, `Care Coordination`, `Assessment - Mental Health`, `Crisis Services/Management`, `Family Treatment`, `Group Treatment`,`Individual Treatment - Mental Health`, 
         `Individual Treatment - Substance Use Disorder`, `Individual Treatment - Other`, `Medication Management`, 
         `Nursing Care`, `Peer Support`, `Other -`,
         Other, Female, Male, 
         `Black or African American`, `American Indian/Alaskan Native`, Asian, 
         `Native Hawaiian / Pacific Islander`, `Another Race`, `Unknown/Unreported`, `Two or More`, White, `Unknown/Unreported.1`, `Hispanic or Latino`,
         `Non-Hispanic or Latino`, 
         `0-14`, `15-17`, `18-24`, `25-64`, `65+`, 
         Unknown.1, `Residential Treatment`, `Unstably Housed`, Unhoused, `Stably Housed`, 
         Unknown.2, `Veteran/Active Duty`, `Adult Family of Veteran/Active Duty`, `Child of Veteran/Active Duty`, `Non-Veteran/Active Duty`, 
         Unknown.3, Private, `Military Affiliated`, Medicaid, Uninsured, 
         Unknown.4, Court, `Fire Deparment`, `Hospital/ED`, `Law Enforcement`, `Other Healthcare Provider`, `Other Provider`, 
         `Outreach/Crises Response`, School, `Self/Family/Friend`, `Other -`) %>%
  mutate(`Unique Clients Served` = cumsum(`New Clients Served`))

mcfhc_long$Month <- c("March 2023", "April 2023", "May 2023", "June 2023" ,"July 2023", "August 2023", "September 2023", "October 2023", "November 2023", 
                     "December 2023")



#add missing zip codes
missing_zips <- zips[-which(zips$Zip %in% colnames(mcfhc_long)),1] %>% 
  t(.) %>%
  row_to_names(row_number = 1) %>%
  as.data.frame()
missing_zips[1:nrow(mcfhc_long),] <- NA

mcfhc_long <- cbind(mcfhc_long, missing_zips)

#make columns numeric
mcfhc_long[,2:ncol(mcfhc_long)] <- mapply(as.numeric,mcfhc_long[,2:ncol(mcfhc_long)]) 

mcfhc_long$Program <- "Multicultural Child and Family Hope Center - Therapeutic Court"

mcfhc_final <- pivot_longer(mcfhc_long, cols = -c(Month, Program), names_to = "Subgroup", values_to = "Count") %>%
   mutate(Group = case_when(Subgroup %in% c("Male", "Female", "Other") ~ "Gender",
                           Subgroup %in% c("Unhoused", "Unstably Housed", "Stably Housed", "Residential Treatment", "Unknown.1") ~ "Housing Status",
                           Subgroup %in% c("Private", "Uninsured", "Medicaid", "Military Affiliated", "Unknown.3") ~ "Health Insurance Status",
                           Subgroup %in% c("Veteran/Active Duty", "Adult Family of Veteran/Active Duty", "Child of Veteran/Active Duty",
                                           "Non-Veteran/Active Duty", "Unknown.2") ~ "Veteran Status",
                           grepl("9", Subgroup) | Subgroup %in% c("Outside of Pierce County", "Unknown") ~ "Clients Served by Zip Code",
                           Subgroup %in% c("Assessment - Mental Health", "Assessment - Substance Use Disorder", "Care Coordination", "Case Management", 
                                       "Crisis Services/Management", "Engagement and Outreach", "Family Treatment", "Group Treatment", 
                                       "Individual Treatment - Mental Health", "Individual Treatment - Substance Use Disorder", 
                                       "Individual Treatment - Other", "Medication Management", "Nursing Care", "Peer Support", "Other -") ~ "Service Type",
                           Subgroup %in% c('0-14', "15-17", "18-24", "25-64", "65+") ~ "Age",
                           Subgroup %in% c("Black or African American", "American Indian/Alaskan Native", "Asian", 
                                           "Native Hawaiian / Pacific Islander", "Another Race", "Unknown/Unreported", "Two or More", 
                                           "White", "Unknown/Unreported.1", "Hispanic or Latino", "Non-Hispanic or Latino") ~ "Race/Ethnicity",
                           Subgroup %in% c("Unknown.4", "Court", "Fire Deparment", "Hospital/ED", "Law Enforcement", 
                                           "Other Healthcare Provider", "Other Provider", "Outreach/Crises Response", "School", 
                                           "Self/Family/Friend", "Other -") ~ "Referral Source",
                           
                           TRUE ~ Subgroup)) %>%
  select(Program, Month, Group, Subgroup, Count) 

```

#TPCHD - Childwell
```{r}
childwell <- read_excel("N:/BNFFiles/Data Analytics/2024/673055_BehaviorHealth/Data/2021_2023/TPCHD - Childwell/SC-109526_TPCHD_CHILDWELL Dec - 23.xlsx", sheet = 7)

childwell_long <- as.data.frame(t(childwell)) %>%
  row_to_names(row_number = 1)

colnames(childwell_long)[5] <- "Month"
colnames(childwell_long)[8] <- "Total Clients Served"
colnames(childwell_long)[9] <- "New Clients Served"

childwell_long <- childwell_long[c(11, 13:15, 17:19, 21:23),]
colnames(childwell_long) <- make.unique(colnames(childwell_long))

childwell_long$`Outside of Pierce County` <- NA
childwell_long$`Unknown Zip Code` <- NA


childwell_long <- childwell_long %>%
  select(Month, `Total Clients Served`, `New Clients Served`, 
         starts_with("9"), `Outside of Pierce County`, `Unknown Zip Code`,   
         `Case Management`, `Assessment - Substance Use Disorder`, `Care Coordination`, `Assessment - Mental Health`, `Crisis Services/Management`, `Family Treatment`, `Group Treatment`,`Individual Treatment - Mental Health`, 
         `Individual Treatment - Substance Use Disorder`, `Individual Treatment - Other`, `Medication Management`, 
         `Nursing Care`, `Peer Support`, `Other -`,
         Other, Female, Male, 
         `Black or African American`, `American Indian/Alaskan Native`, Asian, 
         `Native Hawaiian / Pacific Islander`, `Another Race`, `Unknown/Unreported`, `Two or More`, White, `Unknown/Unreported.1`, `Hispanic or Latino`,
         `Non-Hispanic or Latino`, 
         `0-14`, `15-17`, `18-24`, `24-64`, `65+`, 
         Unknown, `Residential Treatment`, `Unstably Housed`, Unhoused, `Stably Housed`, 
         Unknown.1, `Veteran/Active Duty`, `Adult Family of Veteran/Active Duty`, `Child of Veteran/Active Duty`, `Non-Veteran/Active Duty`, 
         Unknown.2, Private, `Military Affiliated`, Medicaid, Uninsured, 
         Unkown, Court, `Fire Deparment`, `Hospital/ED`, `Law Enforcement`, `Other Healthcare Provider`, `Other Provider`, 
         `Outreach/Crises Response`, School, `Self/Family/Friend`, `Other -`) %>%
  mutate(`Unique Clients Served` = cumsum(`New Clients Served`))

childwell_long$Month <- c("March 2023", "April 2023", "May 2023", "June 2023" ,"July 2023", "August 2023", "September 2023", "October 2023", "November 2023", 
                     "December 2023")



#add missing zip codes
missing_zips <- zips[-which(zips$Zip %in% colnames(childwell_long)),1] %>% 
  t(.) %>%
  row_to_names(row_number = 1) %>%
  as.data.frame()
missing_zips[1:nrow(childwell_long),] <- NA

childwell_long <- cbind(childwell_long, missing_zips)

#make columns numeric
childwell_long[,2:ncol(childwell_long)] <- mapply(as.numeric,childwell_long[,2:ncol(childwell_long)]) 

childwell_long$Program <- "Tacoma Pierce County Health Department - Childwell"

childwell_final <- pivot_longer(childwell_long, cols = -c(Month, Program), names_to = "Subgroup", values_to = "Count") %>%
   mutate(Group = case_when(Subgroup %in% c("Male", "Female", "Other") ~ "Gender",
                           Subgroup %in% c("Unhoused", "Unstably Housed", "Stably Housed", "Residential Treatment", "Unknown") ~ "Housing Status",
                           Subgroup %in% c("Private", "Uninsured", "Medicaid", "Military Affiliated", "Unknown.2") ~ "Health Insurance Status",
                           Subgroup %in% c("Veteran/Active Duty", "Adult Family of Veteran/Active Duty", "Child of Veteran/Active Duty",
                                           "Non-Veteran/Active Duty", "Unknown.1") ~ "Veteran Status",
                           grepl("9", Subgroup) | Subgroup %in% c("Outside of Pierce County", "Unknown Zip Code") ~ "Clients Served by Zip Code",
                           Subgroup %in% c("Assessment - Mental Health", "Assessment - Substance Use Disorder", "Care Coordination", "Case Management", 
                                       "Crisis Services/Management", "Engagement and Outreach", "Family Treatment", "Group Treatment", 
                                       "Individual Treatment - Mental Health", "Individual Treatment - Substance Use Disorder", 
                                       "Individual Treatment - Other", "Medication Management", "Nursing Care", "Peer Support", "Other -") ~ "Service Type",
                           Subgroup %in% c('0-14', "15-17", "18-24", "24-64", "65+") ~ "Age",
                           Subgroup %in% c("Black or African American", "American Indian/Alaskan Native", "Asian", 
                                           "Native Hawaiian / Pacific Islander", "Another Race", "Unknown/Unreported", "Two or More", 
                                           "White", "Unknown/Unreported.1", "Hispanic or Latino", "Non-Hispanic or Latino") ~ "Race/Ethnicity",
                           Subgroup %in% c("Unkown", "Court", "Fire Deparment", "Hospital/ED", "Law Enforcement", 
                                           "Other Healthcare Provider", "Other Provider", "Outreach/Crises Response", "School", 
                                           "Self/Family/Friend", "Other -") ~ "Referral Source",
                           
                           TRUE ~ Subgroup)) %>%
  select(Program, Month, Group, Subgroup, Count) 
```


#CLR - MCIRT (2022)

```{r}

mcirt_2022 <- read_excel("N:/BNFFiles/Data Analytics/2024/673055_BehaviorHealth/Data/2021_2023/CLR - MCIRT/MCIRT CLR SC-108962 DEC 2023 - Copy.xlsx", sheet = 6)
 
mcirt_2022_long <- as.data.frame(t(mcirt_2022)) %>%
   row_to_names(row_number = 1)
 
colnames(mcirt_2022_long)[2] <- "Month"
colnames(mcirt_2022_long)[4] <- "New Clients Served"
colnames(mcirt_2022_long)[5] <- "Total Clients Served"
 
mcirt_2022_long <- mcirt_2022_long[c(2:4, 6:8, 10:12, 14:16),]
 
 
mcirt_2022_long$`Outside of Pierce County` <- NA
mcirt_2022_long$`Unknown Zip Code` <- NA
mcirt_2022_long$`Veteran/Active Duty` <- NA
mcirt_2022_long$`Adult Family of Veteran/Active Duty` <- NA
mcirt_2022_long$`Child of Veteran/Active Duty` <- NA
mcirt_2022_long$`Non-Veteran/Active Duty` <- NA
mcirt_2022_long$`Unknown Veteran Status` <- NA




mcirt_2022_long <- mcirt_2022_long %>%
  select(Month, `Total Clients Served`, `New Clients Served`, 
         starts_with("9"), `Outside of Pierce County`, `Unknown Zip Code`,   
         `Case Management`, `Assessment - Substance Use Disorder`, `Care Coordination`, `Assessment - Mental Health`, 
         `Crisis Services/Management`, `Family Treatment`, `Group Treatment`,`Individual Treatment - Mental Health`, 
         `Individual Treatment - Substance Use Disorder`, `Medication Management`, 
         `Nursing Care`, `Peer Support`, `Other Service`,
         `Other Gender`, Female, Male, 
         `Black or African American`, `American Indian/Alaskan Native`, Asian, 
         `Native Hawaiian / Pacific Islander`, `Another Race`, `Unknown Race`, `Two or More`, White, `Unknown Ethnicity`, 
         `Hispanic or Latino`,
         `Non-Hispanic or Latino`, 
         `0-14`, `15-17`, `18-24`, `25-64`, `65+`, 
         `Unknown Housing Status`, `Residential Treatment`, `Unstably Housed`, Unhoused, `Stably Housed`, 
         `Unknown Veteran Status` , `Veteran/Active Duty`, `Adult Family of Veteran/Active Duty`, `Child of Veteran/Active Duty`, 
         `Non-Veteran/Active Duty`, 
         `Unknown Health Insurance Status`, Private, `Military Affiliated`, Medicaid, Uninsured, Medicare, 
         `Unknown Referral Source`, Court, `Fire Department`, `Hospital/ED`, `Law Enforcement`, `Other Healthcare Provider`, 
         `Other Provider`, `Outreach/Crises Response`, School, `Self/Family/Friend`, `Other Referral Source`) %>%
  mutate(`Unique Clients Served` = cumsum(`New Clients Served`))

#add missing zip codes
missing_zips <- zips[-which(zips$Zip %in% colnames(mcirt_2022_long)),1] %>% 
  t(.) %>%
  row_to_names(row_number = 1) %>%
  as.data.frame()
missing_zips[1:nrow(mcirt_2022_long),] <- NA

mcirt_2022_long <- cbind(mcirt_2022_long, missing_zips)

#make columns numeric
mcirt_2022_long[,2:ncol(mcirt_2022_long)] <- mapply(as.numeric,mcirt_2022_long[,2:ncol(mcirt_2022_long)]) 

mcirt_2022_long$Program <- "Comprehensive Life Resources - Mobile Community Intervention Response Team"

mcirt_2022_long$Month <- paste0(mcirt_2022_long$Month, " 2022")


mcirt_2022_final <- pivot_longer(mcirt_2022_long, cols = -c(Month, Program), names_to = "Subgroup", values_to = "Count") %>%
   mutate(Group = case_when(Subgroup %in% c("Male", "Female", "Other Gender") ~ "Gender",
                           Subgroup %in% c("Unhoused", "Unstably Housed", "Stably Housed", "Residential Treatment", 
                                           "Unknown Housing Status") ~ "Housing Status",
                           Subgroup %in% c("Private", "Uninsured", "Medicaid", "Military Affiliated", "Unknown Health Insurance Status",
                                           "Medicare") ~ "Health Insurance Status",
                           Subgroup %in% c("Veteran/Active Duty", "Adult Family of Veteran/Active Duty", "Child of Veteran/Active Duty",
                                           "Non-Veteran/Active Duty", "Unknown Veteran Status") ~ "Veteran Status",
                           grepl("9", Subgroup) | Subgroup %in% c("Outside of Pierce County", 
                                                                  "Unknown Zip Code") ~ "Clients Served by Zip Code",
                           Subgroup %in% c("Assessment - Mental Health", "Assessment - Substance Use Disorder", 
                                           "Care Coordination", "Case Management", "Crisis Services/Management", "Engagement and Outreach",
                                           "Family Treatment", "Group Treatment","Individual Treatment - Mental Health", 
                                           "Individual Treatment - Substance Use Disorder", "Individual Treatment - Other", 
                                           "Medication Management", "Nursing Care", "Peer Support", "Other Service") ~ "Service Type",
                           Subgroup %in% c('0-14', "15-17", "18-24", "25-64", "65+") ~ "Age",
                           Subgroup %in% c("Black or African American", "American Indian/Alaskan Native", "Asian", 
                                           "Native Hawaiian / Pacific Islander", "Another Race", "Unknown Race", "Two or More", 
                                           "White", "Unknown Ethnicity", "Hispanic or Latino", "Non-Hispanic or Latino") ~ "Race/Ethnicity",
                           Subgroup %in% c("Unknown Referral Source", "Court", "Fire Department", "Hospital/ED", "Law Enforcement", 
                                           "Other Healthcare Provider", "Other Provider", "Outreach/Crises Response", "School", 
                                           "Self/Family/Friend", "Other Referral Source") ~ "Referral Source",
                           
                           TRUE ~ Subgroup)) %>%
  select(Program, Month, Group, Subgroup, Count) 


```



#CLR-MCIRT (2023)
```{r}
mcirt_2023 <- read_excel("N:/BNFFiles/Data Analytics/2024/673055_BehaviorHealth/Data/2021_2023/CLR - MCIRT/MCIRT CLR SC-108962 DEC 2023 - Copy.xlsx", sheet = 5)
 
mcirt_2023_long <- as.data.frame(t(mcirt_2023)) %>%
   row_to_names(row_number = 1)
 
colnames(mcirt_2023_long)[2] <- "Month"
colnames(mcirt_2023_long)[4] <- "New Clients Served"
colnames(mcirt_2023_long)[5] <- "Total Clients Served"
 
mcirt_2023_long <- mcirt_2023_long[c(2:4, 6:8, 10:12, 14:16),]
 
 
mcirt_2023_long$`Outside of Pierce County` <- NA
mcirt_2023_long$`Unknown Zip Code` <- NA
mcirt_2023_long$`Veteran/Active Duty` <- NA
mcirt_2023_long$`Adult Family of Veteran/Active Duty` <- NA
mcirt_2023_long$`Child of Veteran/Active Duty` <- NA
mcirt_2023_long$`Non-Veteran/Active Duty` <- NA
mcirt_2023_long$`Unknown Veteran Status` <- NA
mcirt_2023_long$`Crisis Services/Management` <- NA
mcirt_2023_long$`Individual Treatment - Substance Use Disorder` <- NA
mcirt_2023_long$`Nursing Care` <- NA
mcirt_2023_long$`Peer Support` <- NA

mcirt_2023_long <- mcirt_2023_long %>%
  select(Month, `Total Clients Served`, `New Clients Served`, 
         starts_with("9"), `Outside of Pierce County`, `Unknown Zip Code`,   
         `Case Management`, `Assessment - Substance Use Disorder`, `Care Coordination`, `Assessment - Mental Health`, 
         `Crisis Services/Management`, `Family Treatment`, `Group Treatment`,`Individual Treatment - Mental Health`, 
         `Individual Treatment - Substance Use Disorder`, `Medication Management`, 
         `Nursing Care`, `Peer Support`, `Other Service`,
         `Other Gender`, Female, Male, 
         `Black or African American`, `American Indian/Alaskan Native`, Asian, 
         `Native Hawaiian / Pacific Islander`, `Another Race`, `Unknown Race`, `Two or More`, White, `Unknown Ethnicity`, 
         `Hispanic or Latino`,
         `Non-Hispanic or Latino`, 
         `0-14`, `15-17`, `18-24`, `25-64`, `65+`, 
         `Unknown Housing Status`, `Residential Treatment`, `Unstably Housed`, Unhoused, `Stably Housed`, 
         `Unknown Veteran Status` , `Veteran/Active Duty`, `Adult Family of Veteran/Active Duty`, `Child of Veteran/Active Duty`, 
         `Non-Veteran/Active Duty`, 
         `Unknown Health Insurance Status`, Private, `Military Affiliated`, Medicaid, Uninsured, Medicare, 
         `Unknown Referral Source`, Court, `Fire Department`, `Hospital/ED`, `Law Enforcement`, `Other Healthcare Provider`, 
         `Other Provider`, `Outreach/Crises Response`, School, `Self/Family/Friend`, `Other Referral Source`) %>%
  mutate(`Unique Clients Served` = cumsum(`New Clients Served`))

#add missing zip codes
missing_zips <- zips[-which(zips$Zip %in% colnames(mcirt_2023_long)),1] %>% 
  t(.) %>%
  row_to_names(row_number = 1) %>%
  as.data.frame()
missing_zips[1:nrow(mcirt_2023_long),] <- NA

mcirt_2023_long <- cbind(mcirt_2023_long, missing_zips)

#make columns numeric
mcirt_2023_long[,2:ncol(mcirt_2023_long)] <- mapply(as.numeric,mcirt_2023_long[,2:ncol(mcirt_2023_long)]) 

mcirt_2023_long$Program <- "Comprehensive Life Resources - Mobile Community Intervention Response Team"

mcirt_2023_long$Month <- paste0(mcirt_2023_long$Month, " 2023")


mcirt_2023_final <- pivot_longer(mcirt_2023_long, cols = -c(Month, Program), names_to = "Subgroup", values_to = "Count") %>%
   mutate(Group = case_when(Subgroup %in% c("Male", "Female", "Other Gender") ~ "Gender",
                           Subgroup %in% c("Unhoused", "Unstably Housed", "Stably Housed", "Residential Treatment", 
                                           "Unknown Housing Status") ~ "Housing Status",
                           Subgroup %in% c("Private", "Uninsured", "Medicaid", "Military Affiliated", "Unknown Health Insurance Status",
                                           "Medicare") ~ "Health Insurance Status",
                           Subgroup %in% c("Veteran/Active Duty", "Adult Family of Veteran/Active Duty", "Child of Veteran/Active Duty",
                                           "Non-Veteran/Active Duty", "Unknown Veteran Status") ~ "Veteran Status",
                           grepl("9", Subgroup) | Subgroup %in% c("Outside of Pierce County", 
                                                                  "Unknown Zip Code") ~ "Clients Served by Zip Code",
                           Subgroup %in% c("Assessment - Mental Health", "Assessment - Substance Use Disorder", 
                                           "Care Coordination", "Case Management", "Crisis Services/Management", "Engagement and Outreach",
                                           "Family Treatment", "Group Treatment","Individual Treatment - Mental Health", 
                                           "Individual Treatment - Substance Use Disorder", "Individual Treatment - Other", 
                                           "Medication Management", "Nursing Care", "Peer Support", "Other Service") ~ "Service Type",
                           Subgroup %in% c('0-14', "15-17", "18-24", "25-64", "65+") ~ "Age",
                           Subgroup %in% c("Black or African American", "American Indian/Alaskan Native", "Asian", 
                                           "Native Hawaiian / Pacific Islander", "Another Race", "Unknown Race", "Two or More", 
                                           "White", "Unknown Ethnicity", "Hispanic or Latino", "Non-Hispanic or Latino") ~ "Race/Ethnicity",
                           Subgroup %in% c("Unknown Referral Source", "Court", "Fire Department", "Hospital/ED", "Law Enforcement", 
                                           "Other Healthcare Provider", "Other Provider", "Outreach/Crises Response", "School", 
                                           "Self/Family/Friend", "Other Referral Source") ~ "Referral Source",
                           
                           TRUE ~ Subgroup)) %>%
  select(Program, Month, Group, Subgroup, Count) 




```

#valley cities
```{r}
vc <- read_excel("N:/BNFFiles/Data Analytics/2024/673055_BehaviorHealth/Data/2021_2023/VCCC-Cohen Veterans Clinic/December CPR_Cleaned.xlsx", sheet = 6)

vc_long <- as.data.frame(t(vc)) %>%
  row_to_names(row_number = 1)

colnames(vc_long)[5] <- "Month"
colnames(vc_long)[7] <- "Total Clients Served"
colnames(vc_long)[8] <- "New Clients Served"

vc_long <- vc_long[c(1:3, 5:7, 9:11, 13:15, 17:19, 21:23),]

vc_long$`Outside of Pierce County` <- NA
vc_long$`Unknown Zip Code` <- NA
vc_long$`Fire Department` <- NA
vc_long$`Law Enforcement` <- NA
vc_long$`Outreach/Crises Response` <- NA
vc_long$School <- NA

colnames(vc_long) <- make.unique(colnames(vc_long))

vc_long <- vc_long %>%
  select(Month, `Total Clients Served`, `New Clients Served`, 
         starts_with("9"), `Outside of Pierce County`, `Unknown Zip Code`,   
         `Case Management`, `Assessment - Substance Use Disorder`, `Care Coordination`, `Assessment - Mental Health`, `Crisis Services/Management`, `Family Treatment`, `Group Treatment`,`Individual Treatment - Mental Health`, 
         `Individual Treatment - Substance Use Disorder`, `Individual Treatment - Other`, `Medication Management`, 
         `Nursing Care`, `Peer Support`, `Other -`,
         Other, Female, Male, 
         `Black or African American`, `American Indian/Alaskan Native`, Asian, 
         `Native Hawaiian / Pacific Islander`, `Another Race`, `Unknown/Unreported`, `Two or More`, White, `Unknown/Unreported.1`, `Hispanic or Latino`,
         `Non-Hispanic or Latino`, 
         `0-14`, `15-17`, `18-24`, `24-64`, `65+`, 
         Unknown, `Residential Treatment`, `Unstably Housed`, Unhoused, `Stably Housed`, 
         Unknown.1, `Veteran/Active Duty`, `Adult Family of Veteran/Active Duty`, `Child of Veteran/Active Duty`, `Non-Veteran/Active Duty`, 
         Unknown.2, Private, `Military Affiliated`, Medicaid, Uninsured, 
         Court, `Fire Department`, `Hospital/ED`, `Law Enforcement`, `Other Healthcare Provider`, `Other Provider`, 
         `Outreach/Crises Response`, School, `Self/Family/Friend`, `Other -`) %>%
  mutate(`Unique Clients Served` = cumsum(`New Clients Served`))


#add missing zip codes
missing_zips <- zips[-which(zips$Zip %in% colnames(vc_long)),1] %>% 
  t(.) %>%
  row_to_names(row_number = 1) %>%
  as.data.frame()
missing_zips[1:nrow(vc_long),] <- NA

vc_long <- cbind(vc_long, missing_zips)

vc_long$Month <- c("July 2022","August 2022","September 2022", "October 2022", "November 2022", "December 2022", "January 2023", "February 2023",
                     "March 2023", "April 2023", "May 2023", "June 2023", "July 2023", "August 2023", "September 2023", "October 2023", "November 2023", 
                     "December 2023")


#make columns numeric
vc_long[,2:ncol(vc_long)] <- mapply(as.numeric,vc_long[,2:ncol(vc_long)]) 

vc_long$Program <- "Valley Cities Counseling and Consultations"

vc_final <- pivot_longer(vc_long, cols = -c(Month, Program), names_to = "Subgroup", values_to = "Count") %>%
   mutate(Group = case_when(Subgroup %in% c("Male", "Female", "Other") ~ "Gender",
                           Subgroup %in% c("Unhoused", "Unstably Housed", "Stably Housed", "Residential Treatment", "Unknown") ~ "Housing Status",
                           Subgroup %in% c("Private", "Uninsured", "Medicaid", "Military Affiliated", "Unknown.2") ~ "Health Insurance Status",
                           Subgroup %in% c("Veteran/Active Duty", "Adult Family of Veteran/Active Duty", "Child of Veteran/Active Duty",
                                           "Non-Veteran/Active Duty", "Unknown.1") ~ "Veteran Status",
                           grepl("9", Subgroup) | Subgroup %in% c("Outside of Pierce County", "Unknown zip Code") ~ "Clients Served by Zip Code",
                           Subgroup %in% c("Assessment - Mental Health", "Assessment - Substance Use Disorder", "Care Coordination", "Case Management", 
                                       "Crisis Services/Management", "Engagement and Outreach", "Family Treatment", "Group Treatment", 
                                       "Individual Treatment - Mental Health", "Individual Treatment - Substance Use Disorder", 
                                       "Individual Treatment - Other", "Medication Management", "Nursing Care", "Peer Support", "Other -") ~ "Service Type",
                           Subgroup %in% c('0-14', "15-17", "18-24", "24-64", "65+") ~ "Age",
                           Subgroup %in% c("Black or African American", "American Indian/Alaskan Native", "Asian", 
                                           "Native Hawaiian / Pacific Islander", "Another Race", "Unknown/Unreported", "Two or More", 
                                           "White", "Unknown/Unreported.1", "Hispanic or Latino", "Non-Hispanic or Latino") ~ "Race/Ethnicity",
                           Subgroup %in% c("Court", "Fire Deparment", "Hospital/ED", "Law Enforcement", 
                                           "Other Healthcare Provider", "Other Provider", "Outreach/Crises Response", "School", 
                                           "Self/Family/Friend", "Other -") ~ "Referral Source",
                           
                           TRUE ~ Subgroup)) %>%
  select(Program, Month, Group, Subgroup, Count) 


```


#TPCHD - Fentanyl
```{r}
fentanyl <- read_excel("N:/BNFFiles/Data Analytics/2024/673055_BehaviorHealth/Data/2021_2023/TPCHD - Fentanyl Prevention/CLEANED_SC-109527_TPCHD_FINAL CPR Dec -23.xlsx",
                       sheet = 7)

fentanyl_long <- as.data.frame(t(fentanyl)) %>%
  row_to_names(row_number = 1)


colnames(fentanyl_long)[5] <- "Month"
colnames(fentanyl_long)[8] <- "Total Clients Served"
colnames(fentanyl_long)[9] <- "New Clients Served"

fentanyl_long <- fentanyl_long[c(1:3, 5:7, 9:11, 13:15, 17:19, 21:23),]


fentanyl_long$`Outside of Pierce County` <- NA
fentanyl_long$`Unknown Zip Code` <- NA

colnames(fentanyl_long) <- make.unique(colnames(fentanyl_long))

fentanyl_long <- fentanyl_long %>%
  select(Month, `Total Clients Served`, `New Clients Served`, 
         starts_with("9"), `Outside of Pierce County`, `Unknown Zip Code`,   
         `Case Management`, `Assessment - Substance Use Disorder`, `Care Coordination`, `Assessment - Mental Health`, `Crisis Services/Management`, `Family Treatment`, `Group Treatment`,`Individual Treatment - Mental Health`, 
         `Individual Treatment - Substance Use Disorder`, `Individual Treatment - Other`, `Medication Management`, 
         `Nursing Care`, `Peer Support`, `Other -`,
         Other, Female, Male, 
         `Black or African American`, `American Indian/Alaskan Native`, Asian, 
         `Native Hawaiian / Pacific Islander`, `Another Race`, `Unknown/Unreported`, `Two or More`, White, `Unknown/Unreported.1`, `Hispanic or Latino`,
         `Non-Hispanic or Latino`, 
         `0-14`, `15-17`, `18-24`, `24-64`, `65+`, 
         Unknown, `Residential Treatment`, `Unstably Housed`, Unhoused, `Stably Housed`, 
         Unknown.1, `Veteran/Active Duty`, `Adult Family of Veteran/Active Duty`, `Child of Veteran/Active Duty`, `Non-Veteran/Active Duty`, 
         Unknown.2, Private, `Military Affiliated`, Medicaid, Uninsured, 
         Court, `Fire Deparment`, `Hospital/ED`, `Law Enforcement`, `Other Healthcare Provider`, `Other Provider`, 
         `Outreach/Crises Response`, School, `Self/Family/Friend`, `Other -`, Unkown) %>%
  mutate(`Unique Clients Served` = cumsum(`New Clients Served`))


#add missing zip codes
missing_zips <- zips[-which(zips$Zip %in% colnames(fentanyl_long)),1] %>% 
  t(.) %>%
  row_to_names(row_number = 1) %>%
  as.data.frame()
missing_zips[1:nrow(fentanyl_long),] <- NA

fentanyl_long <- cbind(fentanyl_long, missing_zips)

fentanyl_long$Month <- c("July 2022","August 2022","September 2022", "October 2022", "November 2022", "December 2022", "January 2023", "February 2023",
                     "March 2023", "April 2023", "May 2023", "June 2023", "July 2023", "August 2023", "September 2023", "October 2023", "November 2023", 
                     "December 2023")

fentanyl_long[,2:ncol(fentanyl_long)] <- mapply(as.numeric,fentanyl_long[,2:ncol(fentanyl_long)]) 

fentanyl_long$Program <- "Tacoma Pierce County Health Department - Fentanyl Awareness"

fentanyl_final <- pivot_longer(fentanyl_long, cols = -c(Month, Program), names_to = "Subgroup", values_to = "Count") %>%
   mutate(Group = case_when(Subgroup %in% c("Male", "Female", "Other") ~ "Gender",
                           Subgroup %in% c("Unhoused", "Unstably Housed", "Stably Housed", "Residential Treatment", "Unknown") ~ "Housing Status",
                           Subgroup %in% c("Private", "Uninsured", "Medicaid", "Military Affiliated", "Unknown.2") ~ "Health Insurance Status",
                           Subgroup %in% c("Veteran/Active Duty", "Adult Family of Veteran/Active Duty", "Child of Veteran/Active Duty",
                                           "Non-Veteran/Active Duty", "Unknown.1") ~ "Veteran Status",
                           grepl("9", Subgroup) | Subgroup %in% c("Outside of Pierce County", "Unknown zip Code") ~ "Clients Served by Zip Code",
                           Subgroup %in% c("Assessment - Mental Health", "Assessment - Substance Use Disorder", "Care Coordination", "Case Management", 
                                       "Crisis Services/Management", "Engagement and Outreach", "Family Treatment", "Group Treatment", 
                                       "Individual Treatment - Mental Health", "Individual Treatment - Substance Use Disorder", 
                                       "Individual Treatment - Other", "Medication Management", "Nursing Care", "Peer Support", "Other -") ~ "Service Type",
                           Subgroup %in% c('0-14', "15-17", "18-24", "24-64", "65+") ~ "Age",
                           Subgroup %in% c("Black or African American", "American Indian/Alaskan Native", "Asian", 
                                           "Native Hawaiian / Pacific Islander", "Another Race", "Unknown/Unreported", "Two or More", 
                                           "White", "Unknown/Unreported.1", "Hispanic or Latino", "Non-Hispanic or Latino") ~ "Race/Ethnicity",
                           Subgroup %in% c("Court", "Fire Deparment", "Hospital/ED", "Law Enforcement", 
                                           "Other Healthcare Provider", "Other Provider", "Outreach/Crises Response", "School", 
                                           "Self/Family/Friend", "Other -", "Unkown") ~ "Referral Source",
                           
                           TRUE ~ Subgroup)) %>%
  select(Program, Month, Group, Subgroup, Count) 



```



#bind together
```{r}
full_data <- mget(ls(pattern = "final")) %>%
  bind_rows()

full_data$Month <- as.Date(as.yearmon(full_data$Month))




```





#Seneca WISe (old)
```{r}

service_types <- c("Assessment - Mental Health", "Assessment - Substance Use Disorder", "Care Coordination", "Case Management", "Crisis Services/Management",
         "Engagement and Outreach", "Family Treatment", "Group Treatment", "Individual Treatment - Mental Health", 
         "Individual Treatment - Substance Use Disorder", "Individual Treatment - Other", "Medication Management", "Nursing Care", "Peer Support", "Other")



#read in data
wise_old <- read_excel("N:/BNFFiles/Data Analytics/2024/673055_BehaviorHealth/Data/2021_2023/Seneca-WISe/10.2021 - 6.2022 Seneca Family of Agencies_WISe Team_SC-108530_FINAL - REVISED.xlsx", sheet = 5)

wise_old <- wise_old[c(2, 4, 5, 12:25, 31:35, 38:51, 53:55, 57:63, 65:67, 69:71, 73, 74),]


#filter out empty rows, transpose, filter out quarterly totals
wise_old_t <- as.data.frame(t(wise_old)) %>%
  row_to_names(row_number = 1) 
wise_old_t<- wise_old_t %>%
  filter(`MONTH OF REPORT` %in% month.name)

colnames(wise_old_t)[1] <- "Month"
colnames(wise_old_t)[2] <- "New Clients Served"
colnames(wise_old_t)[3] <- "Total Clients Served"

#race
colnames(wise_old_t)[41] <- "Black or African American"
colnames(wise_old_t)[42] <- "American Indian/Alaskan Native"
colnames(wise_old_t)[45] <- "Another Race"
colnames(wise_old_t)[48] <- "Non-Hispanic or Latino"
colnames(wise_old_t)[49] <- "Unknown Ethnicity"
colnames(wise_old_t)[46] <- "Unknown Race"



#service types

colnames(wise_old_t)[which(names(wise_old_t) %in% c("Assessment", "Mental Health Assessment"))] <- "Assessment - Mental Health"
colnames(wise_old_t)[which(names(wise_old_t) %in% c("Child and Family Team Meeting - Lead Facilitator", "Evaluation/Management - New & Established Client", 
                                                    "Other - Consultation", "Other (please list)", "Psychiatric Diagnostic Evaluation with Med Svcs"))] <- "Other"
colnames(wise_old_t)[which(names(wise_old_t) %in% c("Comprehensive Community Support", "Outreach", "Outreach and Engagement"))] <- "Engagement and Outreach"
colnames(wise_old_t)[which(names(wise_old_t) %in% c("Crisis Intervention"))] <- "Crisis Services/Management"
colnames(wise_old_t)[which(names(wise_old_t) %in% c("First Aid / Physical Health Treatment", "Individual Rehabitation"))] <- "Individual Treatment - Other"
colnames(wise_old_t)[which(names(wise_old_t) %in% c("Group Mental Health Treatment", "Group SUD Treatment", "Other- Group Treatment"))] <- "Group Treatment"
colnames(wise_old_t)[which(names(wise_old_t) %in% c("Individual Mental Health Treatment", "Individual Therapy", "Mental Health Treatment", 
                                                    "Psychiatric Treatment"))] <- "Individual Treatment - Mental Health"
colnames(wise_old_t)[which(names(wise_old_t) %in% c("Individual SUD Treatment", "SUD Treatment"))] <- "Individual Treatment - Substance Use Disorder"
colnames(wise_old_t)[which(names(wise_old_t) %in% c("Nursing Assessment/Evaluation", "Other Nursing", "Other- Nursing"))] <- "Nursing Care"
colnames(wise_old_t)[which(names(wise_old_t) %in% c("Other - Peer Support", "Other Peer Support"))] <- "Peer Support"
colnames(wise_old_t)[which(names(wise_old_t) %in% c("Other Case Coordination/Treatment"))] <- "Care Cooridnation"
colnames(wise_old_t)[which(names(wise_old_t) %in% c("Other Family Treatment", "Family Therapy"))] <- "Family Treatment"
colnames(wise_old_t)[which(names(wise_old_t) %in% c("Medication Support and Training"))] <- "Medication Management"

missing_service <- service_types[-which(service_types %in% colnames(wise_old_t))] %>%
 t(.) %>%
  row_to_names(row_number = 1) %>%
  as.data.frame()
missing_service[1:nrow(wise_old_t),] <- NA

wise_old_t <- cbind(wise_old_t, missing_service)





#zip codes
missing_zips <- zips[-which(zips$Zip %in% colnames(wise_old_t)),1] %>% 
  t(.) %>%
  row_to_names(row_number = 1) %>%
  as.data.frame()
missing_zips[1:nrow(wise_old_t),] <- NA

wise_old_t <- cbind(wise_old_t, missing_zips)

wise_old_t$`Outside of Pierce County` <- NA
wise_old_t$`Unknown Zip Code` <-  NA



#housing status
colnames(wise_old_t)[which(names(wise_old_t) == "Homeless")] <- "Unhoused"
colnames(wise_old_t)[which(names(wise_old_t) == "Permanently Housed")] <- "Stably Housed"
colnames(wise_old_t)[which(names(wise_old_t) == "Other: Residential Treatment")] <- "Residential Treatment"

#veteran status
colnames(wise_old_t)[which(names(wise_old_t) %in% c("# Veterans", "# Active duty service member"))] <- "Veteran/Active Duty"
colnames(wise_old_t)[which(names(wise_old_t) %in% c("# Adult family of a veteran", "Adult family of active duty service member"))] <- "Adult Family of Veteran/Active Duty"
colnames(wise_old_t)[which(names(wise_old_t) %in% c("# Child of a veteran", "# Child of active duty service member"))] <- "Child of Veteran/Active Duty"

#Insurance status
colnames(wise_old_t)[which(names(wise_old_t) == "Commercial/Private")] <- "Private"
colnames(wise_old_t)[which(names(wise_old_t) == "Tricare")] <- "Military Affiliated"

#referral status
colnames(wise_old_t)[which(names(wise_old_t) %in% c("Court Referral including LROs", "Courts", "Juvenile Detention/Courts", "Other: Court/LE", "Criminal Justice"))] <- "Court"
colnames(wise_old_t)[which(names(wise_old_t) %in% c("Central Pierce FD", "East Pierce FD", "Gig Harbor FD", "Graham FR", "Kep Pen FD", "West Pierce FD"))] <-  "Fire Department"
colnames(wise_old_t)[which(names(wise_old_t) %in% c("Children's Hospital", "E&T", "ED/Hospital", "Other Provider: Greater Lakes, Wellfound", "Western State Hospital",
                                                    "Madigan/JBLM"))] <- "Hospital/ED"
colnames(wise_old_t)[which(names(wise_old_t) %in% c("LWPD Co-Responder", "Other LE Jurisdiction", "PC Sheriff", "Pierce County Co-Responder"))] <- "Law Enforcement"
colnames(wise_old_t)[which(names(wise_old_t) %in% c("Other (please list)", "Walk-in"))] <- "Other -"
colnames(wise_old_t)[which(names(wise_old_t) %in% c("Community Provider", "Multicare", "Tricare"))] <- "Other Healthcare Provider"
colnames(wise_old_t)[which(names(wise_old_t) %in% c("Catholic Community Services", "CLR", "Daybreak Youth Services - Spokane", "Other Provider", 
                                                    "Provider", "VA/Vet Center"))] <- "Other Provider"
colnames(wise_old_t)[which(names(wise_old_t) %in% c("Crisis Team / MOCT", "MOCT", "Parkland CRC"))] <- "Outreach/Crises Response"
colnames(wise_old_t)[which(names(wise_old_t) %in% c("Graham Schools ( Bethel ECT)", "School district personnel", "Tacoma School District"))] <- "School"
colnames(wise_old_t)[which(names(wise_old_t) %in% c("Community/Friend", "Family", "Other: Self", "Self/Family", "Returning Client", "Family/Friend", "Online", 
                                                    "Social Media"))] <- "Self/Family/Friend"

# make columns unique, remove unnecessary columns, make counts numeric, add program name
colnames(wise_old_t) <- make.unique(colnames(wise_old_t))
wise_old_t[,2:ncol(wise_old_t)] <- mapply(as.numeric,wise_old_t[,2:ncol(wise_old_t)])
wise_old_t$Program <- "Seneca - Wraparound with Intensive Services"


wise_old_full <- pivot_longer(wise_old_t, cols = -c(Month, Program), names_to = "Subgroup", values_to = "Count") %>%
   mutate(Group = case_when(Subgroup %in% c("Male", "Female", "Other.4") ~ "Gender",
                           Subgroup %in% c("Unhoused", "Unstably Housed", "Stably Housed", "Residential Treatment", "Unknown") ~ "Housing Status",
                           Subgroup %in% c("Private", "Uninsured", "Medicaid", "Military Affiliated", "Unknown.2") ~ "Health Insurance Status",
                           Subgroup %in% c("Veteran/Active Duty", "Adult Family of Veteran/Active Duty", "Child of Veteran/Active Duty",
                                           "Non-Veteran/Active Duty", "Unknown.1") ~ "Veteran Status",
                           grepl("9", Subgroup) | Subgroup %in% c("Outside of Pierce County", "Unknown Zip Code") ~ "Clients Served by Zip Code",
                           Subgroup %in% c("Assessment - Mental Health", "Assessment - Substance Use Disorder", "Care Coordination", "Case Management", 
                                       "Crisis Services/Management", "Engagement and Outreach", "Family Treatment", "Group Treatment", 
                                       "Individual Treatment - Mental Health", "Individual Treatment - Substance Use Disorder", 
                                       "Individual Treatment - Other", "Medication Management", "Nursing Care", "Peer Support", "Other",
                                       "Other.1", "Engagement and Outreach.1", "Other.2") ~ "Service Type",
                           Subgroup %in% c('0-14', "15-17", "18-24", "24-64", "65+") ~ "Age",
                           Subgroup %in% c("Black or African American", "American Indian/Alaskan Native", "Asian", 
                                           "Native Hawaiian / Pacific Islander", "Another Race", "Unknown Race", "Two or More", 
                                           "White", "Unknown Ethnicity", "Hispanic or Latino", "Non-Hispanic or Latino") ~ "Race/Ethnicity",
                           Subgroup %in% c("Unkown", "Court", "Fire Deparment", "Hospital/ED", "Law Enforcement", 
                                           "Other Healthcare Provider", "Other Provider", "Outreach/Crises Response", "School", 
                                           "Self/Family/Friend", "Other.3") ~ "Referral Source",
                           
                           TRUE ~ Subgroup)) %>%
  select(Program, Month, Group, Subgroup, Count) 

wise_old_full <- wise_old_full %>%
  mutate(Month = case_when(Month %in% c("July", "August", "September", "October", "November", "December") ~ paste0(Month, " 2021"),
                           TRUE ~ paste0(Month, " 2022")))




```

#Valley cities (old)
```{r}
vccc_old <- read_excel("N:/BNFFiles/Data Analytics/2024/673055_BehaviorHealth/Data/2021_2023/VCCC-Cohen Veterans Clinic/VCCC_SC-108291_ June 2022.xlsx", 
                       sheet = 5)

vccc_old <- vccc_old[c(2, 4, 16:27, 29:35, 37:74, 76:78, 81:86, 88:90, 92:94),]

vccc_old_t <- as.data.frame(t(vccc_old)) %>%
  row_to_names(row_number = 1)

colnames(vccc_old_t)[1] <- "Month"
colnames(vccc_old_t)[2] <- "New Clients Served"
colnames(vccc_old_t)[21] <- "Total Clients Served"
colnames(vccc_old_t)[70] <- "Non-Hispanic or Latino"
colnames(vccc_old_t)[67] <- "Another Race"
colnames(vccc_old_t)[68] <- "Unknown Race"
colnames(vccc_old_t)[71] <- "Unknown Ethnicity"



vccc_old_t <- vccc_old_t %>%
  filter(is.na(Month)==F,
         Month %in% month.name)

#race
colnames(vccc_old_t)[63] <- "Black or African American"
colnames(vccc_old_t)[64] <- "American Indian/Alaskan Native"


#renaming service types
service_types <- c("Assessment - Mental Health", "Assessment - Substance Use Disorder", "Care Coordination", "Case Management", "Crisis Services/Management",
         "Engagement and Outreach", "Family Treatment", "Group Treatment", "Individual Treatment - Mental Health", 
         "Individual Treatment - Substance Use Disorder", "Individual Treatment - Other", "Medication Management", "Nursing Care", "Peer Support", "Other")

colnames(vccc_old_t)[which(names(vccc_old_t) %in% c("Assessment", "Mental Health Assessment"))] <- "Assessment - Mental Health"
colnames(vccc_old_t)[which(names(vccc_old_t) %in% c("Child and Family Team Meeting - Lead Facilitator", "Evaluation/Management - New & Established Client", 
                                                    "Other - Consultation", "Psychiatric Diagnostic Evaluation with Med Svcs"))] <- "Other"
colnames(vccc_old_t)[which(names(vccc_old_t) %in% c("Comprehensive Community Support", "Outreach", "Outreach and Engagement"))] <- "Engagement and Outreach"
colnames(vccc_old_t)[which(names(vccc_old_t) %in% c("Crisis Intervention"))] <- "Crisis Services/Management"
colnames(vccc_old_t)[which(names(vccc_old_t) %in% c("First Aid / Physical Health Treatment", "Individual Rehabitation"))] <- "Individual Treatment - Other"
colnames(vccc_old_t)[which(names(vccc_old_t) %in% c("Group Mental Health Treatment", "Group SUD Treatment", "Other- Group Treatment"))] <- "Group Treatment"
colnames(vccc_old_t)[which(names(vccc_old_t) %in% c("Individual Mental Health Treatment", "Individual Therapy", "Mental Health Treatment", 
                                                    "Psychiatric Treatment"))] <- "Individual Treatment - Mental Health"
colnames(vccc_old_t)[which(names(vccc_old_t) %in% c("Individual SUD Treatment", "SUD Treatment"))] <- "Individual Treatment - Substance Use Disorder"
colnames(vccc_old_t)[which(names(vccc_old_t) %in% c("Nursing Assessment/Evaluation", "Other Nursing", "Other- Nursing"))] <- "Nursing Care"
colnames(vccc_old_t)[which(names(vccc_old_t) %in% c("Other - Peer Support", "Other Peer Support"))] <- "Peer Support"
colnames(vccc_old_t)[which(names(vccc_old_t) %in% c("Other Case Coordination/Treatment"))] <- "Care Cooridnation"
colnames(vccc_old_t)[which(names(vccc_old_t) %in% c("Other Family Treatment", "Family Therapy"))] <- "Family Treatment"
colnames(vccc_old_t)[which(names(vccc_old_t) %in% c("Medication Support and Training"))] <- "Medication Management"

missing_service <- service_types[-which(service_types %in% colnames(vccc_old_t))] %>%
 t(.) %>%
  row_to_names(row_number = 1) %>%
  as.data.frame()
missing_service[1:nrow(vccc_old_t),] <- NA

vccc_old_t <- cbind(vccc_old_t, missing_service)


#zip codes
missing_zips <- zips[-which(zips$Zip %in% colnames(vccc_old_t)),1] %>% 
  t(.) %>%
  row_to_names(row_number = 1) %>%
  as.data.frame()
missing_zips[1:nrow(vccc_old_t),] <- NA

vccc_old_t <- cbind(vccc_old_t, missing_zips)

vccc_old_t$`Outside of Pierce County` <- NA
vccc_old_t$`Unknown Zip Code` <-  NA


#housing status
colnames(vccc_old_t)[which(names(vccc_old_t) == "Homeless")] <- "Unhoused"
colnames(vccc_old_t)[which(names(vccc_old_t) == "Permanently Housed")] <- "Stably Housed"
colnames(vccc_old_t)[which(names(vccc_old_t) == "Other: Residential Treatment")] <- "Residential Treatment"

#veteran status
colnames(vccc_old_t)[which(names(vccc_old_t) %in% c("# Veterans", "# Active duty service member"))] <- "Veteran/Active Duty"
colnames(vccc_old_t)[which(names(vccc_old_t) %in% c("# Adult family of a veteran", "# Adult family of active duty service member"))] <- "Adult Family of Veteran/Active Duty"
colnames(vccc_old_t)[which(names(vccc_old_t) %in% c("# Child of a veteran", "# Child of active duty service member"))] <- "Child of Veteran/Active Duty"

#Referral
colnames(vccc_old_t)[which(names(vccc_old_t) %in% c("Court Referral including LROs", "Courts", "Juvenile Detention/Courts", "Other: Court/LE", "Criminal Justice"))] <- "Court"
colnames(vccc_old_t)[which(names(vccc_old_t) %in% c("Central Pierce FD", "East Pierce FD", "Gig Harbor FD", "Graham FR", "Kep Pen FD", "West Pierce FD"))] <-  "Fire Department"
colnames(vccc_old_t)[which(names(vccc_old_t) %in% c("Children's Hospital", "E&T", "ED/Hospital", "Other Provider: Greater Lakes, Wellfound", "Western State Hospital",
                                    "Madigan/JBLM"))] <- "Hospital/ED"
colnames(vccc_old_t)[which(names(vccc_old_t) %in% c("LWPD Co-Responder", "Other LE Jurisdiction", "PC Sheriff", "Pierce County Co-Responder"))] <- "Law Enforcement"
colnames(vccc_old_t)[which(names(vccc_old_t) %in% c("Other (please list)", "Walk-in"))] <- "Other -"
colnames(vccc_old_t)[which(names(vccc_old_t) %in% c("Community Provider", "Multicare", "Tricare"))] <- "Other Healthcare Provider"
colnames(vccc_old_t)[which(names(vccc_old_t) %in% c("Catholic Community Services", "CLR", "Daybreak Youth Services - Spokane", "Other Provider", "Provider", "VA/Vet Center"))] <- "Other Provider"
colnames(vccc_old_t)[which(names(vccc_old_t) %in% c("Crisis Team / MOCT", "MOCT", "Parkland CRC"))] <- "Outreach/Crises Response"
colnames(vccc_old_t)[which(names(vccc_old_t) %in% c("Graham Schools ( Bethel ECT)", "School district personnel", "Tacoma School District"))] <- "School"
colnames(vccc_old_t)[which(names(vccc_old_t) %in% c("Community/Friend", "Family", "Other: Self", "Self/Family", "Returning Client", "Family/Friend", "Online", "Social Media"))] <- "Self/Family/Friend"


# make columns unique, remove unnecessary columns, make counts numeric, add program name
colnames(vccc_old_t) <- make.unique(colnames(vccc_old_t))
vccc_old_t[,2:ncol(vccc_old_t)] <- mapply(as.numeric,vccc_old_t[,2:ncol(vccc_old_t)])
vccc_old_t$Program <- "Valley Cities Counseling and Consultations"

vccc_old_full <- pivot_longer(vccc_old_t, cols = -c(Month, Program), names_to = "Subgroup", values_to = "Count") %>%
   mutate(Group = case_when(Subgroup %in% c("Male", "Female", "Other") ~ "Gender",
                           Subgroup %in% c("Unhoused", "Unstably Housed", "Stably Housed", "Residential Treatment", "Unknown") ~ "Housing Status",
                           Subgroup %in% c("Private", "Uninsured", "Medicaid", "Military Affiliated", "Unknown.2") ~ "Health Insurance Status",
                           Subgroup %in% c("Veteran/Active Duty", "Adult Family of Veteran/Active Duty", "Child of Veteran/Active Duty",
                                           "Non-Veteran/Active Duty", "Veteran/Active Duty.1", "Adult Family of Veteran/Active Duty.1",
                                           "Child of Veteran/Active Duty.1") ~ "Veteran Status",
                           grepl("9", Subgroup) | Subgroup %in% c("Outside of Pierce County", "Unknown Zip Code") ~ "Clients Served by Zip Code",
                           Subgroup %in% c("Assessment - Mental Health", "Assessment - Substance Use Disorder", "Care Coordination", "Case Management", 
                                       "Crisis Services/Management", "Engagement and Outreach", "Family Treatment", "Group Treatment", 
                                       "Individual Treatment - Mental Health", "Individual Treatment - Substance Use Disorder", 
                                       "Individual Treatment - Other", "Medication Management", "Nursing Care", "Peer Support", "Other",
                                       "Other.1", "Engagement and Outreach.1", "Other.2") ~ "Service Type",
                           Subgroup %in% c('0-14', "15-17", "18-24", "24-64", "65+") ~ "Age",
                           Subgroup %in% c("Black or African American", "American Indian/Alaskan Native", "Asian", 
                                           "Native Hawaiian / Pacific Islander", "Another Race", "Unknown Race", "Two or More", 
                                           "White", "Unknown Ethnicity", "Hispanic or Latino", "Non-Hispanic or Latino") ~ "Race/Ethnicity",
                           Subgroup %in% c("Unkown", "Court", "Fire Deparment", "Hospital/ED", "Law Enforcement", 
                                           "Other Healthcare Provider", "Other Provider", "Outreach/Crises Response", "School", 
                                           "Self/Family/Friend","Self/Family/Friend.1", "Self/Family/Friend.2", "Self/Family/Friend.3",
                                           "Other -", "Other -.1", "Hospital/ED.1", "Other Healthcare Provider.1") ~ "Referral Source",
                           
                           TRUE ~ Subgroup)) %>%
  select(Program, Month, Group, Subgroup, Count)

vccc_old_full <- vccc_old_full %>%
  mutate(Month = case_when(Month %in% c("July", "August", "September", "October", "November", "December") ~ paste0(Month, " 2021"),
                           TRUE ~ paste0(Month, " 2022")))

```



#Consejo (old)
```{r}
consejo <- read_excel("N:/BNFFiles/Data Analytics/2024/673055_BehaviorHealth/Data/2021_2023/Consejo - School Based/Copy of Consejo_SN_SC-108526_CPR_Value Base-June22-Final.xlsx", sheet = 5)

consejo <- consejo[c(2, 8:20, 34, 35, 36, 43,44,45, 47:54, 56:58, 60:62),]

consejo_old_t <- as.data.frame(t(consejo)) %>%
  row_to_names(row_number = 1)

colnames(consejo_old_t)[1] <- "Month"
colnames(consejo_old_t)[17] <- "New Clients Served"
colnames(consejo_old_t)[22] <- "Black or African American"
colnames(consejo_old_t)[23] <- "American Indian/Alaskan Native"
colnames(consejo_old_t)[26] <- "Another Race"
colnames(consejo_old_t)[27] <- "Unknown Race"
colnames(consejo_old_t)[28] <- "Another Race"
colnames(consejo_old_t)[30] <- "Non-Hispanic or Latino"
colnames(consejo_old_t)[31] <- "Unknown Ethnicity"

consejo_old_t$`Total Clients Served` <- as.numeric(consejo_old_t$`# Non-Medicaid Clients Served`) + as.numeric(consejo_old_t$`# Medicaid Clients Served`)

colnames(consejo_old_t) <- make.unique(colnames(consejo_old_t))

consejo_old_t <- consejo_old_t %>%
  filter(Month %in% month.name)


#referral status
colnames(consejo_old_t)[which(names(consejo_old_t) %in% c("Court Referral including LROs", "Courts", "Juvenile Detention/Courts", "Other: Court/LE", "Criminal Justice"))] <- "Court"
colnames(consejo_old_t)[which(names(consejo_old_t) %in% c("Central Pierce FD", "East Pierce FD", "Gig Harbor FD", "Graham FR", "Kep Pen FD", "West Pierce FD"))] <-  "Fire Department"
colnames(consejo_old_t)[which(names(consejo_old_t) %in% c("Children's Hospital", "E&T", "ED/Hospital", "Other Provider: Greater Lakes, Wellfound", "Western State Hospital",
                                                    "Madigan/JBLM"))] <- "Hospital/ED"
colnames(consejo_old_t)[which(names(consejo_old_t) %in% c("LWPD Co-Responder", "Other LE Jurisdiction", "PC Sheriff", "Pierce County Co-Responder"))] <- "Law Enforcement"
colnames(consejo_old_t)[which(names(consejo_old_t) %in% c("Other (please list)", "Walk-in"))] <- "Other -"
colnames(consejo_old_t)[which(names(consejo_old_t) %in% c("Community Provider", "MultiCare", "Tricare"))] <- "Other Healthcare Provider"
colnames(consejo_old_t)[which(names(consejo_old_t) %in% c("Catholic Community Services", "CLR", "Daybreak Youth Services - Spokane", 
                                                          "Other provider", "Provider", "VA/Vet Center"))] <- "Other Provider"
colnames(consejo_old_t)[which(names(consejo_old_t) %in% c("Crisis Team / MOCT", "MOCT", "Parkland CRC"))] <- "Outreach/Crises Response"
colnames(consejo_old_t)[which(names(consejo_old_t) %in% c("Graham Schools ( Bethel Ect)", "School disrict personnel", 
                                                          "Tacoma School District"))] <- "School"
colnames(consejo_old_t)[which(names(consejo_old_t) %in% c("Community/Friend", "Family", "Other: Self", "Self/Family", "Self/family","Returning Client", "Family/Friend", "Online", 
                                                    "Social Media"))] <- "Self/Family/Friend"


#renaming service types
missing_service <- service_types[-which(service_types %in% colnames(consejo_old_t))] %>%
 t(.) %>%
  row_to_names(row_number = 1) %>%
  as.data.frame()
missing_service[1:nrow(consejo_old_t),] <- NA

consejo_old_t <- cbind(consejo_old_t, missing_service)


#zip codes
missing_zips <- zips[-which(zips$Zip %in% colnames(consejo_old_t)),1] %>% 
  t(.) %>%
  row_to_names(row_number = 1) %>%
  as.data.frame()
missing_zips[1:nrow(consejo_old_t),] <- NA

consejo_old_t <- cbind(consejo_old_t, missing_zips)

consejo_old_t$`Outside of Pierce County` <- NA
consejo_old_t$`Unknown Zip Code` <-  NA


#housing status
colnames(consejo_old_t)[which(names(consejo_old_t) == "Homeless")] <- "Unhoused"
colnames(consejo_old_t)[which(names(consejo_old_t) == "Permanently Housed")] <- "Stably Housed"
colnames(consejo_old_t)[which(names(consejo_old_t) == "Other: Residential Treatment")] <- "Residential Treatment"

#veteran status
colnames(consejo_old_t)[which(names(consejo_old_t) %in% c("# Veterans", "# Active duty service member"))] <- "Veteran/Active Duty"
colnames(consejo_old_t)[which(names(consejo_old_t) %in% c("# Adult family of a veteran", "# Adult family of active duty service member"))] <- "Adult Family of Veteran/Active Duty"
colnames(consejo_old_t)[which(names(consejo_old_t) %in% c("# Child of a veteran", "# Child of active duty service member"))] <- "Child of Veteran/Active Duty"




# make columns unique, remove unnecessary columns, make counts numeric, add program name
consejo_old_t[,2:ncol(consejo_old_t)] <- mapply(as.numeric,consejo_old_t[,2:ncol(consejo_old_t)])
consejo_old_t$Program <- "Consejo"



consejo_old_full <- pivot_longer(consejo_old_t, cols = -c(Month, Program), names_to = "Subgroup", values_to = "Count") %>%
   mutate(Group = case_when(Subgroup %in% c("Male", "Female", "Other") ~ "Gender",
                           Subgroup %in% c("Unhoused", "Unstably Housed", "Stably Housed", "Residential Treatment", "Unknown") ~ "Housing Status",
                           Subgroup %in% c("Private", "Uninsured", "Medicaid", "Military Affiliated", "Unknown.2") ~ "Health Insurance Status",
                           Subgroup %in% c("Veteran/Active Duty", "Adult Family of Veteran/Active Duty", "Child of Veteran/Active Duty",
                                           "Non-Veteran/Active Duty", "Veteran/Active Duty.1", "Adult Family of Veteran/Active Duty.1",
                                           "Child of Veteran/Active Duty.1") ~ "Veteran Status",
                           grepl("9", Subgroup) | Subgroup %in% c("Outside of Pierce County", "Unknown Zip Code") ~ "Clients Served by Zip Code",
                           Subgroup %in% c("Assessment - Mental Health", "Assessment - Substance Use Disorder", "Care Coordination", "Case Management", 
                                       "Crisis Services/Management", "Engagement and Outreach", "Family Treatment", "Group Treatment", 
                                       "Individual Treatment - Mental Health", "Individual Treatment - Substance Use Disorder", 
                                       "Individual Treatment - Other", "Medication Management", "Nursing Care", "Peer Support", "Other",
                                       "Other.1", "Engagement and Outreach.1", "Other.2") ~ "Service Type",
                           Subgroup %in% c('0-14', "15-17", "18-24", "24-64", "65+") ~ "Age",
                           Subgroup %in% c("Black or African American", "American Indian/Alaskan Native", "Asian", 
                                           "Native Hawaiian / Pacific Islander", "Another Race", "Unknown Race", "Two or More", 
                                           "White", "Unknown Ethnicity", "Hispanic or Latino", "Non-Hispanic or Latino", 
                                           "Another Race.1") ~ "Race/Ethnicity",
                           Subgroup %in% c("Unkown", "Court", "Fire Deparment", "Hospital/ED", "Law Enforcement", 
                                           "Other Healthcare Provider", "Other Provider", "Outreach/Crises Response", "School", 
                                           "Self/Family/Friend","Self/Family/Friend.1", "Self/Family/Friend.2", "Self/Family/Friend.3",
                                           "Other -", "Other -.1", "Hospital/ED.1", "Other Healthcare Provider.1") ~ "Referral Source",
                           
                           TRUE ~ Subgroup)) %>%
  select(Program, Month, Group, Subgroup, Count) %>%
  filter(Subgroup != "# Non-Medicaid Clients Served",
         Subgroup != "# Medicaid Clients Served")
  
consejo_old_full <- consejo_old_full %>%
  mutate(Month = case_when(Month %in% c("July", "August", "September", "October", "November", "December") ~ paste0(Month, " 2021"),
                           TRUE ~ paste0(Month, " 2022")))





```

#PCA-Alternative to Confinement (old)
```{r}
atc_old <- read_excel("N:/BNFFiles/Data Analytics/2024/673055_BehaviorHealth/Data/2021_2023/PCA - ATC/09082022_Copy of June 2022 ATC Invoice_updated.xlsx", sheet = 5)

atc_old <- atc_old[c(2, 4, 5, 19:24, 33:35, 37:43, 45:47, 49:51, 53:55),]

atc_old_t <- as.data.frame(t(atc_old)) %>%
  row_to_names(row_number = 1)

colnames(atc_old_t)[1] <- "Month"
colnames(atc_old_t)[2] <- "New Clients Served"
colnames(atc_old_t)[3] <- "Total Clients Served"
colnames(atc_old_t)[14] <- "Black or African American"
colnames(atc_old_t)[15] <- "American Indian/Alaskan Native"
colnames(atc_old_t)[18] <- "Another Race"
colnames(atc_old_t)[19] <- "Unknown Race"
colnames(atc_old_t)[21] <- "Non-Hispanic or Latino"
colnames(atc_old_t)[22] <- "Unknown Ethnicity"

atc_old_t <- atc_old_t %>%
  filter(Month %in% month.name)




#referral status
colnames(atc_old_t)[which(names(atc_old_t) %in% c("Court Referral including LROs", "Courts", "Juvenile Detention/Courts", "Other: Court/LE", "Criminal Justice"))] <- "Court"
colnames(atc_old_t)[which(names(atc_old_t) %in% c("Central Pierce FD", "East Pierce FD", "Gig Harbor FD", "Graham FR", "Kep Pen FD", "West Pierce FD"))] <-  "Fire Department"
colnames(atc_old_t)[which(names(atc_old_t) %in% c("Children's Hospital", "E&T", "ED/Hospital", "Other Provider: Greater Lakes, Wellfound", "Western State Hospital",
                                                    "Madigan/JBLM"))] <- "Hospital/ED"
colnames(atc_old_t)[which(names(atc_old_t) %in% c("LWPD Co-Responder", "Other LE Jurisdiction", "PC Sheriff", "Pierce County Co-Responder"))] <- "Law Enforcement"
colnames(atc_old_t)[which(names(atc_old_t) %in% c("Other (please list).1", "Walk-in"))] <- "Other -"
colnames(atc_old_t)[which(names(atc_old_t) %in% c("Community Provider", "Multicare", "Tricare"))] <- "Other Healthcare Provider"
colnames(atc_old_t)[which(names(atc_old_t) %in% c("Catholic Community Services", "CLR", "Daybreak Youth Services - Spokane", "Other Provider", 
                                                    "Provider", "VA/Vet Center"))] <- "Other Provider"
colnames(atc_old_t)[which(names(atc_old_t) %in% c("Crisis Team / MOCT", "MOCT", "Parkland CRC"))] <- "Outreach/Crises Response"
colnames(atc_old_t)[which(names(atc_old_t) %in% c("Graham Schools ( Bethel ECT)", "School district personnel", "Tacoma School District"))] <- "School"
colnames(atc_old_t)[which(names(atc_old_t) %in% c("Community/Friend", "Family", "Other: Self", "Self/Family", "Self/family","Returning Client", "Family/Friend", "Online", 
                                                    "Social Media"))] <- "Self/Family/Friend"


#renaming service types
#missing_service <- service_types[-which(service_types %in% colnames(atc_old_t))] %>%
# t(.) %>%
#  row_to_names(row_number = 1) %>%
#  as.data.frame()
#missing_service[1:nrow(atc_old_t),] <- NA

#atc_old_t <- cbind(atc_old_t, missing_service)


#zip codes
missing_zips <- zips[-which(zips$Zip %in% colnames(atc_old_t)),1] %>% 
  t(.) %>%
  row_to_names(row_number = 1) %>%
  as.data.frame()
missing_zips[1:nrow(atc_old_t),] <- NA

atc_old_t <- cbind(atc_old_t, missing_zips)

atc_old_t$`Outside of Pierce County` <- NA
atc_old_t$`Unknown Zip Code` <-  NA


#housing status
colnames(atc_old_t)[which(names(atc_old_t) == "Homeless")] <- "Unhoused"
colnames(atc_old_t)[which(names(atc_old_t) == "Permanently Housed")] <- "Stably Housed"
colnames(atc_old_t)[which(names(atc_old_t) == "Other: Residential Treatment")] <- "Residential Treatment"

#veteran status
colnames(atc_old_t)[which(names(atc_old_t) %in% c("# Veterans", "# Active duty service member"))] <- "Veteran/Active Duty"
colnames(atc_old_t)[which(names(atc_old_t) %in% c("# Adult family of a veteran", "# Adult family of active duty service member"))] <- "Adult Family of Veteran/Active Duty"
colnames(atc_old_t)[which(names(atc_old_t) %in% c("# Child of a veteran", "# Child of active duty service member"))] <- "Child of Veteran/Active Duty"




# make columns unique, remove unnecessary columns, make counts numeric, add program name
atc_old_t[,2:ncol(atc_old_t)] <- mapply(as.numeric,atc_old_t[,2:ncol(atc_old_t)])
atc_old_t$Program <- "Pierce County Alliance - Alternative to Confinement"

atc_old_full <- pivot_longer(atc_old_t, cols = -c(Month, Program), names_to = "Subgroup", values_to = "Count") %>%
   mutate(Group = case_when(Subgroup %in% c("Male", "Female", "Other") ~ "Gender",
                           Subgroup %in% c("Unhoused", "Unstably Housed", "Stably Housed", "Residential Treatment", "Unknown") ~ "Housing Status",
                           Subgroup %in% c("Private", "Uninsured", "Medicaid", "Military Affiliated", "Unknown.2", "Commercial/Private") 
                           ~ "Health Insurance Status",
                           Subgroup %in% c("Veteran/Active Duty", "Adult Family of Veteran/Active Duty", "Child of Veteran/Active Duty",
                                           "Non-Veteran/Active Duty", "Veteran/Active Duty.1", "Adult Family of Veteran/Active Duty.1",
                                           "Child of Veteran/Active Duty.1") ~ "Veteran Status",
                           grepl("9", Subgroup) | Subgroup %in% c("Outside of Pierce County", "Unknown Zip Code") ~ "Clients Served by Zip Code",
                           Subgroup %in% c("Assessment - Mental Health", "Assessment - Substance Use Disorder", "Care Coordination", "Case Management", 
                                       "Crisis Services/Management", "Engagement and Outreach", "Family Treatment", "Group Treatment", 
                                       "Individual Treatment - Mental Health", "Individual Treatment - Substance Use Disorder", 
                                       "Individual Treatment - Other", "Medication Management", "Nursing Care", "Peer Support", "Other",
                                       "Other.1", "Engagement and Outreach.1", "Other.2") ~ "Service Type",
                           Subgroup %in% c('0-14', "15-17", "18-24", "24-64", "65+") ~ "Age",
                           Subgroup %in% c("Black or African American", "American Indian/Alaskan Native", "Asian", 
                                           "Native Hawaiian / Pacific Islander", "Another Race", "Unknown Race", "Two or More", 
                                           "White", "Unknown Ethnicity", "Hispanic or Latino", "Non-Hispanic or Latino") ~ "Race/Ethnicity",
                           Subgroup %in% c("Unkown", "Court", "Fire Deparment", "Hospital/ED", "Law Enforcement", 
                                           "Other Healthcare Provider", "Other Provider", "Outreach/Crises Response", "School", 
                                           "Self/Family/Friend","Self/Family/Friend.1", "Self/Family/Friend.2", "Self/Family/Friend.3",
                                           "Other -", "Other -.1", "Hospital/ED.1", "Other Healthcare Provider.1") ~ "Referral Source",
                           
                           TRUE ~ Subgroup)) %>%
  select(Program, Month, Group, Subgroup, Count) 

atc_old_full$Month <- paste0(atc_old_full$Month, " 2022")


```

#CLR-School (old)
```{r}
clr_school_old <- read_excel("N:/BNFFiles/Data Analytics/2024/673055_BehaviorHealth/Data/2021_2023/CLR School-based/CLEANED_CLR_School Navigator_SC-108531-1 June 2022.xlsx",
                             sheet = 5)

clr_school_old <- clr_school_old[c(2,4,5,6,11:21, 23:26, 35:37, 39:45, 47:49),]

clr_school_old_t <- as.data.frame(t(clr_school_old)) %>%
  row_to_names(row_number = 1)

colnames(clr_school_old_t)[1] <- "Month"
colnames(clr_school_old_t)[2] <- "New Clients Served"
colnames(clr_school_old_t)[24] <- "Black or African American"
colnames(clr_school_old_t)[25] <- "American Indian/Alaskan Native"
colnames(clr_school_old_t)[28] <- "Another Race"
colnames(clr_school_old_t)[29] <- "Unknown Race"
colnames(clr_school_old_t)[31] <- "Non-Hispanic or Latino"
colnames(clr_school_old_t)[32] <- "Unknown Ethnicity"

clr_school_old_t <- clr_school_old_t %>%
  filter(Month %in% month.name)

clr_school_old_t$`Total Clients Served` <- as.numeric(clr_school_old_t$`# Non-Medicaid Clients Served`) + as.numeric(clr_school_old_t$`# Medicaid Clients Served`) 

#get rid of medicaid and non-medicaid also lose September(reported in hours)
clr_school_old_t <- clr_school_old_t %>%
  select(-`# Non-Medicaid Clients Served`,
         -`# Medicaid Clients Served`) %>%
  filter(Month != "September",
         Month != "August")


#referral status
colnames(clr_school_old_t)[which(names(clr_school_old_t) %in% c("Court Referral including LROs", "Courts", "Juvenile Detention/Courts", 
                                                                "Other: Court/LE", "Criminal Justice"))] <- "Court"
colnames(clr_school_old_t)[which(names(clr_school_old_t) %in% c("Central Pierce FD", "East Pierce FD", "Gig Harbor FD", "Graham FR", 
                                                                "Kep Pen FD", "West Pierce FD"))] <-  "Fire Department"
colnames(clr_school_old_t)[which(names(clr_school_old_t) %in% c("Children's Hospital", "E&T", "ED/Hospital", 
                                                                "Other Provider: Greater Lakes, Wellfound", "Western State Hospital",
                                                                "Madigan/JBLM"))] <- "Hospital/ED"
colnames(clr_school_old_t)[which(names(clr_school_old_t) %in% c("LWPD Co-Responder", "Other LE Jurisdiction", "PC Sheriff", 
                                                                "Pierce County Co-Responder"))] <- "Law Enforcement"
colnames(clr_school_old_t)[which(names(clr_school_old_t) %in% c("Other (please list)", "Walk-in"))] <- "Other -"
colnames(clr_school_old_t)[which(names(clr_school_old_t) %in% c("Community Provider", "Multicare", "Tricare"))] <- "Other Healthcare Provider"
colnames(clr_school_old_t)[which(names(clr_school_old_t) %in% c("Catholic Community Services", "CLR", "Daybreak Youth Services - Spokane", "Other Provider",
                                                                "Provider", "VA/Vet Center", "Other provider"))] <- "Other Provider"
colnames(clr_school_old_t)[which(names(clr_school_old_t) %in% c("Crisis Team / MOCT", "MOCT", "Parkland CRC"))] <- "Outreach/Crises Response"
colnames(clr_school_old_t)[which(names(clr_school_old_t) %in% c("Graham Schools ( Bethel ECT)", "School district personnel", 
                                                                "Tacoma School District"))] <- "School"
colnames(clr_school_old_t)[which(names(clr_school_old_t) %in% c("Community/Friend", "Family", "Other: Self", "Self/Family", 
                                                                "Self/family","Returning Client", "Family/Friend", "Online", 
                                                                "Social Media"))] <- "Self/Family/Friend"


#renaming service types
service_types <- c("Assessment - Mental Health", "Assessment - Substance Use Disorder", "Care Coordination", "Case Management", 
                   "Crisis Services/Management","Engagement and Outreach", "Family Treatment", "Group Treatment", 
                   "Individual Treatment - Mental Health", "Individual Treatment - Substance Use Disorder", 
                   "Individual Treatment - Other", "Medication Management", "Nursing Care", "Peer Support", "Other")

colnames(clr_school_old_t)[which(names(clr_school_old_t) %in% c("Assessment", "Mental Health Assessment"))] <- "Assessment - Mental Health"
colnames(clr_school_old_t)[which(names(clr_school_old_t) %in% c("Child and Family Team Meeting - Lead Facilitator", 
                                                                "Evaluation/Management - New & Established Client", 
                                                                "Other - Consultation", "Psychiatric Diagnostic Evaluation with Med Svcs", 
                                                                "Other (please list)"))] <- "Other"
colnames(clr_school_old_t)[which(names(clr_school_old_t) %in% c("Comprehensive Community Support", "Outreach", 
                                                                "Outreach and Engagement"))] <- "Engagement and Outreach"
colnames(clr_school_old_t)[which(names(clr_school_old_t) %in% c("Crisis Intervention"))] <- "Crisis Services/Management"
colnames(clr_school_old_t)[which(names(clr_school_old_t) %in% c("First Aid / Physical Health Treatment", 
                                                                "Individual Rehabitation"))] <- "Individual Treatment - Other"
colnames(clr_school_old_t)[which(names(clr_school_old_t) %in% c("Group Mental Health Treatment", "Group SUD Treatment", 
                                                                "Other- Group Treatment"))] <- "Group Treatment"
colnames(clr_school_old_t)[which(names(clr_school_old_t) %in% c("Individual Mental Health Treatment", "Individual Therapy", "Mental Health Treatment", 
                                                    "Psychiatric Treatment"))] <- "Individual Treatment - Mental Health"
colnames(clr_school_old_t)[which(names(clr_school_old_t) %in% c("Individual SUD Treatment", 
                                                                "SUD Treatment"))] <- "Individual Treatment - Substance Use Disorder"
colnames(clr_school_old_t)[which(names(clr_school_old_t) %in% c("Nursing Assessment/Evaluation", "Other Nursing", "Other- Nursing"))] <- "Nursing Care"
colnames(clr_school_old_t)[which(names(clr_school_old_t) %in% c("Other - Peer Support", "Other Peer Support"))] <- "Peer Support"
colnames(clr_school_old_t)[which(names(clr_school_old_t) %in% c("Other Case Coordination/Treatment", "Care Cooridnation"))] <- "Care Coordination"
colnames(clr_school_old_t)[which(names(clr_school_old_t) %in% c("Other Family Treatment", "Family Therapy"))] <- "Family Treatment"
colnames(clr_school_old_t)[which(names(clr_school_old_t) %in% c("Medication Support and Training"))] <- "Medication Management"

#missing_service <- service_types[-which(service_types %in% colnames(clr_school_old_t))] %>%
# t(.) %>%
#  row_to_names(row_number = 1) %>%
#  as.data.frame()
#missing_service[1:nrow(clr_school_old_t),] <- NA

#clr_school_old_t <- cbind(clr_school_old_t, missing_service)


#zip codes (not reported, not adding)
#missing_zips <- zips[-which(zips$Zip %in% colnames(clr_school_old_t)),1] %>% 
#  t(.) %>%
#  row_to_names(row_number = 1) %>%
#  as.data.frame()
#missing_zips[1:nrow(clr_school_old_t),] <- NA

#clr_school_old_t <- cbind(clr_school_old_t, missing_zips)

#clr_school_old_t$`Outside of Pierce County` <- NA
#clr_school_old_t$`Unknown Zip Code` <-  NA


#housing status
colnames(clr_school_old_t)[which(names(clr_school_old_t) == "Homeless")] <- "Unhoused"
colnames(clr_school_old_t)[which(names(clr_school_old_t) == "Permanently Housed")] <- "Stably Housed"
colnames(clr_school_old_t)[which(names(clr_school_old_t) == "Other: Residential Treatment")] <- "Residential Treatment"

#veteran status
colnames(clr_school_old_t)[which(names(clr_school_old_t) %in% c("# Veterans", "# Active duty service member"))] <- "Veteran/Active Duty"
colnames(clr_school_old_t)[which(names(clr_school_old_t) %in% c("# Adult family of a veteran", "# Adult family of active duty service member"))] <- "Adult Family of Veteran/Active Duty"
colnames(clr_school_old_t)[which(names(clr_school_old_t) %in% c("# Child of a veteran", "# Child of active duty service member"))] <- "Child of Veteran/Active Duty"




# make columns unique, remove unnecessary columns, make counts numeric, add program name
clr_school_old_t[,2:ncol(clr_school_old_t)] <- mapply(as.numeric,clr_school_old_t[,2:ncol(clr_school_old_t)])
clr_school_old_t$Program <- "Comprehensive Life Resources - School Connect"

clr_school_old_full <- pivot_longer(clr_school_old_t, cols = -c(Month, Program), names_to = "Subgroup", values_to = "Count") %>%
   mutate(Group = case_when(Subgroup %in% c("Male", "Female", "Other") ~ "Gender",
                           Subgroup %in% c("Unhoused", "Unstably Housed", "Stably Housed", "Residential Treatment", "Unknown") ~ "Housing Status",
                           Subgroup %in% c("Private", "Uninsured", "Medicaid", "Military Affiliated", "Unknown.2", "Commercial/Private") 
                           ~ "Health Insurance Status",
                           Subgroup %in% c("Veteran/Active Duty", "Adult Family of Veteran/Active Duty", "Child of Veteran/Active Duty",
                                           "Non-Veteran/Active Duty", "Veteran/Active Duty.1", "Adult Family of Veteran/Active Duty.1",
                                           "Child of Veteran/Active Duty.1") ~ "Veteran Status",
                           grepl("9", Subgroup) | Subgroup %in% c("Outside of Pierce County", "Unknown Zip Code") ~ "Clients Served by Zip Code",
                           Subgroup %in% c("Assessment - Mental Health", "Assessment - Substance Use Disorder", "Care Coordination", "Case Management", 
                                       "Crisis Services/Management", "Engagement and Outreach", "Family Treatment", "Group Treatment", 
                                       "Individual Treatment - Mental Health", "Individual Treatment - Substance Use Disorder", 
                                       "Individual Treatment - Other", "Medication Management", "Nursing Care", "Peer Support", "Other",
                                       "Other.1", "Engagement and Outreach.1", "Other.2") ~ "Service Type",
                           Subgroup %in% c('0-14', "15-17", "18-24", "24-64", "65+") ~ "Age",
                           Subgroup %in% c("Black or African American", "American Indian/Alaskan Native", "Asian", 
                                           "Native Hawaiian / Pacific Islander", "Another Race", "Unknown Race", "Two or More", 
                                           "White", "Unknown Ethnicity", "Hispanic or Latino", "Non-Hispanic or Latino") ~ "Race/Ethnicity",
                           Subgroup %in% c("Unkown", "Court", "Fire Deparment", "Hospital/ED", "Law Enforcement", 
                                           "Other Healthcare Provider", "Other Provider", "Outreach/Crises Response", "School", 
                                           "Self/Family/Friend","Self/Family/Friend.1", "Self/Family/Friend.2", "Self/Family/Friend.3",
                                           "Other -", "Other -.1", "Hospital/ED.1", "Other Healthcare Provider.1") ~ "Referral Source",
                           
                           TRUE ~ Subgroup)) %>%
  select(Program, Month, Group, Subgroup, Count) 

clr_school_old_full <- clr_school_old_full %>%
  mutate(Month = case_when(Month %in% c("July", "August", "September", "October", "November", "December") ~ paste0(Month, " 2021"),
                           TRUE ~ paste0(Month, " 2022")))

```


#CLR-AOT(old)
```{r}
clr_aot_old <- read_excel("N:/BNFFiles/Data Analytics/2024/673055_BehaviorHealth/Data/2021_2023/CLR-AOT/Copy of BH-189-CLR-AOT-SC-108482-JUNE22.xlsx",
                      sheet = 5)

clr_aot_old <- clr_aot_old[c(2,4,5,7:15,23:29,36:38,40:46, 48:50, 52:55),]

clr_aot_old_t <- as.data.frame(t(clr_aot_old)) %>%
  row_to_names(row_number = 1)


colnames(clr_aot_old_t)[1] <- "Month"
colnames(clr_aot_old_t)[2] <- "Total Clients Served"
colnames(clr_aot_old_t)[3] <- "New Clients Served"
colnames(clr_aot_old_t)[24] <- "Black or African American"
colnames(clr_aot_old_t)[25] <- "American Indian/Alaskan Native"
colnames(clr_aot_old_t)[28] <- "Another Race"
colnames(clr_aot_old_t)[29] <- "Unknown Race"
colnames(clr_aot_old_t)[31] <- "Non-Hispanic or Latino"
colnames(clr_aot_old_t)[32] <- "Unknown Ethnicity"

clr_aot_old_t <- clr_aot_old_t %>%
  filter(Month %in% month.name)

#referral status
colnames(clr_aot_old_t)[which(names(clr_aot_old_t) %in% c("Court Referral including LROs", "Courts", "Juvenile Detention/Courts", "Other: Court/LE", "Criminal Justice"))] <- "Court"
colnames(clr_aot_old_t)[which(names(clr_aot_old_t) %in% c("Central Pierce FD", "East Pierce FD", "Gig Harbor FD", "Graham FR", "Kep Pen FD", "West Pierce FD"))] <-  "Fire Department"
colnames(clr_aot_old_t)[which(names(clr_aot_old_t) %in% c("Children's Hospital", "E&T", "ED/Hospital", "Other Provider: Greater Lakes, Wellfound", "Western State Hospital",
                                                    "Madigan/JBLM"))] <- "Hospital/ED"
colnames(clr_aot_old_t)[which(names(clr_aot_old_t) %in% c("LWPD Co-Responder", "Other LE Jurisdiction", "PC Sheriff", "Pierce County Co-Responder"))] <- "Law Enforcement"
colnames(clr_aot_old_t)[which(names(clr_aot_old_t) %in% c("Other (please list).1", "Walk-in"))] <- "Other -"
colnames(clr_aot_old_t)[which(names(clr_aot_old_t) %in% c("Community Provider", "Multicare", "Tricare"))] <- "Other Healthcare Provider"
colnames(clr_aot_old_t)[which(names(clr_aot_old_t) %in% c("Catholic Community Services", "CLR", "Daybreak Youth Services - Spokane", "Other Provider", 
                                                    "Provider", "VA/Vet Center"))] <- "Other Provider"
colnames(clr_aot_old_t)[which(names(clr_aot_old_t) %in% c("Crisis Team / MOCT", "MOCT", "Parkland CRC"))] <- "Outreach/Crises Response"
colnames(clr_aot_old_t)[which(names(clr_aot_old_t) %in% c("Graham Schools ( Bethel ECT)", "School district personnel", "Tacoma School District"))] <- "School"
colnames(clr_aot_old_t)[which(names(clr_aot_old_t) %in% c("Community/Friend", "Family", "Other: Self", "Self/Family", "Self/family","Returning Client", "Family/Friend", "Online", 
                                                    "Social Media"))] <- "Self/Family/Friend"


#renaming service types

service_types <- c("Assessment - Mental Health", "Assessment - Substance Use Disorder", "Care Coordination", "Case Management", 
                   "Crisis Services/Management","Engagement and Outreach", "Family Treatment", "Group Treatment", 
                   "Individual Treatment - Mental Health", "Individual Treatment - Substance Use Disorder", 
                   "Individual Treatment - Other", "Medication Management", "Nursing Care", "Peer Support", "Other")

colnames(clr_aot_old_t)[which(names(clr_aot_old_t) %in% c("Assessment", "Mental Health Assessment"))] <- "Assessment - Mental Health"
colnames(clr_aot_old_t)[which(names(clr_aot_old_t) %in% c("Child and Family Team Meeting - Lead Facilitator", 
                                                                "Evaluation/Management - New & Established Client", 
                                                                "Other - Consultation", "Psychiatric Diagnostic Evaluation with Med Svcs", 
                                                                "Other (please list)"))] <- "Other"
colnames(clr_aot_old_t)[which(names(clr_aot_old_t) %in% c("Comprehensive Community Support", "Outreach", 
                                                                "Outreach and Engagement"))] <- "Engagement and Outreach"
colnames(clr_aot_old_t)[which(names(clr_aot_old_t) %in% c("Crisis Intervention"))] <- "Crisis Services/Management"
colnames(clr_aot_old_t)[which(names(clr_aot_old_t) %in% c("First Aid / Physical Health Treatment", 
                                                                "Individual Rehabitation"))] <- "Individual Treatment - Other"
colnames(clr_aot_old_t)[which(names(clr_aot_old_t) %in% c("Group Mental Health Treatment", "Group SUD Treatment", 
                                                                "Other- Group Treatment"))] <- "Group Treatment"
colnames(clr_aot_old_t)[which(names(clr_aot_old_t) %in% c("Individual Mental Health Treatment", "Individual Therapy", "Mental Health Treatment", 
                                                    "Psychiatric Treatment"))] <- "Individual Treatment - Mental Health"
colnames(clr_aot_old_t)[which(names(clr_aot_old_t) %in% c("Individual SUD Treatment", 
                                                                "SUD Treatment"))] <- "Individual Treatment - Substance Use Disorder"
colnames(clr_aot_old_t)[which(names(clr_aot_old_t) %in% c("Nursing Assessment/Evaluation", "Other Nursing", "Other- Nursing"))] <- "Nursing Care"
colnames(clr_aot_old_t)[which(names(clr_aot_old_t) %in% c("Other - Peer Support", "Other Peer Support"))] <- "Peer Support"
colnames(clr_aot_old_t)[which(names(clr_aot_old_t) %in% c("Other Case Coordination/Treatment", "Care Cooridnation"))] <- "Care Coordination"
colnames(clr_aot_old_t)[which(names(clr_aot_old_t) %in% c("Other Family Treatment", "Family Therapy"))] <- "Family Treatment"
colnames(clr_aot_old_t)[which(names(clr_aot_old_t) %in% c("Medication Support and Training"))] <- "Medication Management"

#missing_service <- service_types[-which(service_types %in% colnames(clr_aot_old_t))] %>%
# t(.) %>%
#  row_to_names(row_number = 1) %>%
#  as.data.frame()
#missing_service[1:nrow(clr_aot_old_t),] <- NA

#clr_aot_old_t <- cbind(clr_aot_old_t, missing_service)


#zip codes
#missing_zips <- zips[-which(zips$Zip %in% colnames(clr_aot_old_t)),1] %>% 
 # t(.) %>%
#  row_to_names(row_number = 1) %>%
#  as.data.frame()
#missing_zips[1:nrow(clr_aot_old_t),] <- NA

#clr_aot_old_t <- cbind(clr_aot_old_t, missing_zips)

#clr_aot_old_t$`Outside of Pierce County` <- NA
#clr_aot_old_t$`Unknown Zip Code` <-  NA


#housing status
colnames(clr_aot_old_t)[which(names(clr_aot_old_t) == "Homeless")] <- "Unhoused"
colnames(clr_aot_old_t)[which(names(clr_aot_old_t) == "Permanently Housed")] <- "Stably Housed"
colnames(clr_aot_old_t)[which(names(clr_aot_old_t) == "Other: Residential Treatment")] <- "Residential Treatment"

#veteran status
colnames(clr_aot_old_t)[which(names(clr_aot_old_t) %in% c("# Veterans", "# Active duty service member"))] <- "Veteran/Active Duty"
colnames(clr_aot_old_t)[which(names(clr_aot_old_t) %in% c("# Adult family of a veteran", "# Adult family of active duty service member"))] <- "Adult Family of Veteran/Active Duty"
colnames(clr_aot_old_t)[which(names(clr_aot_old_t) %in% c("# Child of a veteran", "# Child of active duty service member"))] <- "Child of Veteran/Active Duty"




# make columns unique, remove unnecessary columns, make counts numeric, add program name
colnames(clr_aot_old_t) <- make.unique(colnames(clr_aot_old_t))
clr_aot_old_t[,2:ncol(clr_aot_old_t)] <- mapply(as.numeric,clr_aot_old_t[,2:ncol(clr_aot_old_t)])
clr_aot_old_t$Program <- "Comprehensive Life Resources - Assisted Outpatient Treatment"

clr_aot_old_full <- pivot_longer(clr_aot_old_t, cols = -c(Month, Program), names_to = "Subgroup", values_to = "Count") %>%
   mutate(Group = case_when(Subgroup %in% c("Male", "Female", "Other.1") ~ "Gender",
                           Subgroup %in% c("Unhoused", "Unstably Housed", "Stably Housed", "Residential Treatment", "Unknown") ~ "Housing Status",
                           Subgroup %in% c("Private", "Uninsured", "Medicaid", "Military Affiliated", "Unknown.2", "Commercial/Private") 
                           ~ "Health Insurance Status",
                           Subgroup %in% c("Veteran/Active Duty", "Adult Family of Veteran/Active Duty", "Child of Veteran/Active Duty",
                                           "Non-Veteran/Active Duty", "Veteran/Active Duty.1", "Adult Family of Veteran/Active Duty.1",
                                           "Child of Veteran/Active Duty.1") ~ "Veteran Status",
                           grepl("9", Subgroup) | Subgroup %in% c("Outside of Pierce County", "Unknown Zip Code") ~ "Clients Served by Zip Code",
                           Subgroup %in% c("Assessment - Mental Health", "Assessment - Substance Use Disorder", "Care Coordination", "Case Management", 
                                       "Crisis Services/Management", "Engagement and Outreach", "Family Treatment", "Group Treatment", 
                                       "Individual Treatment - Mental Health", "Individual Treatment - Substance Use Disorder", 
                                       "Individual Treatment - Other", "Medication Management", "Nursing Care", "Peer Support", "Other",
                                       "Other.1", "Engagement and Outreach.1", "Other") ~ "Service Type",
                           Subgroup %in% c('0-14', "15-17", "18-24", "24-64", "65+") ~ "Age",
                           Subgroup %in% c("Black or African American", "American Indian/Alaskan Native", "Asian", 
                                           "Native Hawaiian / Pacific Islander", "Another Race", "Unknown Race", "Two or More", 
                                           "White", "Unknown Ethnicity", "Hispanic or Latino", "Non-Hispanic or Latino") ~ "Race/Ethnicity",
                           Subgroup %in% c("Unkown", "Court", "Fire Deparment", "Hospital/ED", "Law Enforcement", 
                                           "Other Healthcare Provider", "Other Provider", "Outreach/Crises Response", "School", 
                                           "Self/Family/Friend","Self/Family/Friend.1", "Self/Family/Friend.2", "Self/Family/Friend.3",
                                           "Other -", "Other -.1", "Hospital/ED.1", "Hospital/ED.2","Hospital/ED.3",
                                           "Other Healthcare Provider.1") ~ "Referral Source",
                           
                           TRUE ~ Subgroup)) %>%
  select(Program, Month, Group, Subgroup, Count) 

clr_aot_old_full <- clr_aot_old_full %>%
  mutate(Month = case_when(Month %in% c("July", "August", "September", "October", "November", "December") ~ paste0(Month, " 2021"),
                           TRUE ~ paste0(Month, " 2022")))


```


#bind old data
```{r}
old_data <- mget(ls(pattern = "old_full")) %>%
  bind_rows()

old_data$Month <- as.Date(as.yearmon(old_data$Month))


```







#bind old data with new data, fix subgroup names
```{r}
all_programs <- rbind(full_data, old_data)


#correcting duplicate subgroup names
all_programs <- all_programs %>%
  mutate(Subgroup = case_when(Group == "Clients Served by Zip Code" & Subgroup == "Unknown" ~ "Unknown Zip Code",
                              Group == "Health Insurance Status" & Subgroup %in% c("Unknown" ,"Unknown.1","Unknown.2", 
                                                                                   "Unknown.3", "Unknown.4")
                              ~ "Unknown Health Insurance Status",
                              Group == "Housing Status" & Subgroup %in% c("Unknown" ,"Unknown.1","Unknown.2", 
                                                                          "Unknown.3", "Unknown.4") 
                              ~ "Unknown Housing Status",
                              Group == "Referral Source" & Subgroup == "Unkown" ~ "Unknown Referral Source",
                              Group == "Veteran Status" & Subgroup %in% c("Unknown" ,"Unknown.1","Unknown.2", 
                                                                          "Unknown.3", "Unknown.4")
                              ~ "Unknown Veteran Status",
                              Group == "Race/Ethnicity" & Subgroup == "Unknown/Unreported" ~ "Unknown Race",
                              Group == "Race/Ethnicity" & Subgroup == "Unknown/Unreported.1" ~ "Unknown Ethnicity",
                              Group == "Age" & Subgroup == "24-64" ~ "25-64",
                              Group == "Referral Source" & Subgroup %in% c("Other -Church", "Other - Behavior Bridges", "Other -",
                                                                           "Other -.1", "Other.3") ~ "Other Referral Source",
                              Group == "Gender" & Subgroup %in% c("Other", "Other.1", "Other.4") ~ "Other Gender",
                              Group == "Referral Source" & Subgroup %in% c("Fire Deparment", "Fire Department.1",
                                                                           "Fire Department.2", "Fire Department.3",
                                                                           "Fire Department.4", "Fire Department.5") ~ "Fire Department",
                              Group == "Age" & Subgroup %in% c("Unknown" ,"Unknown.1","Unknown.2", "Unknown.3", 
                                                               "Unknown.4") ~ "Unknown Age",
                              Group == "Referral Source" & Subgroup %in% c("Hospital/ED", "Hospital/ED.1", "Hospital/ED.2",
                                                                           "Hospital/ED.3") ~ "Hospital/ED",
                              Group == "Referral Source" & Subgroup %in% c("Law Enforcement", "Law Enforcement.1", "Law Enforcement.2",
                                                                           "Law Enforcement.3") ~ "Law Enforcement",
                              Group == "Referral Source" & Subgroup %in% c("Other Healthcare Provider", 
                                                                           "Other Healthcare Provider.1") ~ "Other Healthcare Provider",
                              Group == "Referral Source" & Subgroup %in% c("Other Provider", "Other Provider.1") ~ "Other Provider",
                              Group == "Referral Source" & Subgroup %in% c("Outreach/Crises Response", 
                                                                           "Outreach/Crises Response.1") ~ "Outreach/Crises Response",
                              Group == "Referral Source" & Subgroup %in% c("Self/Family/Friend","Self/Family/Friend.1",
                                                                           "Self/Family/Friend.2", 
                                                                           "Self/Family/Friend.3") ~ "Self/Family/Friend",
                              Group == "Referral Source" & Subgroup %in% c("Unknown Referral Source", 
                                                                           "Unknown.4", "Unknown.3") ~"Unknown Referral Source",
                              Group == "Veteran Status" & Subgroup %in% c("Adult Family of Veteran/Active Duty", 
                                                                         "Adult Family of Veteran/Active Duty.1") 
                              ~ "Adult Family of Veteran/Active Duty",
                              Group == "Veteran Status" & Subgroup %in% c("Child of Veteran/Active Duty", "Child of Veteran/Active Duty.1")
                              ~ "Child of Veteran/Active Duty",
                              Group == "Veteran Status" & Subgroup %in% c("Veteran/Active Duty", "Veteran/Active Duty.1") 
                              ~ "Veteran/Active Duty",
                              Group == "Race/Ethnicity" & Subgroup == "Another Race.1" ~ "Another Race",
                              Group == "Clients Served by Zip Code" & Subgroup == "98023.1" ~ "98023",
                              Group == "Clients Served by Zip Code" & Subgroup == "98387.1" ~ "98387",
                              Subgroup == "Engagement and Outreach.1" ~ "Engagement and Outreach",
                              Subgroup == "Individual Treatment - Mental Health.1" ~ "Individual Treatment - Mental Health",
                              Group == "Service Type" & Subgroup %in% c("Other", "Other -", "Other.1", "Other.2") ~ "Other Service",
                              Subgroup == "Unknown.4" ~ "Unknown Referral Source",
                              Subgroup == "Commercial/Private" ~ "Private",
                              Subgroup == "Other Service Type" ~ "Other Service",
                              Subgroup == "Medicare" ~ "Medicaid",
                              TRUE ~ Subgroup))

all_programs <- all_programs %>%
  mutate(Group = case_when(Group == "Unknown.4" ~ "Referral Source",
                           Group == "Fire Department" ~ "Referral Source",
                           Group == "Unknown Zip Code" ~ "Clients Served by Zip Code",
                           TRUE ~ Group))

write.csv(all_programs, "2024_07_30_All_Programs.csv")
```




```{r}
all_programs %>%
  filter(Group == "Race/Ethnicity") %>%
  group_by(Subgroup) %>%
  summarise(count = sum(Count, na.rm = t)) 
```





































































